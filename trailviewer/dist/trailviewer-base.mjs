import{EventEmitter as e}from"events";import t from"url-join";window.libpannellum=function(e,t,a){function n(n,c){function u(e,t){return 1==e.level&&1!=t.level?-1:1==t.level&&1!=e.level?1:t.timestamp-e.timestamp}function d(e,t){return e.level!=t.level?e.level-t.level:e.diff-t.diff}function f(e,t,a,n,i,o,r){this.vertices=e,this.side=t,this.level=a,this.x=n,this.y=i,e=(e="object"==typeof o?o.tileKey:o).replace("%s",t).replace("%l0",a-1).replace("%l",a).replace("%x",n).replace("%y",i),this.path="object"==typeof o?o[e]:e,this.parentPath=r}function m(e,t,a,n,i,o){var r;r=b(e,(l=a.vertices).slice(0,3));var s=b(e,l.slice(3,6)),h=b(e,l.slice(6,9)),l=b(e,l.slice(9,12));if(-4==(c=r[0]+s[0]+h[0]+l[0])||4==c?r=!1:r=-4!=(c=r[1]+s[1]+h[1]+l[1])&&4!=c&&4!=r[2]+s[2]+h[2]+l[2],r){var c=[],u=[],d=2,p=[],g=0;for(l=0;4>l;l++)r=_(t,a.vertices.slice(3*l,3*(l+1))),c.push(r[0]*r[3]),u.push(r[1]*r[3]),r=r[2]*r[3],d=Math.min(d,r),p.push(1>=Math.abs(c[l])&&1>=Math.abs(u[l])&&0<r),g+=p[l];if(h=k.cubeResolution*Math.pow(2,a.level-k.maxLevel),r=Math.ceil(h*k.invTileResolution)-1,s=h%k.tileResolution*2,0===(h=2*h%k.tileResolution)&&(h=k.tileResolution),0===s&&(s=2*k.tileResolution),1<a.level&&0<d&&0<g){for(l=d=0;4>l;l++)if(g=(l+1)%4,p[l]||p[g]){var v=(c[g]-c[l])*C.drawingBufferWidth/2;g=(u[g]-u[l])*C.drawingBufferHeight/2;h<k.tileResolution&&(a.x==r?v*=k.tileResolution/h:a.y==r&&(g*=k.tileResolution/h)),s<=k.tileResolution&&(a.x==r&&(v*=2),a.y==r&&(g*=2)),d=Math.max(d,Math.sqrt(v*v+g*g))}if(d<=k.tileResolution/2)return}for(l=(c=a.vertices)[0]+c[3]+c[6]+c[9],u=c[1]+c[4]+c[7]+c[10],p=c[2]+c[5]+c[8]+c[11],d=Math.sqrt(l*l+u*u+p*p),p=Math.asin(p/d),l=Math.atan2(u,l)-i,l+=l>Math.PI?-2*Math.PI:l<-Math.PI?2*Math.PI:0,l=Math.abs(l),a.diff=Math.acos(Math.sin(n)*Math.sin(p)+Math.cos(n)*Math.cos(p)*Math.cos(l)),l=!1,u=0;u<R.nodeCache.length;u++)if(R.nodeCache[u].path==a.path){l=!0,R.nodeCache[u].timestamp=R.nodeCacheTimestamp++,R.nodeCache[u].diff=a.diff,R.currentNodes.push(R.nodeCache[u]);break}if(l||(a.timestamp=R.nodeCacheTimestamp++,R.currentNodes.push(a),R.nodeCache.push(a)),a.level<k.maxLevel){p=.5,a.x!=r&&a.y!=r||(p=1-k.tileResolution/(k.tileResolution+h));u=[],v=g=d=p;var w=l=1-p,y=l,x=l;for(h<k.tileResolution&&(a.x==r&&a.y!=r?(y=g=.5,("d"==a.side||"u"==a.side)&&(x=v=.5)):a.x!=r&&a.y==r&&(w=d=.5,"l"==a.side||"r"==a.side)&&(x=v=.5)),s<=k.tileResolution&&(a.x==r&&(d=0,w=1,"l"==a.side||"r"==a.side)&&(v=0,x=1),a.y==r&&(g=0,y=1,"d"==a.side||"u"==a.side)&&(v=0,x=1)),h=new f(h=new Float32Array([c[0],c[1],c[2],c[0]*d+c[3]*w,c[1]*p+c[4]*l,c[2]*v+c[5]*x,c[0]*d+c[6]*w,c[1]*g+c[7]*y,c[2]*v+c[8]*x,c[0]*p+c[9]*l,c[1]*g+c[10]*y,c[2]*v+c[11]*x]),a.side,a.level+1,2*a.x,2*a.y,k.fullpath,a.path),u.push(h),a.x==r&&s<=k.tileResolution||(h=new f(h=new Float32Array([c[0]*d+c[3]*w,c[1]*p+c[4]*l,c[2]*v+c[5]*x,c[3],c[4],c[5],c[3]*p+c[6]*l,c[4]*g+c[7]*y,c[5]*v+c[8]*x,c[0]*d+c[6]*w,c[1]*g+c[7]*y,c[2]*v+c[8]*x]),a.side,a.level+1,2*a.x+1,2*a.y,k.fullpath,a.path),u.push(h)),a.x==r&&s<=k.tileResolution||a.y==r&&s<=k.tileResolution||(h=new f(h=new Float32Array([c[0]*d+c[6]*w,c[1]*g+c[7]*y,c[2]*v+c[8]*x,c[3]*p+c[6]*l,c[4]*g+c[7]*y,c[5]*v+c[8]*x,c[6],c[7],c[8],c[9]*d+c[6]*w,c[10]*p+c[7]*l,c[11]*v+c[8]*x]),a.side,a.level+1,2*a.x+1,2*a.y+1,k.fullpath,a.path),u.push(h)),a.y==r&&s<=k.tileResolution||(h=new f(h=new Float32Array([c[0]*p+c[9]*l,c[1]*g+c[10]*y,c[2]*v+c[11]*x,c[0]*d+c[6]*w,c[1]*g+c[7]*y,c[2]*v+c[8]*x,c[9]*d+c[6]*w,c[10]*p+c[7]*l,c[11]*v+c[8]*x,c[9],c[10],c[11]]),a.side,a.level+1,2*a.x,2*a.y+1,k.fullpath,a.path),u.push(h)),g=0;g<u.length;g++)m(e,t,u[g],n,i)}}}function p(){return new Float32Array([-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,-1,-1])}function g(e,t,a){var n=Math.sin(t);return t=Math.cos(t),"x"==a?new Float32Array([e[0],t*e[1]+n*e[2],t*e[2]-n*e[1],e[3],t*e[4]+n*e[5],t*e[5]-n*e[4],e[6],t*e[7]+n*e[8],t*e[8]-n*e[7]]):"y"==a?new Float32Array([t*e[0]-n*e[2],e[1],t*e[2]+n*e[0],t*e[3]-n*e[5],e[4],t*e[5]+n*e[3],t*e[6]-n*e[8],e[7],t*e[8]+n*e[6]]):"z"==a?new Float32Array([t*e[0]+n*e[1],t*e[1]-n*e[0],e[2],t*e[3]+n*e[4],t*e[4]-n*e[3],e[5],t*e[6]+n*e[7],t*e[7]-n*e[6],e[8]]):void 0}function v(e){return new Float32Array([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]])}function w(e,t,a,n){return e=2*Math.atan(Math.tan(e/2)*C.drawingBufferHeight/C.drawingBufferWidth),e=1/Math.tan(e/2),new Float32Array([e/t,0,0,0,0,e,0,0,0,0,(n+a)/(a-n),2*n*a/(a-n),0,0,-1,0])}function y(e,t){return new Float32Array([e[0]*t[0],e[0]*t[1],e[0]*t[2],0,e[5]*t[4],e[5]*t[5],e[5]*t[6],0,e[10]*t[8],e[10]*t[9],e[10]*t[10],e[11],-t[8],-t[9],-t[10],0])}function _(e,t){return new Float32Array([e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[4]*t[0]+e[5]*t[1]+e[6]*t[2],e[11]+e[8]*t[0]+e[9]*t[1]+e[10]*t[2],1/(e[12]*t[0]+e[13]*t[1]+e[14]*t[2])])}function b(e,t){var a=(i=_(e,t))[0]*i[3],n=i[1]*i[3],i=i[2]*i[3],o=[0,0,0];return-1>a&&(o[0]=-1),1<a&&(o[0]=1),-1>n&&(o[1]=-1),1<n&&(o[1]=1),(-1>i||1<i)&&(o[2]=1),o}function x(){console.log("Reducing canvas size due to error 1286!"),T.width=Math.round(T.width/2),T.height=Math.round(T.height/2)}function E(e,t){return Math.pow((Math.abs(e)-t)/t,2)*(0<e-t?1:-1)}function M(e,t){for(var a=Math.floor(e.length/t),n=[],i=0;i<a;i++){for(var o=0,r=0;r<t;r++)o=83*o+K.indexOf(e[i*t+r]);n.push(o)}return n}function P(e,t,a){var n=Math.floor(Math.sqrt(e.length))-1,i=Array(n+1),o=Array(n+1);o[0]=0,i[0]=1,o[1]=Math.sin(a),i[1]=Math.cos(a);for(var r=2;r<=n;r++)o[r]=2*o[r-1]*i[1]-o[r-2],i[r]=2*i[r-1]*i[1]-i[r-2];var s=a=0;for(r=1;r<=n+1;r++)s+=r;for(;0<=n;n--){var h=Math.floor((n+1)*n/2);for(a+=0!=h?e[h]*t[h-1]:e[h],r=1;r<=n;r++)a+=(e[++h]*i[r]+e[h+s-n-1]*o[r])*t[h-1]}return Math.round(a)}function I(e){if(1>ee.length)for(var t=J.length/32,a=0;32>a;a++){ee.push([]);for(var n=0;n<t;n++)ee[a].push(E(M(J[a*t+n],1),41)*Q)}M(e[0],1);n=255*(E(M(e[1],1),41)+1)/2;var i=M(e.slice(2),2);e=[];t=[];var o=[];for(a=0;a<i.length;a++){var r,s=i[a];r=n;var h=Math.floor(s/19)%19,l=s%19;r=[s=E(Math.floor(s/361),9)*r,h=E(h,9)*r,r*=E(l,9)],e.push(r[0]),t.push(r[1]),o.push(r[2])}for(i=.03125*Math.PI,r=[],a=31;0<=a;a--)for(n=0;64>n;n++)r.push(P(e,ee[a],(n+.5)*i)),r.push(P(t,ee[a],(n+.5)*i)),r.push(P(o,ee[a],(n+.5)*i)),r.push(255);return new ImageData(new Uint8ClampedArray(r),64,32)}var T;n&&((T=t.createElement("canvas")).style.width=T.style.height="100%",n.appendChild(T));var R,C,L,A,S,N,F,D,O,B,U,k,H,z,G,Y,q,V,X="fbudlr".split(""),W="frblud".split("");c&&(C=c),this.init=function(e,c,u,d,f,m,g){function v(e){if(_){var t=e*e*4,a=new Uint8ClampedArray(t),n=g.backgroundColor?g.backgroundColor:[0,0,0];n[0]*=255,n[1]*=255,n[2]*=255;for(var i=0;i<t;i++)a[i++]=n[0],a[i++]=n[1],a[i++]=n[2];for(e=new ImageData(a,e,e),w=0;6>w;w++)0==k[w].width&&(k[w]=e)}}if(c===a&&(c="equirectangular"),"equirectangular"!=c&&"cubemap"!=c&&"multires"!=c)throw console.log("Error: invalid image type specified!"),{type:"config error"};if(H=c,k=e,V=g||{},R){if(L&&(C.detachShader(R,L),C.deleteShader(L)),A&&(C.detachShader(R,A),C.deleteShader(A)),C.bindBuffer(C.ARRAY_BUFFER,null),C.bindBuffer(C.ELEMENT_ARRAY_BUFFER,null),R.texture&&C.deleteTexture(R.texture),R.nodeCache)for(e=0;e<R.nodeCache.length;e++)C.deleteTexture(R.nodeCache[e].texture);if(R.textureLoads)for(j=[];0<R.textureLoads.length;)R.textureLoads.shift()(!1);C.deleteProgram(R),R=a}S&&(N&&(C.detachShader(S,N),C.deleteShader(N)),F&&(C.detachShader(S,F),C.deleteShader(F)),C.deleteProgram(S),S=a),U=a;var w,y,_=!1;if("cubemap"==H)for(w=0;6>w;w++)0<k[w].width?(y===a&&(y=k[w].width),y!=k[w].width&&console.log("Cube faces have inconsistent widths: "+y+" vs. "+k[w].width)):_=!0;if("cubemap"==H&&0!=(y&y-1)&&(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 9_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 10_/)||navigator.userAgent.match(/Trident.*rv[ :]*11\./))||(C||(C=T.getContext("experimental-webgl",{alpha:!1,depth:!1})),C&&1286==C.getError()&&x()),!C&&("multires"==H&&k.hasOwnProperty("fallbackPath")||"cubemap"==H)&&("WebkitAppearance"in t.documentElement.style||navigator.userAgent.match(/Trident.*rv[ :]*11\./)||-1!==navigator.appVersion.indexOf("MSIE 10"))){O&&n.removeChild(O),(O=t.createElement("div")).className="pnlm-world",u=k.basePath?k.basePath+k.fallbackPath:k.fallbackPath;var b=0;d=function(){var e=t.createElement("canvas");e.className="pnlm-face pnlm-"+W[this.side]+"face",O.appendChild(e);var a=e.getContext("2d");e.style.width=this.width+4+"px",e.style.height=this.height+4+"px",e.width=this.width+4,e.height=this.height+4,a.drawImage(this,2,2);var n,i,o=a.getImageData(0,0,e.width,e.height),r=o.data;for(n=2;n<e.width-2;n++)for(i=0;4>i;i++)r[4*(n+e.width)+i]=r[4*(n+2*e.width)+i],r[4*(n+e.width*(e.height-2))+i]=r[4*(n+e.width*(e.height-3))+i];for(n=2;n<e.height-2;n++)for(i=0;4>i;i++)r[4*(n*e.width+1)+i]=r[4*(n*e.width+2)+i],r[4*((n+1)*e.width-2)+i]=r[4*((n+1)*e.width-3)+i];for(i=0;4>i;i++)r[4*(e.width+1)+i]=r[4*(2*e.width+2)+i],r[4*(2*e.width-2)+i]=r[4*(3*e.width-3)+i],r[4*(e.width*(e.height-2)+1)+i]=r[4*(e.width*(e.height-3)+2)+i],r[4*(e.width*(e.height-1)-2)+i]=r[4*(e.width*(e.height-2)-3)+i];for(n=1;n<e.width-1;n++)for(i=0;4>i;i++)r[4*n+i]=r[4*(n+e.width)+i],r[4*(n+e.width*(e.height-1))+i]=r[4*(n+e.width*(e.height-2))+i];for(n=1;n<e.height-1;n++)for(i=0;4>i;i++)r[n*e.width*4+i]=r[4*(n*e.width+1)+i],r[4*((n+1)*e.width-1)+i]=r[4*((n+1)*e.width-2)+i];for(i=0;4>i;i++)r[i]=r[4*(e.width+1)+i],r[4*(e.width-1)+i]=r[4*(2*e.width-2)+i],r[e.width*(e.height-1)*4+i]=r[4*(e.width*(e.height-2)+1)+i],r[4*(e.width*e.height-1)+i]=r[4*(e.width*(e.height-1)-2)+i];a.putImageData(o,0,0),E.call(this)};var E=function(){0<this.width?(D===a&&(D=this.width),D!=this.width&&console.log("Fallback faces have inconsistent widths: "+D+" vs. "+this.width)):_=!0,6==++b&&(D=this.width,n.appendChild(O),m())};_=!1;for(w=0;6>w;w++)(f=new Image).crossOrigin=V.crossOrigin?V.crossOrigin:"anonymous",f.side=w,f.onload=d,f.onerror=E,f.src="multires"==H?u.replace("%s",W[w])+(k.extension?"."+k.extension:""):k[w].src;v(D)}else{if(!C)throw console.log("Error: no WebGL support detected!"),{type:"no webgl"};for("cubemap"==H&&v(y),k.fullpath=k.basePath?k.basePath+k.path:k.path,k.invTileResolution=1/k.tileResolution,e=p(),B=[],w=0;6>w;w++)B[w]=e.slice(12*w,12*w+12),e=p();if(e=0,"equirectangular"==H){if(e=C.getParameter(C.MAX_TEXTURE_SIZE),Math.max(k.width/2,k.height)>e)throw console.log("Error: The image is too big; it's "+k.width+"px wide, but this device's maximum supported size is "+2*e+"px."),{type:"webgl size error",width:k.width,maxWidth:2*e}}else if("cubemap"==H&&y>C.getParameter(C.MAX_CUBE_MAP_TEXTURE_SIZE))throw console.log("Error: The image is too big; it's "+y+"px wide, but this device's maximum supported size is "+e+"px."),{type:"webgl size error",width:y,maxWidth:e};g!==a&&(y=isNaN(g.horizonPitch)?0:Number(g.horizonPitch),c=isNaN(g.horizonRoll)?0:Number(g.horizonRoll),0!=y||0!=c)&&(U=[y,c]);var M=C.TEXTURE_2D;if(C.viewport(0,0,C.drawingBufferWidth,C.drawingBufferHeight),C.getShaderPrecisionFormat&&(y=C.getShaderPrecisionFormat(C.FRAGMENT_SHADER,C.HIGH_FLOAT))&&1>y.precision&&(r=r.replace("highp","mediump")),L=C.createShader(C.VERTEX_SHADER),y=i,"multires"==H&&(y=o),C.shaderSource(L,y),C.compileShader(L),A=C.createShader(C.FRAGMENT_SHADER),y=h,"cubemap"==H?(M=C.TEXTURE_CUBE_MAP,y=s):"multires"==H&&(y=l),C.shaderSource(A,y),C.compileShader(A),R=C.createProgram(),C.attachShader(R,L),C.attachShader(R,A),C.linkProgram(R),C.getShaderParameter(L,C.COMPILE_STATUS)||console.log(C.getShaderInfoLog(L)),C.getShaderParameter(A,C.COMPILE_STATUS)||console.log(C.getShaderInfoLog(A)),C.getProgramParameter(R,C.LINK_STATUS)||console.log(C.getProgramInfoLog(R)),C.useProgram(R),R.drawInProgress=!1,null!==g.backgroundColor){var P=g.backgroundColor?g.backgroundColor:[0,0,0];C.clearColor(P[0],P[1],P[2],1),C.clear(C.COLOR_BUFFER_BIT)}if(R.texCoordLocation=C.getAttribLocation(R,"a_texCoord"),C.enableVertexAttribArray(R.texCoordLocation),"multires"!=H)z||(z=C.createBuffer()),C.bindBuffer(C.ARRAY_BUFFER,z),C.bufferData(C.ARRAY_BUFFER,new Float32Array([-1,1,1,1,1,-1,-1,1,1,-1,-1,-1]),C.STATIC_DRAW),C.vertexAttribPointer(R.texCoordLocation,2,C.FLOAT,!1,0,0),R.aspectRatio=C.getUniformLocation(R,"u_aspectRatio"),C.uniform1f(R.aspectRatio,C.drawingBufferWidth/C.drawingBufferHeight),R.psi=C.getUniformLocation(R,"u_psi"),R.theta=C.getUniformLocation(R,"u_theta"),R.f=C.getUniformLocation(R,"u_f"),R.h=C.getUniformLocation(R,"u_h"),R.v=C.getUniformLocation(R,"u_v"),R.vo=C.getUniformLocation(R,"u_vo"),R.rot=C.getUniformLocation(R,"u_rot"),C.uniform1f(R.h,u/(2*Math.PI)),C.uniform1f(R.v,d/Math.PI),C.uniform1f(R.vo,f/Math.PI*2),"equirectangular"==H&&(R.backgroundColor=C.getUniformLocation(R,"u_backgroundColor"),C.uniform4fv(R.backgroundColor,P.concat([1]))),R.texture=C.createTexture(),C.bindTexture(M,R.texture),"cubemap"==H?(C.texImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X,0,C.RGB,C.RGB,C.UNSIGNED_BYTE,k[1]),C.texImage2D(C.TEXTURE_CUBE_MAP_NEGATIVE_X,0,C.RGB,C.RGB,C.UNSIGNED_BYTE,k[3]),C.texImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_Y,0,C.RGB,C.RGB,C.UNSIGNED_BYTE,k[4]),C.texImage2D(C.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,C.RGB,C.RGB,C.UNSIGNED_BYTE,k[5]),C.texImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_Z,0,C.RGB,C.RGB,C.UNSIGNED_BYTE,k[0]),C.texImage2D(C.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,C.RGB,C.RGB,C.UNSIGNED_BYTE,k[2])):k.width<=e?(C.uniform1i(C.getUniformLocation(R,"u_splitImage"),0),C.texImage2D(M,0,C.RGB,C.RGB,C.UNSIGNED_BYTE,k)):(C.uniform1i(C.getUniformLocation(R,"u_splitImage"),1),(d=t.createElement("canvas")).width=k.width/2,d.height=k.height,(d=d.getContext("2d")).drawImage(k,0,0),f=d.getImageData(0,0,k.width/2,k.height),C.texImage2D(M,0,C.RGB,C.RGB,C.UNSIGNED_BYTE,f),R.texture2=C.createTexture(),C.activeTexture(C.TEXTURE1),C.bindTexture(M,R.texture2),C.uniform1i(C.getUniformLocation(R,"u_image1"),1),d.drawImage(k,-k.width/2,0),f=d.getImageData(0,0,k.width/2,k.height),C.texImage2D(M,0,C.RGB,C.RGB,C.UNSIGNED_BYTE,f),C.texParameteri(M,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE),C.texParameteri(M,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE),C.texParameteri(M,C.TEXTURE_MIN_FILTER,C.LINEAR),C.texParameteri(M,C.TEXTURE_MAG_FILTER,C.LINEAR),C.activeTexture(C.TEXTURE0)),"cubemap"!=H&&k.width&&k.width<=e&&u==2*Math.PI&&0==(k.width&k.width-1)?C.texParameteri(M,C.TEXTURE_WRAP_S,C.REPEAT):C.texParameteri(M,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE),C.texParameteri(M,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE),C.texParameteri(M,C.TEXTURE_MIN_FILTER,C.LINEAR),C.texParameteri(M,C.TEXTURE_MAG_FILTER,C.LINEAR);else if(R.vertPosLocation=C.getAttribLocation(R,"a_vertCoord"),C.enableVertexAttribArray(R.vertPosLocation),G||(G=C.createBuffer()),Y||(Y=C.createBuffer()),q||(q=C.createBuffer()),C.bindBuffer(C.ARRAY_BUFFER,Y),C.bufferData(C.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),C.STATIC_DRAW),C.vertexAttribPointer(R.texCoordLocation,2,C.FLOAT,!1,0,0),C.bindBuffer(C.ELEMENT_ARRAY_BUFFER,q),C.bufferData(C.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),C.STATIC_DRAW),C.bindBuffer(C.ARRAY_BUFFER,G),C.vertexAttribPointer(R.vertPosLocation,3,C.FLOAT,!1,0,0),R.perspUniform=C.getUniformLocation(R,"u_perspMatrix"),R.cubeUniform=C.getUniformLocation(R,"u_cubeMatrix"),R.currentNodes=[],R.nodeCache=[],R.nodeCacheTimestamp=0,R.textureLoads=[],k.shtHash||k.equirectangularThumbnail){N=C.createShader(C.VERTEX_SHADER),C.shaderSource(N,i),C.compileShader(N),F=C.createShader(C.FRAGMENT_SHADER),C.shaderSource(F,h),C.compileShader(F),S=C.createProgram(),C.attachShader(S,N),C.attachShader(S,F),C.linkProgram(S),C.getShaderParameter(N,C.COMPILE_STATUS)||console.log(C.getShaderInfoLog(N)),C.getShaderParameter(F,C.COMPILE_STATUS)||console.log(C.getShaderInfoLog(F)),C.getProgramParameter(S,C.LINK_STATUS)||console.log(C.getProgramInfoLog(S)),C.useProgram(S),S.texCoordLocation=C.getAttribLocation(S,"a_texCoord"),C.enableVertexAttribArray(S.texCoordLocation),z||(z=C.createBuffer()),C.bindBuffer(C.ARRAY_BUFFER,z),C.bufferData(C.ARRAY_BUFFER,new Float32Array([-1,1,1,1,1,-1,-1,1,1,-1,-1,-1]),C.STATIC_DRAW),C.vertexAttribPointer(S.texCoordLocation,2,C.FLOAT,!1,0,0),S.aspectRatio=C.getUniformLocation(S,"u_aspectRatio"),C.uniform1f(S.aspectRatio,C.drawingBufferWidth/C.drawingBufferHeight),S.psi=C.getUniformLocation(S,"u_psi"),S.theta=C.getUniformLocation(S,"u_theta"),S.f=C.getUniformLocation(S,"u_f"),S.h=C.getUniformLocation(S,"u_h"),S.v=C.getUniformLocation(S,"u_v"),S.vo=C.getUniformLocation(S,"u_vo"),S.rot=C.getUniformLocation(S,"u_rot"),C.uniform1f(S.h,1),S.texture=C.createTexture(),C.bindTexture(M,S.texture);var X,Z,$,K=function(){C.useProgram(S),C.uniform1i(C.getUniformLocation(S,"u_splitImage"),0),C.texImage2D(M,0,C.RGBA,C.RGBA,C.UNSIGNED_BYTE,X),C.texParameteri(M,C.TEXTURE_WRAP_S,C.REPEAT),C.texParameteri(M,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE),C.texParameteri(M,C.TEXTURE_MIN_FILTER,C.LINEAR),C.texParameteri(M,C.TEXTURE_MAG_FILTER,C.LINEAR),C.uniform1f(S.v,Z),C.uniform1f(S.vo,$),C.useProgram(R)};if(k.shtHash&&(X=I(k.shtHash),Z=(2+1/31)/2,$=1-(2+1/31)/2,K()),k.equirectangularThumbnail)if("string"==typeof k.equirectangularThumbnail){if("data:"!=k.equirectangularThumbnail.slice(0,5))throw console.log("Error: thumbnail string is not a data URI!"),{type:"config error"};(X=new Image).onload=function(){Z=1,$=0,K()},X.src=k.equirectangularThumbnail}else X=k.equirectangularThumbnail,Z=1,$=0,K();C.bindBuffer(C.ARRAY_BUFFER,G),C.vertexAttribPointer(R.vertPosLocation,3,C.FLOAT,!1,0,0),C.useProgram(R)}if(0!==(u=C.getError()))throw console.log("Error: Something went wrong with WebGL!",u),{type:"webgl error"};m()}},this.destroy=function(){if(n!==a&&(T!==a&&n.contains(T)&&n.removeChild(T),O!==a&&n.contains(O)&&n.removeChild(O)),C){var e=C.getExtension("WEBGL_lose_context");e&&e.loseContext()}},this.resize=function(){var t=e.devicePixelRatio||1;T.width=T.clientWidth*t,T.height=T.clientHeight*t,C&&(1286==C.getError()&&x(),C.viewport(0,0,C.drawingBufferWidth,C.drawingBufferHeight),"multires"!=H?C.uniform1f(R.aspectRatio,T.clientWidth/T.clientHeight):k.shtHash&&(C.useProgram(S),C.uniform1f(S.aspectRatio,T.clientWidth/T.clientHeight),C.useProgram(R)))},T&&this.resize(),this.setPose=function(e,t){e=isNaN(e)?0:Number(e),t=isNaN(t)?0:Number(t),U=0==e&&0==t?a:[e,t]},this.render=function(t,n,i,o){var r,s,h=0;if(o===a&&(o={}),o.roll&&(h=o.roll),o.dynamic)var l=o.dynamic;if(U!==a){r=U[0],s=U[1];var c=t,p=n,_=Math.cos(s)*Math.sin(t)*Math.sin(r)+Math.cos(t)*(Math.cos(r)*Math.cos(n)+Math.sin(s)*Math.sin(r)*Math.sin(n)),b=-Math.sin(t)*Math.sin(s)+Math.cos(t)*Math.cos(s)*Math.sin(n);t=Math.cos(s)*Math.cos(r)*Math.sin(t)+Math.cos(t)*(-Math.cos(n)*Math.sin(r)+Math.cos(r)*Math.sin(s)*Math.sin(n)),t=Math.asin(Math.max(Math.min(t,1),-1)),n=Math.atan2(b,_),r=[Math.cos(c)*(Math.sin(s)*Math.sin(r)*Math.cos(p)-Math.cos(r)*Math.sin(p)),Math.cos(c)*Math.cos(s)*Math.cos(p),Math.cos(c)*(Math.cos(r)*Math.sin(s)*Math.cos(p)+Math.sin(p)*Math.sin(r))],s=[-Math.cos(t)*Math.sin(n),Math.cos(t)*Math.cos(n)],s=Math.acos(Math.max(Math.min((r[0]*s[0]+r[1]*s[1])/(Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2])*Math.sqrt(s[0]*s[0]+s[1]*s[1])),1),-1)),0>r[2]&&(s=2*Math.PI-s),h+=s}if(o.hook&&o.hook({gl:C,program:R,previewProgram:S,imageType:H,texCoordBuffer:z,cubeVertBuf:G,cubeVertTexCoordBuf:Y,cubeVertIndBuf:q}),C||"multires"!=H&&"cubemap"!=H){if("multires"!=H)r=2*Math.atan(Math.tan(.5*i)/(C.drawingBufferWidth/C.drawingBufferHeight)),r=1/Math.tan(.5*r),C.uniform1f(R.psi,n),C.uniform1f(R.theta,t),C.uniform1f(R.rot,h),C.uniform1f(R.f,r),!0===l&&"equirectangular"==H&&(C.bindTexture(C.TEXTURE_2D,R.texture),C.texImage2D(C.TEXTURE_2D,0,C.RGB,C.RGB,C.UNSIGNED_BYTE,k)),C.drawArrays(C.TRIANGLES,0,6);else{if((l=void 0!==k.shtHash||void 0!==k.equirectangularThumbnail)&&(C.useProgram(S),C.bindBuffer(C.ARRAY_BUFFER,z),C.vertexAttribPointer(S.texCoordLocation,2,C.FLOAT,!1,0,0),C.bindTexture(C.TEXTURE_2D,S.texture),r=2*Math.atan(Math.tan(.5*i)/(C.drawingBufferWidth/C.drawingBufferHeight)),r=1/Math.tan(.5*r),C.uniform1f(S.psi,n),C.uniform1f(S.theta,t),C.uniform1f(S.rot,h),C.uniform1f(S.f,r),C.drawArrays(C.TRIANGLES,0,6),C.bindBuffer(C.ARRAY_BUFFER,G),C.vertexAttribPointer(R.vertPosLocation,3,C.FLOAT,!1,0,0),C.useProgram(R)),c=w(i,C.drawingBufferWidth/C.drawingBufferHeight,.1,100),r=w(i,C.drawingBufferWidth/C.drawingBufferHeight,-100,100),s=g(s=new Float32Array([1,0,0,0,1,0,0,0,1]),-h,"z"),s=g(s,-t,"x"),s=g(s,n,"y"),s=new Float32Array([s[0],s[1],s[2],0,s[3],s[4],s[5],0,s[6],s[7],s[8],0,0,0,0,1]),C.uniformMatrix4fv(R.perspUniform,!1,v(c)),C.uniformMatrix4fv(R.cubeUniform,!1,v(s)),h=y(c,s),r=y(r,s),R.nodeCache.sort(u),200<R.nodeCache.length&&R.nodeCache.length>R.currentNodes.length+50)for(s=R.nodeCache.splice(200,R.nodeCache.length-200),c=0;c<s.length;c++)C.deleteTexture(s[c].texture);for(R.currentNodes=[],s=0;6>s;s++)m(h,r,c=new f(B[s],X[s],1,0,0,k.fullpath,null),t,n);for(R.currentNodes.sort(d),t=j.length-1;0<=t;t--)-1===R.currentNodes.indexOf(j[t].node)&&(j[t].node.textureLoad=!1,j.splice(t,1));if(0===j.length)for(t=0;t<R.currentNodes.length;t++)if(!(n=R.currentNodes[t]).texture&&!n.textureLoad){n.textureLoad=!0,setTimeout(Z,0,n);break}if(0<R.textureLoads.length&&R.textureLoads.shift()(!0),t=!l,!R.drawInProgress){for(R.drawInProgress=!0,t&&C.clear(C.COLOR_BUFFER_BIT),t={},n=0;n<R.currentNodes.length;n++)t[R.currentNodes[n].parentPath]===a&&(t[R.currentNodes[n].parentPath]=0),t[R.currentNodes[n].parentPath]+=!(1<R.currentNodes[n].textureLoaded);for(n=0;n<R.currentNodes.length;n++)1<R.currentNodes[n].textureLoaded&&(C.bufferData(C.ARRAY_BUFFER,R.currentNodes[n].vertices,C.STATIC_DRAW),C.bindTexture(C.TEXTURE_2D,R.currentNodes[n].texture),C.drawElements(C.TRIANGLES,6,C.UNSIGNED_SHORT,0));R.drawInProgress=!1}}if(o.returnImage!==a)return e.createImageBitmap&&"ImageBitmap"==o.returnImage?createImageBitmap(T):0==o.returnImage.toString().indexOf("image/")?T.toDataURL(o.returnImage):T.toDataURL("image/jpg",.5)}else for(o={f:"translate3d(-"+((s=D/2)+2)+"px, -"+(s+2)+"px, -"+s+"px)",b:"translate3d("+(s+2)+"px, -"+(s+2)+"px, "+s+"px) rotateX(180deg) rotateZ(180deg)",u:"translate3d(-"+(s+2)+"px, -"+s+"px, "+(s+2)+"px) rotateX(270deg)",d:"translate3d(-"+(s+2)+"px, "+s+"px, -"+(s+2)+"px) rotateX(90deg)",l:"translate3d(-"+s+"px, -"+(s+2)+"px, "+(s+2)+"px) rotateX(180deg) rotateY(90deg) rotateZ(180deg)",r:"translate3d("+s+"px, -"+(s+2)+"px, -"+(s+2)+"px) rotateY(270deg)"},n="perspective("+(i=(r=1/Math.tan(i/2))*T.clientWidth/2+"px")+") translateZ("+i+") rotateX("+t+"rad) rotateY("+n+"rad) ",i=Object.keys(o),t=0;6>t;t++)(h=O.querySelector(".pnlm-"+i[t]+"face"))&&(h.style.webkitTransform=n+o[i[t]],h.style.transform=n+o[i[t]])},this.isLoading=function(){if(C&&"multires"==H)for(var e=0;e<R.currentNodes.length;e++)if(!R.currentNodes[e].textureLoaded)return!0;return!1},this.isBaseLoaded=function(){if(6<=R.currentNodes.length){for(var e=0;6>e;e++)if(!R.currentNodes[e].textureLoaded)return!1;return!0}return!1},this.getCanvas=function(){return T};var Z,j=[],$=function(){function e(){var e=this;this.texture=this.callback=null,this.image=new Image,this.image.crossOrigin=a||"anonymous";var t=function(){R.textureLoads.push((function(t){t&&(0<e.image.width&&0<e.image.height?(t=e.image,C.bindTexture(C.TEXTURE_2D,e.texture),C.texImage2D(C.TEXTURE_2D,0,C.RGB,C.RGB,C.UNSIGNED_BYTE,t),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,C.LINEAR),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,C.LINEAR),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE),C.bindTexture(C.TEXTURE_2D,null),e.callback(e.texture,!0)):e.callback(e.texture,!1)),j.length?(t=j.shift(),e.loadTexture(t.src,t.texture,t.callback)):i[n++]=e}))};this.image.addEventListener("load",t),this.image.addEventListener("error",t)}function t(e,t,a,n){this.node=e,this.src=t,this.texture=a,this.callback=n}var a,n=4,i={};e.prototype.loadTexture=function(e,t,a){this.texture=t,this.callback=a,this.image.src=e};for(var o=0;o<n;o++)i[o]=new e;return function(e,o,r,s){return a=s,s=C.createTexture(),n?i[--n].loadTexture(o,s,r):j.push(new t(e,o,s,r)),s}}();Z=function(e){$(e,e.path+(k.extension?"."+k.extension:""),(function(t,a){e.texture=t,e.textureLoaded=a?2:1}),V.crossOrigin)};var K="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz#$%*+,-.:;=?@[]^_{|}~",J="Bf[ff4fff|ffff0fffffBo@Ri5xag{Jmdf2+WiefCs@Ll7+Vi]Btag6[NmdgCv=Ho9;Qk;7zWiF_GsahDy:ErE?Mn$5+SkS_AyWiD#-CuJ[Iqp6;Nnx?7*SlE$*BxR@FtPA?Jq+%7:NnF*zAzn?CwIG@Ft-Y9?IrG+vA%w:AzGR?Cx*IF@EuI,nA+$*9%Gu:A#xCR?ByJ-VB-*wA+J**9*ZBv:9%L.QD.*aB.O.v9-MF+$8,O:MG:*OD;a:UB:IO:n9:Q:KJ;#IG=u-KE=Hs:MC?T:IO=wEL?#%FJ@K**FI@Y;HV=pDU?*sCS@S.uCR[m;Hp=VDq?*SCs@s.QCt[r:Iw=OEz?#IF$@#*HF%@u:K$;KI+=uEK-=*sCM:?w:M+:HO.;aCU;:%OCn?:z.Q..Ha;.ODv?-yFG$@,$-V;-Hw=+JH*?*lBP:?%%,n=+J*?%GQ:=#NCt?;y++v=%O:=zGt?:xHI,@-u,*z=zX?:wI+@,tEY??%r-$*;xt@,tP=?$qG%[:xn.#-:u$[%qp];xnN?[*sl.y:-r-?yn$^+sks_=yoi:v=*o?;uk;[zoi,_+skh:s@zl[+pi];tkg][xmhg;o@ti^xkg{$mhf|+oigf;f[ff_fff|ffff~fffff",Q=3.317,ee=[]}var i="attribute vec2 a_texCoord;varying vec2 v_texCoord;void main() {gl_Position = vec4(a_texCoord, 0.0, 1.0);v_texCoord = a_texCoord;}",o="attribute vec3 a_vertCoord;attribute vec2 a_texCoord;uniform mat4 u_cubeMatrix;uniform mat4 u_perspMatrix;varying mediump vec2 v_texCoord;void main(void) {gl_Position = u_perspMatrix * u_cubeMatrix * vec4(a_vertCoord, 1.0);v_texCoord = a_texCoord;}",r="precision highp float;\nuniform float u_aspectRatio;\nuniform float u_psi;\nuniform float u_theta;\nuniform float u_f;\nuniform float u_h;\nuniform float u_v;\nuniform float u_vo;\nuniform float u_rot;\nconst float PI = 3.14159265358979323846264;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nuniform bool u_splitImage;\nuniform samplerCube u_imageCube;\nvarying vec2 v_texCoord;\nuniform vec4 u_backgroundColor;\nvoid main() {\nfloat x = v_texCoord.x * u_aspectRatio;\nfloat y = v_texCoord.y;\nfloat sinrot = sin(u_rot);\nfloat cosrot = cos(u_rot);\nfloat rot_x = x * cosrot - y * sinrot;\nfloat rot_y = x * sinrot + y * cosrot;\nfloat sintheta = sin(u_theta);\nfloat costheta = cos(u_theta);\nfloat a = u_f * costheta - rot_y * sintheta;\nfloat root = sqrt(rot_x * rot_x + a * a);\nfloat lambda = atan(rot_x / root, a / root) + u_psi;\nfloat phi = atan((rot_y * costheta + u_f * sintheta) / root);",s=r+"float cosphi = cos(phi);\ngl_FragColor = textureCube(u_imageCube, vec3(cosphi*sin(lambda), sin(phi), cosphi*cos(lambda)));\n}",h=r+"lambda = mod(lambda + PI, PI * 2.0) - PI;\nvec2 coord = vec2(lambda / PI, phi / (PI / 2.0));\nif(coord.x < -u_h || coord.x > u_h || coord.y < -u_v + u_vo || coord.y > u_v + u_vo)\ngl_FragColor = u_backgroundColor;\nelse {\nif(u_splitImage) {\nif(coord.x < 0.0)\ngl_FragColor = texture2D(u_image0, vec2((coord.x + u_h) / u_h, (-coord.y + u_v + u_vo) / (u_v * 2.0)));\nelse\ngl_FragColor = texture2D(u_image1, vec2((coord.x + u_h) / u_h - 1.0, (-coord.y + u_v + u_vo) / (u_v * 2.0)));\n} else {\ngl_FragColor = texture2D(u_image0, vec2((coord.x + u_h) / (u_h * 2.0), (-coord.y + u_v + u_vo) / (u_v * 2.0)));\n}\n}\n}",l="varying mediump vec2 v_texCoord;uniform sampler2D u_sampler;void main(void) {gl_FragColor = texture2D(u_sampler, v_texCoord);}";return{renderer:function(e,t,a){return new n(e,t)}}}(window,document),window.pannellum=function(e,t,a){function n(n,i){function o(){if((c=t.createElement("div")).innerHTML="\x3c!--[if lte IE 9]><i></i><![endif]--\x3e",1==c.getElementsByTagName("i").length)h();else{var n;if(re=J.hfov,se=J.pitch,"cubemap"==J.type){for(ne=[],c=0;6>c;c++)ne.push(new Image),ne[c].crossOrigin=J.crossOrigin;ze.load.lbox.style.display="block",ze.load.lbar.style.display="none"}else if("multires"==J.type)c=JSON.parse(JSON.stringify(J.multiRes)),J.basePath&&J.multiRes.basePath&&!/^(?:[a-z]+:)?\/\//i.test(J.multiRes.basePath)?c.basePath=J.basePath+J.multiRes.basePath:J.multiRes.basePath?c.basePath=J.multiRes.basePath:J.basePath&&(c.basePath=J.basePath),ne=c;else if(!0===J.dynamic)ne=J.panorama;else{if(J.panorama===a)return void h(J.strings.noPanoramaError);ne=new Image}if("cubemap"==J.type)for(var i=6,o=function(){0===--i&&s()},l=function(e){var a=t.createElement("a");a.href=e.target.src,a.textContent=a.href,h(J.strings.fileAccessError.replace("%s",a.outerHTML))},c=0;c<ne.length;c++)"null"==(n=J.cubeMap[c])?(console.log("Will use background instead of missing cubemap face "+c),o()):(J.basePath&&!r(n)&&(n=J.basePath+n),ne[c].onload=o,ne[c].onerror=l,ne[c].src=$(n));else if("multires"==J.type)s();else if(n="",J.basePath&&(n=J.basePath),!0!==J.dynamic){if(J.panorama instanceof Image||J.panorama instanceof ImageData||e.ImageBitmap&&J.panorama instanceof ImageBitmap)return ne=J.panorama,void s();n=r(J.panorama)?J.panorama:n+J.panorama,ne.onload=function(){e.URL.revokeObjectURL(this.src),s()},(le=new XMLHttpRequest).onloadend=function(){if(200!=le.status){var i=t.createElement("a");i.href=n,i.textContent=i.href,h(J.strings.fileAccessError.replace("%s",i.outerHTML))}else(function(n,i){var o=new FileReader;o.addEventListener("loadend",(function(){var r=o.result;navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)&&((0>(c=r.indexOf("ÿÂ"))||65536<c)&&h(J.strings.iOS8WebGLError));if(-1<(c=r.indexOf("<x:xmpmeta"))&&!0!==J.ignoreGPanoXMP){var s=r.substring(c,r.indexOf("</x:xmpmeta>")+12),l=function(e){var t;return 0<=s.indexOf(e+'="')?t=(t=s.substring(s.indexOf(e+'="')+e.length+2)).substring(0,t.indexOf('"')):0<=s.indexOf(e+">")&&(t=(t=s.substring(s.indexOf(e+">")+e.length+1)).substring(0,t.indexOf("<"))),t!==a?Number(t):null},c=(r=l("GPano:FullPanoWidthPixels"),l("GPano:CroppedAreaImageWidthPixels")),u=l("GPano:FullPanoHeightPixels"),d=l("GPano:CroppedAreaImageHeightPixels"),f=l("GPano:CroppedAreaTopPixels"),m=l("GPano:PoseHeadingDegrees"),p=l("GPano:PosePitchDegrees"),g=l("GPano:PoseRollDegrees"),v=l("GPano:InitialViewPitchDegrees"),w=l("GPano:InitialViewHeadingDegrees");l=l("GPano:InitialHorizontalFOVDegrees");null!==r&&null!==c&&null!==u&&null!==d&&null!==f&&(0>Ce.indexOf("haov")&&(J.haov=c/r*360),0>Ce.indexOf("vaov")&&(J.vaov=d/u*180),0>Ce.indexOf("vOffset")&&(J.vOffset=-180*((f+d/2)/u-.5)),null!==m&&0>Ce.indexOf("northOffset")&&(J.northOffset=m,!1!==J.compass&&(J.compass=!0)),null!==p&&null!==g&&(0>Ce.indexOf("horizonPitch")&&(J.horizonPitch=p),0>Ce.indexOf("horizonRoll")&&(J.horizonRoll=g)),null!=v&&0>Ce.indexOf("pitch")&&(J.pitch=v),null!=w&&0>Ce.indexOf("yaw")&&(J.yaw=w),null!=l&&0>Ce.indexOf("hfov")&&(J.hfov=l))}ne.src=e.URL.createObjectURL(n),ne.onerror=function(){(e.fetch?e.fetch(t.location.href).then((function(e){return e.headers.get("Content-Security-Policy")})):null).then((function(e){e&&e.split(";").find((function(e){if(e=e.match(/img-src(.*)/))return!e[1].includes("blob")}))&&(console.log("CSP blocks blobs; reverting to URL."),ne.crossOrigin=J.crossOrigin,ne.src=i)}))}})),o.readAsBinaryString!==a?o.readAsBinaryString(n):o.readAsText(n)})(this.response,n),ze.load.msg.innerHTML=""},le.onprogress=function(e){var t,a;e.lengthComputable?(ze.load.lbarFill.style.width=e.loaded/e.total*100+"%",1e6<e.total?(t="MB",a=(e.loaded/1e6).toFixed(2),e=(e.total/1e6).toFixed(2)):1e3<e.total?(t="kB",a=(e.loaded/1e3).toFixed(1),e=(e.total/1e3).toFixed(1)):(t="B",a=e.loaded,e=e.total),ze.load.msg.innerHTML=a+" / "+e+" "+t):(ze.load.lbox.style.display="block",ze.load.lbar.style.display="none")};try{le.open("GET",n,!0)}catch(e){h(J.strings.malformedURLError)}le.responseType="blob",le.setRequestHeader("Accept","image/*,*/*;q=0.9"),le.withCredentials="use-credentials"===J.crossOrigin,le.send()}J.draggable&&De.classList.add("pnlm-grab"),De.classList.remove("pnlm-grabbing"),Le=!0===J.dynamicUpdate,J.dynamic&&Le&&(ne=J.panorama,s())}}function r(e){return/^(?:[a-z]+:)?\/\//i.test(e)||"/"==e[0]||"blob:"==e.slice(0,5)}function s(){Q||(Q=new libpannellum.renderer(Oe)),be||(be=!0,Be.addEventListener("mousedown",d,!1),t.addEventListener("mousemove",p,!1),t.addEventListener("mouseup",g,!1),J.mouseZoom&&(De.addEventListener("mousewheel",E,!1),De.addEventListener("DOMMouseScroll",E,!1)),J.doubleClickZoom&&Be.addEventListener("dblclick",f,!1),n.addEventListener("mozfullscreenchange",z,!1),n.addEventListener("webkitfullscreenchange",z,!1),n.addEventListener("msfullscreenchange",z,!1),n.addEventListener("fullscreenchange",z,!1),"function"==typeof ResizeObserver?(he=new ResizeObserver(C)).observe(n):(e.addEventListener("resize",C,!1),e.addEventListener("orientationchange",C,!1)),J.disableKeyboardCtrl||(n.addEventListener("keydown",M,!1),n.addEventListener("keyup",I,!1),n.addEventListener("blur",P,!1)),t.addEventListener("mouseleave",g,!1),""===t.documentElement.style.pointerAction&&""===t.documentElement.style.touchAction?(Be.addEventListener("pointerdown",_,!1),Be.addEventListener("pointermove",b,!1),Be.addEventListener("pointerup",x,!1),Be.addEventListener("pointerleave",x,!1)):(Be.addEventListener("touchstart",v,!1),Be.addEventListener("touchmove",w,!1),Be.addEventListener("touchend",y,!1)),e.navigator.pointerEnabled&&(n.style.touchAction="none")),function(){try{var e={};J.horizonPitch!==a&&(e.horizonPitch=J.horizonPitch*Math.PI/180),J.horizonRoll!==a&&(e.horizonRoll=J.horizonRoll*Math.PI/180),J.backgroundColor!==a&&(e.backgroundColor=J.backgroundColor),Q.init(ne,J.type,J.haov*Math.PI/180,J.vaov*Math.PI/180,J.vOffset*Math.PI/180,F,e)}catch(e){if(!0!==J.dynamic&&(ne=a),"webgl error"==e.type||"no webgl"==e.type)h();else{if("webgl size error"!=e.type)throw h(J.strings.unknownError),e;h(J.strings.textureSizeError.replace("%s",e.width).replace("%s",e.maxWidth))}}}(),Y(J.hfov),setTimeout((function(){}),500)}function h(e){e===a&&(e=J.strings.genericWebGLError),ze.errorMsg.innerHTML="<p>"+e+"</p>",Ye.load.style.display="none",ze.load.box.style.display="none",ze.errorMsg.style.display="table",_e=!0,ae=a,Oe.style.display="none",K("error",e)}function l(e){ze.interactionMsg.style.opacity=1,ze.interactionMsg.innerHTML="<p>"+e+"</p>",ze.interactionMsg.style.display="table",K("messageshown"),clearTimeout(ze.interactionMsg.timeout),ze.interactionMsg.removeEventListener("transitionend",c),ze.interactionMsg.timeout=setTimeout((function(){ze.interactionMsg.style.opacity=0,ze.interactionMsg.addEventListener("transitionend",c)}),2e3)}function c(){ze.interactionMsg.style.opacity=0,ze.interactionMsg.style.display="none",K("messagecleared")}function u(e){var t=n.getBoundingClientRect(),a={};return a.x=(e.clientX||e.pageX)-t.left,a.y=(e.clientY||e.pageY)-t.top,a}function d(e){if(e.preventDefault(),n.focus(),ae&&J.draggable&&!J.draggingHotSpot){var t=u(e);if(J.hotSpotDebug){var a=m(e);console.log("Pitch: "+a[0]+", Yaw: "+a[1]+", Center Pitch: "+J.pitch+", Center Yaw: "+J.yaw+", HFOV: "+J.hfov)}q(),W(),J.roll=0,xe.hfov=0,ue=!0,de=Date.now(),fe=t.x,me=t.y,ge=J.yaw,ve=J.pitch,De.classList.add("pnlm-grabbing"),De.classList.remove("pnlm-grab"),K("mousedown",e),L()}}function f(e){J.minHfov===J.hfov?ce.setHfov(re,1e3):(e=m(e),ce.lookAt(e[0],e[1],J.minHfov,1e3))}function m(e){var t=u(e),a=(e=Q.getCanvas()).clientWidth,n=e.clientHeight;e=t.x/a*2-1;n=(1-t.y/n*2)*n/a;var i=1/Math.tan(J.hfov*Math.PI/360),o=Math.sin(J.pitch*Math.PI/180),r=Math.cos(J.pitch*Math.PI/180);t=i*r-n*o,a=Math.sqrt(e*e+t*t),n=180*Math.atan((n*r+i*o)/a)/Math.PI;return-180>(e=180*Math.atan2(e/a,t/a)/Math.PI+J.yaw)&&(e+=360),180<e&&(e-=360),[n,e]}function p(e){if(te)O(te,e);else if(ue&&ae){de=Date.now();var t=(a=Q.getCanvas()).clientWidth,a=a.clientHeight;e=u(e);var n=180*(Math.atan(fe/t*2-1)-Math.atan(e.x/t*2-1))/Math.PI*J.hfov/90+ge;xe.yaw=(n-J.yaw)%360*.2,J.yaw=n,t=360*Math.atan(Math.tan(J.hfov/360*Math.PI)*a/t)/Math.PI,t=180*(Math.atan(e.y/a*2-1)-Math.atan(me/a*2-1))/Math.PI*t/90+ve,xe.pitch=.2*(t-J.pitch),J.pitch=t}}function g(e){te&&te.dragHandlerFunc&&te.dragHandlerFunc(e,te.dragHandlerArgs),te=null,ue&&(ue=!1,15<Date.now()-de&&(xe.pitch=xe.yaw=0),De.classList.add("pnlm-grab"),De.classList.remove("pnlm-grabbing"),de=Date.now(),K("mouseup",e))}function v(e){if(ae&&J.draggable&&!te){q(),W(),J.roll=0,xe.hfov=0;var t=u(e.targetTouches[0]);if(fe=t.x,me=t.y,2==e.targetTouches.length){var a=u(e.targetTouches[1]);fe+=.5*(a.x-t.x),me+=.5*(a.y-t.y),pe=Math.sqrt((t.x-a.x)*(t.x-a.x)+(t.y-a.y)*(t.y-a.y))}ue=!0,de=Date.now(),ge=J.yaw,ve=J.pitch,K("touchstart",e),L()}}function w(e){if(J.draggable&&(J.dragConfirm||e.preventDefault(),ae&&(de=Date.now()),ue&&ae)){var t=(i=u(e.targetTouches[0])).x,a=i.y;if(2==e.targetTouches.length&&-1!=pe){var n=u(e.targetTouches[1]),i=(t=t+.5*(n.x-i.x),a=a+.5*(n.y-i.y),Math.sqrt((i.x-n.x)*(i.x-n.x)+(i.y-n.y)*(i.y-n.y)));Y(J.hfov+.1*(pe-i)),pe=i}i=J.hfov/360*J.touchPanSpeedCoeffFactor,ye||"both"!=J.dragConfirm&&"yaw"!=J.dragConfirm||2==e.targetTouches.length?(t=(fe-t)*i+ge,xe.yaw=(t-J.yaw)%360*.2,J.yaw=t):fe!=t&&("yaw"==J.dragConfirm?l(J.strings.twoTouchXActivate):l(J.strings.twoTouchActivate)),ye||"both"!=J.dragConfirm&&"pitch"!=J.dragConfirm||2==e.targetTouches.length?(a=(a-me)*i+ve,xe.pitch=.2*(a-J.pitch),J.pitch=a):me!=a&&("pitch"==J.dragConfirm?l(J.strings.twoTouchYActivate):l(J.strings.twoTouchActivate)),"yaw"!=J.dragConfirm&&"pitch"!=J.dragConfirm&&"both"!=J.dragConfirm||2!=e.targetTouches.length||(c(),e.preventDefault())}}function y(){te=null,ue=!1,150<Date.now()-de&&(xe.pitch=xe.yaw=0),pe=-1,de=Date.now(),K("touchend",event)}function _(e){"touch"==e.pointerType&&ae&&J.draggable&&(Xe.push(e.pointerId),We.push({clientX:e.clientX,clientY:e.clientY}),e.targetTouches=We,v(e),e.preventDefault())}function b(e){if("touch"==e.pointerType)if(te)O(te,e);else if(J.draggable)for(var t=0;t<Xe.length;t++)if(e.pointerId==Xe[t]){We[t].clientX=e.clientX,We[t].clientY=e.clientY,e.targetTouches=We,w(e),e.preventDefault();break}}function x(e){if(te&&te.dragHandlerFunc&&te.dragHandlerFunc(e,te.dragHandlerArgs),te=null,"touch"==e.pointerType){for(var t=!1,n=0;n<Xe.length;n++)e.pointerId==Xe[n]&&(Xe[n]=a),Xe[n]&&(t=!0);t||(Xe=[],We=[],y()),e.preventDefault()}}function E(e){ae&&("fullscreenonly"!=J.mouseZoom||ye)&&(ye||"ctrl"!=J.mouseZoom||e.ctrlKey?(c(),e.preventDefault(),q(),de=Date.now(),e.wheelDeltaY?(Y(J.hfov-.05*e.wheelDeltaY),xe.hfov=0>e.wheelDelta?1:-1):e.wheelDelta?(Y(J.hfov-.05*e.wheelDelta),xe.hfov=0>e.wheelDelta?1:-1):e.detail&&(Y(J.hfov+1.5*e.detail),xe.hfov=0<e.detail?1:-1),L()):(e=-1!=navigator.platform.indexOf("Mac")?"control":"ctrl",l(J.strings.ctrlZoomActivate.replace("%s",'<kbd class="pnlm-outline">'+e+"</kbd>"))))}function M(e){q(),de=Date.now(),W(),J.roll=0;var t=e.which||e.keycode;0>J.capturedKeyNumbers.indexOf(t)||!(ye||16!=t&&17!=t||"ctrl"!=J.mouseZoom)||(e.preventDefault(),27==t?ye&&H():T(t,!0))}function P(){for(var e=0;10>e;e++)we[e]=!1}function I(e){var t=e.which||e.keycode;0>J.capturedKeyNumbers.indexOf(t)||(e.preventDefault(),T(t,!1))}function T(e,t){var a=!1;switch(e){case 109:case 189:case 17:case 173:we[0]!=t&&(a=!0),we[0]=t;break;case 107:case 187:case 16:case 61:we[1]!=t&&(a=!0),we[1]=t;break;case 38:we[2]!=t&&(a=!0),we[2]=t;break;case 87:we[6]!=t&&(a=!0),we[6]=t;break;case 40:we[3]!=t&&(a=!0),we[3]=t;break;case 83:we[7]!=t&&(a=!0),we[7]=t;break;case 37:we[4]!=t&&(a=!0),we[4]=t;break;case 65:we[8]!=t&&(a=!0),we[8]=t;break;case 39:we[5]!=t&&(a=!0),we[5]=t;break;case 68:we[9]!=t&&(a=!0),we[9]=t}a&&t&&(ie="undefined"!=typeof performance&&performance.now()?performance.now():Date.now(),L())}function R(e){var t=Te[e],a=Math.min(1,Math.max((Date.now()-t.startTime)/1e3/(t.duration/1e3),0));a=t.startPosition+J.animationTimingFunction(a)*(t.endPosition-t.startPosition);(t.endPosition>t.startPosition&&a>=t.endPosition||t.endPosition<t.startPosition&&a<=t.endPosition||t.endPosition===t.startPosition)&&(a=t.endPosition,xe[e]=0,delete Te[e]),J[e]=a}function C(){z("resize")}function L(){Ee||(Ee=!0,A())}function A(){if(!Ne)if(function(){var e;if(ae){var t=Q.getCanvas();!1!==J.autoRotate&&(360<J.yaw?J.yaw-=360:-360>J.yaw&&(J.yaw+=360)),e=J.yaw;var n=0;if(J.avoidShowingBackground){var i=J.hfov/2,o=180*Math.atan2(Math.tan(i/180*Math.PI),t.width/t.height)/Math.PI;J.vaov>J.haov?Math.min(Math.cos((J.pitch-i)/180*Math.PI),Math.cos((J.pitch+i)/180*Math.PI)):n=i*(1-Math.min(Math.cos((J.pitch-o)/180*Math.PI),Math.cos((J.pitch+o)/180*Math.PI)))}o=-180;var r=180;360>(i=J.maxYaw-J.minYaw)&&(o=J.minYaw+J.hfov/2+n,r=J.maxYaw-J.hfov/2-n,i<J.hfov&&(o=r=(o+r)/2),J.yaw=Math.max(o,Math.min(r,J.yaw))),!1===J.autoRotate&&(360<J.yaw?J.yaw-=360:-360>J.yaw&&(J.yaw+=360)),!1!==J.autoRotate&&e!=J.yaw&&ie!==a&&(J.autoRotate*=-1),e=2*Math.atan(Math.tan(J.hfov/180*Math.PI*.5)/(t.width/t.height))/Math.PI*180,t=J.minPitch+e/2,n=J.maxPitch-e/2,J.maxPitch-J.minPitch<e&&(t=n=(t+n)/2),isNaN(t)&&(t=-90),isNaN(n)&&(n=90),J.pitch=Math.max(t,Math.min(n,J.pitch)),Q.render(J.pitch*Math.PI/180,J.yaw*Math.PI/180,J.hfov*Math.PI/180,{roll:J.roll*Math.PI/180,dynamic:Le}),Ae&&(Ae=Le=!1),J.hotSpots.forEach(B),J.compass&&(Ve.style.transform="rotate("+(-J.yaw-J.northOffset)+"deg)",Ve.style.webkitTransform="rotate("+(-J.yaw-J.northOffset)+"deg)")}}(),oe&&clearTimeout(oe),ue||!0===Me)requestAnimationFrame(A);else if(we[0]||we[1]||we[2]||we[3]||we[4]||we[5]||we[6]||we[7]||we[8]||we[9]||J.autoRotate||Te.pitch||Te.yaw||Te.hfov||.01<Math.abs(xe.yaw)||.01<Math.abs(xe.pitch)||.01<Math.abs(xe.hfov))(function(){if(ae){var e,t=!1,n=J.pitch,i=J.yaw,o=J.hfov;e="undefined"!=typeof performance&&performance.now()?performance.now():Date.now(),ie===a&&(ie=e);var r=(e-ie)*J.hfov/1200;if(r=Math.min(r,10),we[0]&&!0===J.keyboardZoom&&(Y(J.hfov+(.8*xe.hfov+.4)*r),t=!0),we[1]&&!0===J.keyboardZoom&&(Y(J.hfov+(.8*xe.hfov-.2)*r),t=!0),(we[2]||we[6])&&(J.pitch+=(.8*xe.pitch+.2)*r,t=!0),(we[3]||we[7])&&(J.pitch+=(.8*xe.pitch-.2)*r,t=!0),(we[4]||we[8])&&(J.yaw+=(.8*xe.yaw-.2)*r,t=!0),(we[5]||we[9])&&(J.yaw+=(.8*xe.yaw+.2)*r,t=!0),t&&(de=Date.now()),J.autoRotate){if(.001<e-ie){t=(e-ie)/1e3;var s=(xe.yaw/t*r-.2*J.autoRotate)*t;s=(0<-J.autoRotate?1:-1)*Math.min(Math.abs(J.autoRotate*t),Math.abs(s)),J.yaw+=s}J.autoRotateStopDelay&&(J.autoRotateStopDelay-=e-ie,0>=J.autoRotateStopDelay&&(J.autoRotateStopDelay=!1,Ie=J.autoRotate,J.autoRotate=0))}Te.pitch&&(R("pitch"),n=J.pitch),Te.yaw&&(R("yaw"),i=J.yaw),Te.hfov&&(R("hfov"),o=J.hfov),0<r&&!J.autoRotate&&(t=1-J.friction,we[4]||we[5]||we[8]||we[9]||Te.yaw||(J.yaw+=xe.yaw*r*t),we[2]||we[3]||we[6]||we[7]||Te.pitch||(J.pitch+=xe.pitch*r*t),we[0]||we[1]||Te.hfov||(90<J.hfov&&(t*=1-(J.hfov-90)/90),Y(J.hfov+xe.hfov*r*t))),ie=e,0<r&&(xe.yaw=.8*xe.yaw+(J.yaw-i)/r*.2,xe.pitch=.8*xe.pitch+(J.pitch-n)/r*.2,xe.hfov=.8*xe.hfov+(J.hfov-o)/r*.2,n=J.autoRotate?Math.abs(J.autoRotate):5,xe.yaw=Math.min(n,Math.max(xe.yaw,-n)),xe.pitch=Math.min(n,Math.max(xe.pitch,-n)),xe.hfov=Math.min(n,Math.max(xe.hfov,-n))),we[0]&&we[1]&&(xe.hfov=0),(we[2]||we[6])&&(we[3]||we[7])&&(xe.pitch=0),(we[4]||we[8])&&(we[5]||we[9])&&(xe.yaw=0)}})(),0<=J.autoRotateInactivityDelay&&Ie&&Date.now()-de>J.autoRotateInactivityDelay&&!J.autoRotate&&(J.autoRotate=Ie,ce.lookAt(se,a,re,3e3)),requestAnimationFrame(A);else if(Q&&(Q.isLoading()||!0===J.dynamic&&Le))requestAnimationFrame(A);else{ce.getPitch&&ce.getYaw&&ce.getHfov&&K("animatefinished",{pitch:ce.getPitch(),yaw:ce.getYaw(),hfov:ce.getHfov()}),Ee=!1,ie=a;var e=J.autoRotateInactivityDelay-(Date.now()-de);0<e?oe=setTimeout((function(){J.autoRotate=Ie,ce.lookAt(se,a,re,3e3),L()}),e):0<=J.autoRotateInactivityDelay&&Ie&&(J.autoRotate=Ie,ce.lookAt(se,a,re,3e3),L())}}function S(e,t,a,n){this.w=e,this.x=t,this.y=a,this.z=n}function N(t){var a;a=t.alpha;var n=t.beta;t=t.gamma,n=[n?n*Math.PI/180/2:0,t?t*Math.PI/180/2:0,a?a*Math.PI/180/2:0],a=[Math.cos(n[0]),Math.cos(n[1]),Math.cos(n[2])],n=[Math.sin(n[0]),Math.sin(n[1]),Math.sin(n[2])],a=(a=new S(a[0]*a[1]*a[2]-n[0]*n[1]*n[2],n[0]*a[1]*a[2]-a[0]*n[1]*n[2],a[0]*n[1]*a[2]+n[0]*a[1]*n[2],a[0]*a[1]*n[2]+n[0]*n[1]*a[2])).multiply(new S(Math.sqrt(.5),-Math.sqrt(.5),0,0)),n=e.orientation?-e.orientation*Math.PI/180/2:0,a=a.multiply(new S(Math.cos(n),0,-Math.sin(n),0)).toEulerAngles(),"number"==typeof Me&&10>Me?Me+=1:10===Me?(Pe=a[2]/Math.PI*180+J.yaw,Me=!0,requestAnimationFrame(A)):(J.pitch=a[0]/Math.PI*180,J.roll=-a[1]/Math.PI*180,J.yaw=-a[2]/Math.PI*180+Pe)}function F(){if(J.sceneFadeDuration&&Q.fadeImg!==a){Q.fadeImg.style.opacity=0;var e=Q.fadeImg;delete Q.fadeImg,setTimeout((function(){Oe.removeChild(e),K("scenechangefadedone")}),J.sceneFadeDuration)}Ve.style.display=J.compass?"inline":"none",Se||(J.hotSpots?(J.hotSpots=J.hotSpots.sort((function(e,t){return e.pitch<t.pitch})),J.hotSpots.forEach(D)):J.hotSpots=[],Se=!0,J.hotSpots.forEach(B)),ze.load.box.style.display="none",ee!==a&&(Oe.removeChild(ee),ee=a),ae=!0,!0!==J.dynamic&&(ne=a),L(),K("load")}function D(e){e.pitch=Number(e.pitch)||0,e.yaw=Number(e.yaw)||0;var a=t.createElement("div");a.tabIndex=-1,a.className="pnlm-hotspot-base",a.className=e.cssClass?a.className+" "+e.cssClass:a.className+" pnlm-hotspot pnlm-sprite pnlm-"+j(e.type);var n,i=t.createElement("span");if(e.text&&(i.innerHTML=j(e.text)),e.video){n=t.createElement("video");var o=e.video;J.basePath&&!r(o)&&(o=J.basePath+o),n.src=$(o),n.controls=!0,n.style.width=e.width+"px",De.appendChild(a),i.appendChild(n)}else if(e.image){o=e.image,J.basePath&&!r(o)&&(o=J.basePath+o),(n=t.createElement("a")).href=$(e.URL?e.URL:o,!0),J.targetBlank&&(n.target="_blank",n.rel="noopener"),i.appendChild(n);var s=t.createElement("img");s.src=$(o),s.style.width=e.width+"px",s.style.paddingTop="5px",De.appendChild(a),n.appendChild(s),i.style.maxWidth="initial"}else if(e.URL){if((n=t.createElement("a")).href=$(e.URL,!0),e.attributes)for(o in e.attributes)n.setAttribute(o,e.attributes[o]);else J.targetBlank&&(n.target="_blank",n.rel="noopener");De.appendChild(n),a.className+=" pnlm-pointer",i.className+=" pnlm-pointer",n.appendChild(a)}else e.sceneId&&(a.onclick=function(){return a.clicked||(a.clicked=!0,X(e.sceneId,e.targetPitch,e.targetYaw,e.targetHfov)),!1},a.className+=" pnlm-pointer",i.className+=" pnlm-pointer"),De.appendChild(a);e.createTooltipFunc?e.createTooltipFunc(a,e.createTooltipArgs):(e.text||e.video||e.image)&&(a.classList.add("pnlm-tooltip"),a.appendChild(i),i.style.width=i.scrollWidth-20+"px",i.style.marginLeft=-(i.scrollWidth-a.offsetWidth)/2+"px",i.style.marginTop=-i.scrollHeight-12+"px"),e.clickHandlerFunc&&(a.addEventListener("click",(function(t){e.clickHandlerFunc(t,e.clickHandlerArgs)}),"false"),""===t.documentElement.style.pointerAction&&""===t.documentElement.style.touchAction?a.addEventListener("pointerup",(function(t){e.clickHandlerFunc(t,e.clickHandlerArgs)}),!1):a.addEventListener("touchend",(function(t){e.clickHandlerFunc(t,e.clickHandlerArgs)}),!1),a.className+=" pnlm-pointer",i.className+=" pnlm-pointer"),e.draggable&&(a.addEventListener("mousedown",(function(t){e.dragHandlerFunc&&e.dragHandlerFunc(t,e.dragHandlerArgs),te=e})),""===t.documentElement.style.pointerAction&&""===t.documentElement.style.touchAction&&a.addEventListener("pointerdown",(function(t){e.dragHandlerFunc&&e.dragHandlerFunc(t,e.dragHandlerArgs),te=e})),a.addEventListener("touchmove",(function(t){O(e,t.targetTouches[0])})),a.addEventListener("touchend",(function(t){e.dragHandlerFunc&&e.dragHandlerFunc(t,e.dragHandlerArgs),te=null}))),e.div=a}function O(e,t){var a=m(t);e.pitch=a[0],e.yaw=a[1],B(e)}function B(e){var t=Math.sin(e.pitch*Math.PI/180),a=Math.cos(e.pitch*Math.PI/180),n=Math.sin(J.pitch*Math.PI/180),i=Math.cos(J.pitch*Math.PI/180),o=Math.cos((-e.yaw+J.yaw)*Math.PI/180),r=t*n+a*o*i;if(90>=e.yaw&&-90<e.yaw&&0>=r||(90<e.yaw||-90>=e.yaw)&&0>=r)e.div.style.visibility="hidden";else{var s=Math.sin((-e.yaw+J.yaw)*Math.PI/180),h=Math.tan(J.hfov*Math.PI/360);e.div.style.visibility="visible";var l=(c=Q.getCanvas()).clientWidth,c=c.clientHeight;t=[-l/h*s*a/r/2,-l/h*(t*i-a*o*n)/r/2],a=Math.sin(J.roll*Math.PI/180),n=Math.cos(J.roll*Math.PI/180);(t=[t[0]*n-t[1]*a,t[0]*a+t[1]*n])[0]+=(l-e.div.offsetWidth)/2,t[1]+=(c-e.div.offsetHeight)/2,l="translate("+t[0]+"px, "+t[1]+"px) translateZ(9999px) rotate("+J.roll+"deg)",e.scale&&(l="number"==typeof e.scale?l+" scale("+e.scale+")":l+" scale("+re/J.hfov/r+")"),e.div.style.webkitTransform=l,e.div.style.MozTransform=l,e.div.style.transform=l}}function U(e){J={};var t,a,n="haov vaov vOffset northOffset horizonPitch horizonRoll".split(" ");for(t in Ce=[],Fe)Fe.hasOwnProperty(t)&&(J[t]=Fe[t]);for(t in i.default)if(i.default.hasOwnProperty(t))if("strings"==t)for(a in i.default.strings)i.default.strings.hasOwnProperty(a)&&(J.strings[a]=j(i.default.strings[a]));else J[t]=i.default[t],0<=n.indexOf(t)&&Ce.push(t);if(null!==e&&""!==e&&i.scenes&&i.scenes[e]){var o=i.scenes[e];for(t in o)if(o.hasOwnProperty(t))if("strings"==t)for(a in o.strings)o.strings.hasOwnProperty(a)&&(J.strings[a]=j(o.strings[a]));else J[t]=o[t],0<=n.indexOf(t)&&Ce.push(t);J.scene=e}for(t in i)if(i.hasOwnProperty(t))if("strings"==t)for(a in i.strings)i.strings.hasOwnProperty(a)&&(J.strings[a]=j(i.strings[a]));else J[t]=i[t],0<=n.indexOf(t)&&Ce.push(t)}function k(e){if((e=e||!1)&&"preview"in J){var n=J.preview;J.basePath&&!r(n)&&(n=J.basePath+n),(ee=t.createElement("div")).className="pnlm-preview-img",ee.style.backgroundImage="url('"+$(n).replace(/"/g,"%22").replace(/'/g,"%27")+"')",Oe.appendChild(ee)}n=J.title;var i=J.author;for(var s in e&&("previewTitle"in J&&(J.title=J.previewTitle),"previewAuthor"in J&&(J.author=J.previewAuthor)),J.hasOwnProperty("title")||(ze.title.innerHTML=""),J.hasOwnProperty("author")||(ze.author.innerHTML=""),J.hasOwnProperty("title")||J.hasOwnProperty("author")||(ze.container.style.display="none"),J.targetBlank&&(ke.rel="noopener",ke.target="_blank"),Ye.load.innerHTML="<div><p>"+J.strings.loadButtonLabel+"</p></div>",ze.load.boxp.innerHTML=J.strings.loadingLabel,J)if(J.hasOwnProperty(s))switch(s){case"title":ze.title.innerHTML=j(J[s]),ze.container.style.display="inline";break;case"author":var h=j(J[s]);J.authorURL&&((h=t.createElement("a")).href=$(J.authorURL,!0),J.targetBlank&&(h.target="_blank",h.rel="noopener"),h.innerHTML=j(J[s]),h=h.outerHTML),ze.author.innerHTML=J.strings.bylineLabel.replace("%s",h),ze.container.style.display="inline";break;case"hfov":Y(Number(J[s]));break;case"autoLoad":!0===J[s]&&Q===a&&(ze.load.box.style.display="inline",Ye.load.style.display="none",o());break;case"showZoomCtrl":Ye.zoom.style.display=J[s]&&0!=J.showControls?"block":"none";break;case"showFullscreenCtrl":Ye.fullscreen.style.display=J[s]&&0!=J.showControls&&("fullscreen"in t||"mozFullScreen"in t||"webkitIsFullScreen"in t||"msFullscreenElement"in t)?"block":"none";break;case"hotSpotDebug":Ge.style.display=J[s]?"block":"none";break;case"showControls":J[s]||(Ye.orientation.style.display="none",Ye.zoom.style.display="none",Ye.fullscreen.style.display="none");break;case"orientationOnByDefault":J[s]&&Z()}e&&(n?J.title=n:delete J.title,i?J.author=i:delete J.author)}function H(){if(ae&&!_e)if(ye)t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitCancelFullScreen?t.webkitCancelFullScreen():t.msExitFullscreen&&t.msExitFullscreen();else try{n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.msRequestFullscreen?n.msRequestFullscreen():n.webkitRequestFullScreen()}catch(e){}}function z(e){t.fullscreenElement||t.fullscreen||t.mozFullScreen||t.webkitIsFullScreen||t.msFullscreenElement?(Ye.fullscreen.classList.add("pnlm-fullscreen-toggle-button-active"),ye=!0):(Ye.fullscreen.classList.remove("pnlm-fullscreen-toggle-button-active"),ye=!1),"resize"!==e&&K("fullscreenchange",ye),Q.resize(),Y(J.hfov),L()}function G(e){var t=J.minHfov;if("multires"==J.type&&Q&&!J.multiResMinHfov&&(t=Math.min(t,Q.getCanvas().width/(J.multiRes.cubeResolution/90*.9))),t>J.maxHfov)return console.log("HFOV bounds do not make sense (minHfov > maxHfov)."),J.hfov;var a=J.hfov;a=e<t?t:e>J.maxHfov?J.maxHfov:e;return J.avoidShowingBackground&&Q&&!isNaN(J.maxPitch-J.minPitch)&&(e=Q.getCanvas(),a=Math.min(a,360*Math.atan(Math.tan((J.maxPitch-J.minPitch)/360*Math.PI)/e.height*e.width)/Math.PI)),a}function Y(e){J.hfov=G(e),K("zoomchange",J.hfov)}function q(){Te={},Ie=J.autoRotate?J.autoRotate:Ie,J.autoRotate=!1}function V(){_e&&(ze.load.box.style.display="none",ze.errorMsg.style.display="none",_e=!1,Oe.style.display="block",K("errorcleared")),ae=!1,c(),Ye.load.style.display="none",ze.load.box.style.display="inline",o()}function X(e,n,o,r,s){var h,l,c;if(ae||(s=!0),ae=!1,Te={},J.sceneFadeDuration&&!s&&(s=Q.render(J.pitch*Math.PI/180,J.yaw*Math.PI/180,J.hfov*Math.PI/180,{returnImage:"ImageBitmap"}))!==a)return(h=s.then?t.createElement("canvas"):new Image).className="pnlm-fade-img",h.style.transition="opacity "+J.sceneFadeDuration/1e3+"s",h.style.width="100%",h.style.height="100%",s.then?s.then((function(t){h.width=t.width,h.height=t.height,h.getContext("2d").drawImage(t,0,0),X(e,n,o,r,!0)})):(h.onload=function(){X(e,n,o,r,!0)},h.src=s),Oe.appendChild(h),void(Q.fadeImg=h);s="same"===n?J.pitch:n,l="same"===o?J.yaw:"sameAzimuth"===o?J.yaw+(J.northOffset||0)-(i.scenes[e].northOffset||0):o,c="same"===r?J.hfov:r,function(){var e=J.hotSpots;if(Se=!1,delete J.hotSpots,e)for(var t=0;t<e.length;t++){var a=e[t].div;if(a){for(;a.parentNode&&a.parentNode!=De;)a=a.parentNode;De.removeChild(a)}delete e[t].div}}(),U(e),xe.yaw=xe.pitch=xe.hfov=0,k(),s!==a&&(J.pitch=s),l!==a&&(J.yaw=l),c!==a&&(J.hfov=c),K("scenechange",e),V()}function W(){e.removeEventListener("deviceorientation",N),Ye.orientation.classList.remove("pnlm-orientation-button-active"),Me=!1}function Z(){qe&&("undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((function(t){"granted"==t&&(Me=1,e.addEventListener("deviceorientation",N),Ye.orientation.classList.add("pnlm-orientation-button-active"))})):(Me=1,e.addEventListener("deviceorientation",N),Ye.orientation.classList.add("pnlm-orientation-button-active")))}function j(e){return i.escapeHTML?String(e).split(/&/g).join("&amp;").split('"').join("&quot;").split("'").join("&#39;").split("<").join("&lt;").split(">").join("&gt;").split("/").join("&#x2f;").split("\n").join("<br>"):String(e).split("\n").join("<br>")}function $(e,t){try{var a=decodeURIComponent(function(e){return e.replace(/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,(function(e,t){return"colon"===(t=t.toLowerCase())?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""}))}(e)).replace(/[^\w:]/g,"").toLowerCase()}catch(e){return"about:blank"}return 0===a.indexOf("javascript:")||0===a.indexOf("vbscript:")?(console.log("Script URL removed."),"about:blank"):t&&0===a.indexOf("data:")?(console.log("Data URI removed from link."),"about:blank"):e}function K(e){if(e in Re)for(var t=Re[e].length;0<t;t--)Re[e][Re[e].length-t].apply(null,[].slice.call(arguments,1))}var J,Q,ee,te,ae,ne,ie,oe,re,se,he,le,ce=this,ue=!1,de=Date.now(),fe=0,me=0,pe=-1,ge=0,ve=0,we=Array(10),ye=!1,_e=!1,be=!1,xe={yaw:0,pitch:0,hfov:0},Ee=!1,Me=!1,Pe=0,Ie=0,Te={},Re={},Ce=[],Le=!1,Ae=!1,Se=!1,Ne=!1,Fe={hfov:100,minHfov:50,multiResMinHfov:!1,maxHfov:120,pitch:0,minPitch:a,maxPitch:a,yaw:0,minYaw:-180,maxYaw:180,roll:0,haov:360,vaov:180,vOffset:0,autoRotate:!1,autoRotateInactivityDelay:-1,autoRotateStopDelay:a,type:"equirectangular",northOffset:0,showFullscreenCtrl:!0,dynamic:!1,dynamicUpdate:!1,doubleClickZoom:!0,keyboardZoom:!0,mouseZoom:!0,showZoomCtrl:!0,autoLoad:!1,showControls:!0,orientationOnByDefault:!1,hotSpotDebug:!1,backgroundColor:[0,0,0],avoidShowingBackground:!1,animationTimingFunction:function(e){return.5>e?2*e*e:(4-2*e)*e-1},draggable:!0,dragConfirm:!1,disableKeyboardCtrl:!1,crossOrigin:"anonymous",targetBlank:!1,touchPanSpeedCoeffFactor:1,capturedKeyNumbers:[16,17,27,37,38,39,40,61,65,68,83,87,107,109,173,187,189],friction:.15,strings:{loadButtonLabel:"Click to<br>Load<br>Panorama",loadingLabel:"Loading...",bylineLabel:"by %s",noPanoramaError:"No panorama image was specified.",fileAccessError:"The file %s could not be accessed.",malformedURLError:"There is something wrong with the panorama URL.",iOS8WebGLError:"Due to iOS 8's broken WebGL implementation, only progressive encoded JPEGs work for your device (this panorama uses standard encoding).",genericWebGLError:"Your browser does not have the necessary WebGL support to display this panorama.",textureSizeError:"This panorama is too big for your device! It's %spx wide, but your device only supports images up to %spx wide. Try another device. (If you're the author, try scaling down the image.)",unknownError:"Unknown error. Check developer console.",twoTouchActivate:"Use two fingers together to pan the panorama.",twoTouchXActivate:"Use two fingers together to pan the panorama horizontally.",twoTouchYActivate:"Use two fingers together to pan the panorama vertically.",ctrlZoomActivate:"Use %s + scroll to zoom the panorama."}};(n="string"==typeof n?t.getElementById(n):n).classList.add("pnlm-container"),n.tabIndex=0;var De=t.createElement("div");De.className="pnlm-ui",n.appendChild(De);var Oe=t.createElement("div");Oe.className="pnlm-render-container",n.appendChild(Oe);var Be=t.createElement("div");Be.className="pnlm-dragfix",De.appendChild(Be);var Ue=t.createElement("span");Ue.className="pnlm-about-msg";var ke=t.createElement("a");ke.href="https://pannellum.org/",ke.textContent="Pannellum",Ue.appendChild(ke);var He=t.createElement("span");He.textContent=" 6175668",Ue.appendChild(He),De.appendChild(Ue),Be.addEventListener("contextmenu",(function e(t){var a=u(t);Ue.style.left=a.x+"px",Ue.style.top=a.y+"px",clearTimeout(e.t1),clearTimeout(e.t2),Ue.style.display="block",Ue.style.opacity=1,e.t1=setTimeout((function(){Ue.style.opacity=0}),2e3),e.t2=setTimeout((function(){Ue.style.display="none"}),2500),t.preventDefault()}));var ze={},Ge=t.createElement("div");Ge.className="pnlm-sprite pnlm-hot-spot-debug-indicator",De.appendChild(Ge),ze.container=t.createElement("div"),ze.container.className="pnlm-panorama-info",ze.title=t.createElement("div"),ze.title.className="pnlm-title-box",ze.container.appendChild(ze.title),ze.author=t.createElement("div"),ze.author.className="pnlm-author-box",ze.container.appendChild(ze.author),De.appendChild(ze.container),ze.load={},ze.load.box=t.createElement("div"),ze.load.box.className="pnlm-load-box",ze.load.boxp=t.createElement("p"),ze.load.box.appendChild(ze.load.boxp),ze.load.lbox=t.createElement("div"),ze.load.lbox.className="pnlm-lbox",ze.load.lbox.innerHTML='<div class="pnlm-loading"></div>',ze.load.box.appendChild(ze.load.lbox),ze.load.lbar=t.createElement("div"),ze.load.lbar.className="pnlm-lbar",ze.load.lbarFill=t.createElement("div"),ze.load.lbarFill.className="pnlm-lbar-fill",ze.load.lbar.appendChild(ze.load.lbarFill),ze.load.box.appendChild(ze.load.lbar),ze.load.msg=t.createElement("p"),ze.load.msg.className="pnlm-lmsg",ze.load.box.appendChild(ze.load.msg),De.appendChild(ze.load.box),ze.errorMsg=t.createElement("div"),ze.errorMsg.className="pnlm-error-msg pnlm-info-box",De.appendChild(ze.errorMsg),ze.interactionMsg=t.createElement("div"),ze.interactionMsg.className="pnlm-interaction-msg pnlm-info-box",De.appendChild(ze.interactionMsg);var Ye={};Ye.container=t.createElement("div"),Ye.container.className="pnlm-controls-container",De.appendChild(Ye.container),Ye.load=t.createElement("button"),Ye.load.className="pnlm-load-button",Ye.load.addEventListener("click",(function(){k(),V()})),De.appendChild(Ye.load),Ye.zoom=t.createElement("div"),Ye.zoom.className="pnlm-zoom-controls pnlm-controls",Ye.zoomIn=t.createElement("div"),Ye.zoomIn.className="pnlm-zoom-in pnlm-sprite pnlm-control",Ye.zoomIn.addEventListener("click",(function(){ae&&(Y(J.hfov-5),L())})),Ye.zoom.appendChild(Ye.zoomIn),Ye.zoomOut=t.createElement("div"),Ye.zoomOut.className="pnlm-zoom-out pnlm-sprite pnlm-control",Ye.zoomOut.addEventListener("click",(function(){ae&&(Y(J.hfov+5),L())})),Ye.zoom.appendChild(Ye.zoomOut),Ye.container.appendChild(Ye.zoom),Ye.fullscreen=t.createElement("div"),Ye.fullscreen.addEventListener("click",H),Ye.fullscreen.className="pnlm-fullscreen-toggle-button pnlm-sprite pnlm-fullscreen-toggle-button-inactive pnlm-controls pnlm-control",(t.fullscreenEnabled||t.mozFullScreenEnabled||t.webkitFullscreenEnabled||t.msFullscreenEnabled)&&Ye.container.appendChild(Ye.fullscreen),Ye.orientation=t.createElement("div"),Ye.orientation.addEventListener("click",(function(e){Me?W():Z()})),Ye.orientation.addEventListener("mousedown",(function(e){e.stopPropagation()})),Ye.orientation.addEventListener("touchstart",(function(e){e.stopPropagation()})),Ye.orientation.addEventListener("pointerdown",(function(e){e.stopPropagation()})),Ye.orientation.className="pnlm-orientation-button pnlm-orientation-button-inactive pnlm-sprite pnlm-controls pnlm-control";var qe=!1;e.DeviceOrientationEvent&&"https:"==location.protocol&&(0<=navigator.userAgent.toLowerCase().indexOf("mobi")||0<=navigator.userAgent.indexOf("Mac")&&navigator.maxTouchPoints&&0<navigator.maxTouchPoints)&&(Ye.container.appendChild(Ye.orientation),qe=!0);var Ve=t.createElement("div");Ve.className="pnlm-compass pnlm-controls pnlm-control",De.appendChild(Ve),i.firstScene?U(i.firstScene):i.default&&i.default.firstScene?U(i.default.firstScene):U(null),k(!0);var Xe=[],We=[];S.prototype.multiply=function(e){return new S(this.w*e.w-this.x*e.x-this.y*e.y-this.z*e.z,this.x*e.w+this.w*e.x+this.y*e.z-this.z*e.y,this.y*e.w+this.w*e.y+this.z*e.x-this.x*e.z,this.z*e.w+this.w*e.z+this.x*e.y-this.y*e.x)},S.prototype.toEulerAngles=function(){return[Math.atan2(2*(this.w*this.x+this.y*this.z),1-2*(this.x*this.x+this.y*this.y)),Math.asin(2*(this.w*this.y-this.z*this.x)),Math.atan2(2*(this.w*this.z+this.x*this.y),1-2*(this.y*this.y+this.z*this.z))]},this.isLoaded=function(){return Boolean(ae)},this.getPitch=function(){return J.pitch},this.setPitch=function(e,t,n,i){return de=Date.now(),1e-6>=Math.abs(e-J.pitch)?("function"==typeof n&&n(i),this):((t=t==a?1e3:Number(t))?(Te.pitch={startTime:Date.now(),startPosition:J.pitch,endPosition:e,duration:t},"function"==typeof n&&setTimeout((function(){n(i)}),t)):J.pitch=e,L(),this)},this.getPitchBounds=function(){return[J.minPitch,J.maxPitch]},this.setPitchBounds=function(e){return J.minPitch=Math.max(-90,Math.min(e[0],90)),J.maxPitch=Math.max(-90,Math.min(e[1],90)),this},this.getYaw=function(){return(J.yaw+540)%360-180},this.setYaw=function(e,t,n,i){return de=Date.now(),1e-6>=Math.abs(e-J.yaw)?("function"==typeof n&&n(i),this):(e=(e+180)%360-180,(t=t==a?1e3:Number(t))?(180<J.yaw-e?e+=360:180<e-J.yaw&&(e-=360),Te.yaw={startTime:Date.now(),startPosition:J.yaw,endPosition:e,duration:t},"function"==typeof n&&setTimeout((function(){n(i)}),t)):J.yaw=e,L(),this)},this.getYawBounds=function(){return[J.minYaw,J.maxYaw]},this.setYawBounds=function(e){return J.minYaw=Math.max(-360,Math.min(e[0],360)),J.maxYaw=Math.max(-360,Math.min(e[1],360)),this},this.getHfov=function(){return J.hfov},this.setHfov=function(e,t,n,i){return de=Date.now(),1e-6>=Math.abs(e-J.hfov)?("function"==typeof n&&n(i),this):((t=t==a?1e3:Number(t))?(Te.hfov={startTime:Date.now(),startPosition:J.hfov,endPosition:G(e),duration:t},"function"==typeof n&&setTimeout((function(){n(i)}),t)):Y(e),L(),this)},this.getHfovBounds=function(){return[J.minHfov,J.maxHfov]},this.setHfovBounds=function(e){return J.minHfov=Math.max(0,e[0]),J.maxHfov=Math.max(0,e[1]),this},this.lookAt=function(e,t,n,i,o,r){return i=i==a?1e3:Number(i),e!==a&&1e-6<Math.abs(e-J.pitch)&&(this.setPitch(e,i,o,r),o=a),t!==a&&1e-6<Math.abs(t-J.yaw)&&(this.setYaw(t,i,o,r),o=a),n!==a&&1e-6<Math.abs(n-J.hfov)&&(this.setHfov(n,i,o,r),o=a),"function"==typeof o&&o(r),this},this.getNorthOffset=function(){return J.northOffset},this.setNorthOffset=function(e){return J.northOffset=Math.min(360,Math.max(0,e)),L(),this},this.getHorizonRoll=function(){return J.horizonRoll},this.setHorizonRoll=function(e){return J.horizonRoll=Math.min(90,Math.max(-90,e)),Q.setPose(J.horizonPitch*Math.PI/180,J.horizonRoll*Math.PI/180),L(),this},this.getHorizonPitch=function(){return J.horizonPitch},this.setHorizonPitch=function(e){return J.horizonPitch=Math.min(90,Math.max(-90,e)),Q.setPose(J.horizonPitch*Math.PI/180,J.horizonRoll*Math.PI/180),L(),this},this.startAutoRotate=function(e,t,n,i){return e=e||Ie||1,t=t===a?se:t,n=n===a?re:n,J.autoRotate=e,i!==a&&(J.autoRotateInactivityDelay=i),ce.lookAt(t,a,n,3e3),L(),this},this.stopAutoRotate=function(){return Ie=J.autoRotate?J.autoRotate:Ie,J.autoRotate=!1,J.autoRotateInactivityDelay=-1,this},this.stopMovement=function(){q(),xe={yaw:0,pitch:0,hfov:0}},this.getRenderer=function(){return Q},this.setUpdate=function(e){return(Le=!0===e)&&(Ae=!1,Q===a?s():L()),this},this.updateOnce=function(){return Le=Ae=!0,Q===a?s():L(),this},this.mouseEventToCoords=function(e){return m(e)},this.loadScene=function(e,t,a,n){return!1!==ae&&X(e,t,a,n),this},this.getScene=function(){return J.scene},this.addScene=function(e,t){return i.scenes[e]=t,this},this.removeScene=function(e){return!(J.scene==e||!i.scenes.hasOwnProperty(e))&&(delete i.scenes[e],!0)},this.toggleFullscreen=function(){return H(),this},this.getConfig=function(){return J},this.getContainer=function(){return n},this.addHotSpot=function(e,t){if(t===a&&J.scene===a)J.hotSpots.push(e);else{var n=t!==a?t:J.scene;if(!i.scenes.hasOwnProperty(n))throw"Invalid scene ID!";i.scenes[n].hasOwnProperty("hotSpots")||(i.scenes[n].hotSpots=[],n==J.scene&&(J.hotSpots=i.scenes[n].hotSpots)),i.scenes[n].hotSpots.push(e)}return t!==a&&J.scene!=t||(D(e),ae&&B(e)),this},this.removeHotSpot=function(e,t){if(t===a||J.scene==t){if(!J.hotSpots)return!1;for(var n=0;n<J.hotSpots.length;n++)if(J.hotSpots[n].hasOwnProperty("id")&&J.hotSpots[n].id==e){for(var o=J.hotSpots[n].div;o.parentNode!=De;)o=o.parentNode;return De.removeChild(o),delete J.hotSpots[n].div,J.hotSpots.splice(n,1),!0}}else{if(!i.scenes.hasOwnProperty(t))return!1;if(!i.scenes[t].hasOwnProperty("hotSpots"))return!1;for(n=0;n<i.scenes[t].hotSpots.length;n++)if(i.scenes[t].hotSpots[n].hasOwnProperty("id")&&i.scenes[t].hotSpots[n].id==e)return i.scenes[t].hotSpots.splice(n,1),!0}},this.resize=function(){Q&&C()},this.isOrientationSupported=function(){return qe||!1},this.stopOrientation=function(){W()},this.startOrientation=function(){Z()},this.isOrientationActive=function(){return Boolean(Me)},this.on=function(e,t){return Re[e]=Re[e]||[],Re[e].push(t),this},this.off=function(e,t){if(!e)return Re={},this;if(t){var a=Re[e].indexOf(t);0<=a&&Re[e].splice(a,1),0==Re[e].length&&delete Re[e]}else delete Re[e];return this},this.destroy=function(){if(Ne=!0,clearTimeout(oe),le&&le.abort(),Array.isArray(ne))for(var a=0;6>a;a++)ne[a].src="";Q&&Q.destroy(),be&&(t.removeEventListener("mousemove",p,!1),t.removeEventListener("mouseup",g,!1),n.removeEventListener("mozfullscreenchange",z,!1),n.removeEventListener("webkitfullscreenchange",z,!1),n.removeEventListener("msfullscreenchange",z,!1),n.removeEventListener("fullscreenchange",z,!1),he?he.disconnect():(e.removeEventListener("resize",C,!1),e.removeEventListener("orientationchange",C,!1)),n.removeEventListener("keydown",M,!1),n.removeEventListener("keyup",I,!1),n.removeEventListener("blur",P,!1),t.removeEventListener("mouseleave",g,!1)),n.innerHTML="",n.classList.remove("pnlm-container")}}return{viewer:function(e,t){return new n(e,t)}}}(window,document);const a={target:"trailview_panorama",initial:"c96ba6029cad464e9a4b7f9a6b8ac0d5",baseUrl:"https://trailview.cmparks.net",navArrowMinAngle:-25,navArrowMaxAngle:-20,imageFetchType:"standard",filterSequences:void 0};function n(e,t){return e-Math.floor(e/t)*t}class i{_options=a;_panViewer;_geo={latitude:0,longitude:0};_prevNorthOffset=0;_prevYaw=0;_currImg;_sceneList=[];_hotSpotList=[];_prevImg;_emitter;_sequencesData;_navArrowInfos=[];_mouseOnDot=!1;_destroyed=!1;_neighbors=[];_pitchCorrectionOverride;constructor(n=a){return this._emitter=new e,this._options=n,fetch(t(this._options.baseUrl,"/api/sequences"),{method:"GET"}).then((async e=>{const t=await e.json();if(!t.success)throw new Error("Failed to fetch sequence data");this._sequencesData=t.data,await this._initViewer(this._options.initial),this._currImg&&this.goToImageID(this._currImg.id,!0)})),this}on(e,t){this._emitter.on(e,t)}overridePitchCorrection(e){this._pitchCorrectionOverride=e,void 0!==this._currImg&&this.goToImageID(this._currImg.id,!0)}_updateNavArrows(e=!1){const t=document.getElementsByClassName("trailview-nav-arrow");if(void 0!==this._panViewer){for(const e of t){const t=n(360-((a=this._panViewer.getYaw())<0&&(a=360+a),a)+e.yaw,360);e.style.transform=`scale(80%) translate(-50%, -50%) rotateZ(${t}deg) translateY(-100px)`}let e=(this._panViewer.getPitch()+90)/2.5;e>80?e=80:e<0&&(e=0);const i=document.getElementById("trailview-nav-container");null!==i&&(i.style.transform=`translate(-50%, 0) perspective(300px) rotateX(${e}deg)`)}var a;e||!1!==this._destroyed||requestAnimationFrame(this._updateNavArrows.bind(this,!1))}getCurrentImageID(){if(this._currImg)return this._currImg.id}getFlipped(){return this._currImg?this._currImg.flipped:void 0}getCurrentSequenceId(){return this._currImg?this._currImg.sequenceId:void 0}getPanViewer(){return this._panViewer}_createViewerConfig(e){return{default:{firstScene:e,sceneFadeDuration:1500,compass:!1,autoLoad:!0,showControls:!1,crossOrigin:"use-credentials"},scenes:{}}}_addSceneToConfig(e,a){if(!this._sequencesData)throw new Error("Cannot add scene to config as sequence data is undefined");if(!this._sequencesData.find((e=>e.id===a.sequenceId)))throw new Error(`Cannot add scene to config as sequence not found with id: ${a.sequenceId}`);return e.scenes[String(a.id)]={horizonPitch:a.pitchCorrection,hfov:120,yaw:0,northOffset:a.bearing,type:"multires",multiRes:{basePath:t(this._options.baseUrl,"/api/panImage",`/${a.id}`),path:"/%l/%s%y_%x",extension:"jpg",tileResolution:512,maxLevel:3,cubeResolution:1832}},e}_addImageToViewer(e,a){this._sceneList.push(e.id);let i=e.pitchCorrection,o=180;e.flipped||(i*=-1,o=0);let r=e.bearing;if(e.flipped||(r=n(r+180,360)),!this._sequencesData)return void console.warn("Cannot add scene to viewer as sequence data is undefined");if(!this._sequencesData.find((t=>t.id===e.sequenceId)))return void console.warn(`Cannot find sequence with id: ${e.sequenceId}`);const s={horizonPitch:i,hfov:120,yaw:o,northOffset:r,type:"multires",multiRes:{basePath:t(this._options.baseUrl,"/api/panImage",`/${e.id}`),path:"/%l/%s%y_%x",fallbackPath:"/fallback/%s",extension:"jpg",tileResolution:512,maxLevel:3,cubeResolution:1832,shtHash:a}};null!=a&&(s.multiRes.shtHash=a),void 0!==this._panViewer&&this._panViewer.addScene(e.id,s)}resize(){this._panViewer?.resize()}_createNavArrows(){const e=document.getElementById("trailview-nav-container");if(null===e)return;const a=document.getElementsByClassName("trailview-nav-arrow");for(let t=a.length-1;t>=0;--t)e.removeChild(a[t]);this._navArrowInfos.forEach((a=>{const n=document.createElement("img");n.classList.add("trailview-nav-arrow"),n.src=t(this._options.baseUrl,"/assets/img/arrow.png"),n.yaw=a.yaw,n.imageId=a.id,n.draggable=!1,n.alt="Navigation arrow",n.addEventListener("click",(e=>{this.goToImageID(e.target.imageId)})),e.appendChild(n)}))}async _addNeighborsToViewer(e,t=!1){this._navArrowInfos=[];for(let a=0;a<e.length;a++){void 0!==this._pitchCorrectionOverride&&(e[a].pitchCorrection=this._pitchCorrectionOverride),this._addImageToViewer(e[a],e[a].shtHash);const i=this._options.navArrowMinAngle,o=this._options.navArrowMaxAngle,r=-(o-i-e[a].distance*(o-i)/9)+o;let s=e[a].neighborBearing;t||(s=n(e[a].neighborBearing+180,360)),this._navArrowInfos.push({id:e[a].id,pitch:r,yaw:s})}this._createNavArrows()}_customMod(e,t){return e-Math.floor(e/t)*t}async _getNeighbors(e){let a=t(this._options.baseUrl,"/api/neighbors",this._options.imageFetchType,e.id);if(void 0!==this._options.filterSequences){a+="?s=";for(let e=0;e<this._options.filterSequences.length;e++)a+=this._options.filterSequences[e],e!==this._options.filterSequences.length-1&&(a+=",")}const n=await fetch(a),i=await n.json();if(!0!==i.success)throw new Error("Failed to retrieve neighbors");return i.data}async _initViewer(e){let a;if("string"==typeof e)a=e;else{const n=await fetch(t(this._options.baseUrl,"api/near/",e.latitude.toString(),e.longitude.toString(),this._options.imageFetchType)),i=await n.json();if(!0!==i.success)throw new Error("Failed to fetch nearest image");a=i.data.id}let n=this._createViewerConfig(a);const i=await fetch(t(this._options.baseUrl,"/api/images",this._options.imageFetchType,a)),o=await i.json();if(!0!==o.success)throw new Error("Unable to fetch initial image");this._currImg=o.data,this._currImg&&(n=this._addSceneToConfig(n,this._currImg),n=this._addSceneToConfig(n,this._currImg),this._sceneList.push(this._currImg.id)),this._panViewer=pannellum.viewer(this._options.target,n),this._panViewer.on("scenechange",(e=>{this._onImageChange(e)})),this._onImageChange(this._panViewer.getScene()),void 0!==this._currImg&&(this._currImg.flipped?this._panViewer.setYaw(180,!1):this._panViewer.setYaw(0,!1)),this._neighbors=await this._getNeighbors(this._currImg);for(let e=0;e<this._hotSpotList.length;e++)this._panViewer.removeHotSpot(this._hotSpotList[e]);void 0!==this._currImg&&this._addNeighborsToViewer(this._neighbors,this._currImg.flipped),this._createNavContainer(),this._emitter.emit("init-done")}_createNavContainer(){const e=document.createElement("div");e.id="trailview-nav-container",document.getElementById(this._options.target)?.appendChild(e),this._updateNavArrows()}async _onImageChange(e){if(void 0===e)return;if(void 0===this._panViewer)return;this._prevYaw=this._panViewer.getYaw();const t=((this._prevNorthOffset-this._panViewer.getNorthOffset())%360+this._prevYaw)%360;if(this._panViewer.setYaw(t,!1),this._prevNorthOffset=this._panViewer.getNorthOffset(),void 0===this._currImg)throw new Error("Current image is undefined");if(this._geo.latitude=this._currImg.latitude,this._geo.longitude=this._currImg.longitude,void 0!==this._prevImg)for(let e=0;e<this._hotSpotList.length;e++)this._panViewer.removeHotSpot(this._hotSpotList[e],this._prevImg.id);this._hotSpotList=[];const a=document.getElementsByClassName("pnlm-hotspot-base");for(let e=0;e<a.length;e++)a[e].remove();this._neighbors=await this._getNeighbors(this._currImg);const n=[e];for(let e=0;e<this._neighbors.length;e++)n.push(this._neighbors[e].id);for(let e=0;e<this._sceneList.length;e++)n.includes(this._sceneList[e])||this._panViewer.removeScene(this._sceneList[e]);this._sceneList=n,this._prevImg=this._currImg,this._addNeighborsToViewer(this._neighbors,this._currImg.flipped),this._emitter.emit("image-change",this._currImg)}getImageGeo(){return this._geo}destroy(){this._destroyed=!0,void 0!==this._panViewer&&this._panViewer.destroy()}getBearing(){return void 0!==this._panViewer?(this._panViewer.getNorthOffset()+this._panViewer.getYaw()+180)%360:void 0}async goToImageID(e,a=!1){if(void 0===this._panViewer)return;let n=this._neighbors.find((t=>t.id===e));if(a){for(let e=0;e<this._sceneList.length;e++)this._panViewer.removeScene(this._sceneList[e]);this._sceneList=[],this._neighbors=[]}if(void 0===n){const a=await fetch(t(this._options.baseUrl,"/api/images",this._options.imageFetchType,e)),i=await a.json();if(!0!==i.success)throw new Error("Unable to fetch image data");n=i.data,void 0!==this._pitchCorrectionOverride&&(n.pitchCorrection=this._pitchCorrectionOverride),this._addImageToViewer(n,i.preview)}return this._currImg=n,this._panViewer.loadScene(n.id,"same","same","same"),this}}export{i as TrailViewerBase,a as defaultBaseOptions};
//# sourceMappingURL=trailviewer-base.mjs.map
