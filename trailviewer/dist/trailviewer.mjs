import e from"mapbox-gl";import{EventEmitter as t}from"events";import a from"url-join";window.libpannellum=function(e,t,a){function i(i,c){function d(e,t){return 1==e.level&&1!=t.level?-1:1==t.level&&1!=e.level?1:t.timestamp-e.timestamp}function u(e,t){return e.level!=t.level?e.level-t.level:e.diff-t.diff}function f(e,t,a,i,o,n,r){this.vertices=e,this.side=t,this.level=a,this.x=i,this.y=o,e=(e="object"==typeof n?n.tileKey:n).replace("%s",t).replace("%l0",a-1).replace("%l",a).replace("%x",i).replace("%y",o),this.path="object"==typeof n?n[e]:e,this.parentPath=r}function m(e,t,a,i,o,n){var r;r=b(e,(l=a.vertices).slice(0,3));var s=b(e,l.slice(3,6)),h=b(e,l.slice(6,9)),l=b(e,l.slice(9,12));if(-4==(c=r[0]+s[0]+h[0]+l[0])||4==c?r=!1:r=-4!=(c=r[1]+s[1]+h[1]+l[1])&&4!=c&&4!=r[2]+s[2]+h[2]+l[2],r){var c=[],d=[],u=2,p=[],g=0;for(l=0;4>l;l++)r=_(t,a.vertices.slice(3*l,3*(l+1))),c.push(r[0]*r[3]),d.push(r[1]*r[3]),r=r[2]*r[3],u=Math.min(u,r),p.push(1>=Math.abs(c[l])&&1>=Math.abs(d[l])&&0<r),g+=p[l];if(h=U.cubeResolution*Math.pow(2,a.level-U.maxLevel),r=Math.ceil(h*U.invTileResolution)-1,s=h%U.tileResolution*2,0===(h=2*h%U.tileResolution)&&(h=U.tileResolution),0===s&&(s=2*U.tileResolution),1<a.level&&0<u&&0<g){for(l=u=0;4>l;l++)if(g=(l+1)%4,p[l]||p[g]){var v=(c[g]-c[l])*L.drawingBufferWidth/2;g=(d[g]-d[l])*L.drawingBufferHeight/2;h<U.tileResolution&&(a.x==r?v*=U.tileResolution/h:a.y==r&&(g*=U.tileResolution/h)),s<=U.tileResolution&&(a.x==r&&(v*=2),a.y==r&&(g*=2)),u=Math.max(u,Math.sqrt(v*v+g*g))}if(u<=U.tileResolution/2)return}for(l=(c=a.vertices)[0]+c[3]+c[6]+c[9],d=c[1]+c[4]+c[7]+c[10],p=c[2]+c[5]+c[8]+c[11],u=Math.sqrt(l*l+d*d+p*p),p=Math.asin(p/u),l=Math.atan2(d,l)-o,l+=l>Math.PI?-2*Math.PI:l<-Math.PI?2*Math.PI:0,l=Math.abs(l),a.diff=Math.acos(Math.sin(i)*Math.sin(p)+Math.cos(i)*Math.cos(p)*Math.cos(l)),l=!1,d=0;d<R.nodeCache.length;d++)if(R.nodeCache[d].path==a.path){l=!0,R.nodeCache[d].timestamp=R.nodeCacheTimestamp++,R.nodeCache[d].diff=a.diff,R.currentNodes.push(R.nodeCache[d]);break}if(l||(a.timestamp=R.nodeCacheTimestamp++,R.currentNodes.push(a),R.nodeCache.push(a)),a.level<U.maxLevel){p=.5,a.x!=r&&a.y!=r||(p=1-U.tileResolution/(U.tileResolution+h));d=[],v=g=u=p;var w=l=1-p,y=l,x=l;for(h<U.tileResolution&&(a.x==r&&a.y!=r?(y=g=.5,("d"==a.side||"u"==a.side)&&(x=v=.5)):a.x!=r&&a.y==r&&(w=u=.5,"l"==a.side||"r"==a.side)&&(x=v=.5)),s<=U.tileResolution&&(a.x==r&&(u=0,w=1,"l"==a.side||"r"==a.side)&&(v=0,x=1),a.y==r&&(g=0,y=1,"d"==a.side||"u"==a.side)&&(v=0,x=1)),h=new f(h=new Float32Array([c[0],c[1],c[2],c[0]*u+c[3]*w,c[1]*p+c[4]*l,c[2]*v+c[5]*x,c[0]*u+c[6]*w,c[1]*g+c[7]*y,c[2]*v+c[8]*x,c[0]*p+c[9]*l,c[1]*g+c[10]*y,c[2]*v+c[11]*x]),a.side,a.level+1,2*a.x,2*a.y,U.fullpath,a.path),d.push(h),a.x==r&&s<=U.tileResolution||(h=new f(h=new Float32Array([c[0]*u+c[3]*w,c[1]*p+c[4]*l,c[2]*v+c[5]*x,c[3],c[4],c[5],c[3]*p+c[6]*l,c[4]*g+c[7]*y,c[5]*v+c[8]*x,c[0]*u+c[6]*w,c[1]*g+c[7]*y,c[2]*v+c[8]*x]),a.side,a.level+1,2*a.x+1,2*a.y,U.fullpath,a.path),d.push(h)),a.x==r&&s<=U.tileResolution||a.y==r&&s<=U.tileResolution||(h=new f(h=new Float32Array([c[0]*u+c[6]*w,c[1]*g+c[7]*y,c[2]*v+c[8]*x,c[3]*p+c[6]*l,c[4]*g+c[7]*y,c[5]*v+c[8]*x,c[6],c[7],c[8],c[9]*u+c[6]*w,c[10]*p+c[7]*l,c[11]*v+c[8]*x]),a.side,a.level+1,2*a.x+1,2*a.y+1,U.fullpath,a.path),d.push(h)),a.y==r&&s<=U.tileResolution||(h=new f(h=new Float32Array([c[0]*p+c[9]*l,c[1]*g+c[10]*y,c[2]*v+c[11]*x,c[0]*u+c[6]*w,c[1]*g+c[7]*y,c[2]*v+c[8]*x,c[9]*u+c[6]*w,c[10]*p+c[7]*l,c[11]*v+c[8]*x,c[9],c[10],c[11]]),a.side,a.level+1,2*a.x,2*a.y+1,U.fullpath,a.path),d.push(h)),g=0;g<d.length;g++)m(e,t,d[g],i,o)}}}function p(){return new Float32Array([-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,-1,-1])}function g(e,t,a){var i=Math.sin(t);return t=Math.cos(t),"x"==a?new Float32Array([e[0],t*e[1]+i*e[2],t*e[2]-i*e[1],e[3],t*e[4]+i*e[5],t*e[5]-i*e[4],e[6],t*e[7]+i*e[8],t*e[8]-i*e[7]]):"y"==a?new Float32Array([t*e[0]-i*e[2],e[1],t*e[2]+i*e[0],t*e[3]-i*e[5],e[4],t*e[5]+i*e[3],t*e[6]-i*e[8],e[7],t*e[8]+i*e[6]]):"z"==a?new Float32Array([t*e[0]+i*e[1],t*e[1]-i*e[0],e[2],t*e[3]+i*e[4],t*e[4]-i*e[3],e[5],t*e[6]+i*e[7],t*e[7]-i*e[6],e[8]]):void 0}function v(e){return new Float32Array([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]])}function w(e,t,a,i){return e=2*Math.atan(Math.tan(e/2)*L.drawingBufferHeight/L.drawingBufferWidth),e=1/Math.tan(e/2),new Float32Array([e/t,0,0,0,0,e,0,0,0,0,(i+a)/(a-i),2*i*a/(a-i),0,0,-1,0])}function y(e,t){return new Float32Array([e[0]*t[0],e[0]*t[1],e[0]*t[2],0,e[5]*t[4],e[5]*t[5],e[5]*t[6],0,e[10]*t[8],e[10]*t[9],e[10]*t[10],e[11],-t[8],-t[9],-t[10],0])}function _(e,t){return new Float32Array([e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[4]*t[0]+e[5]*t[1]+e[6]*t[2],e[11]+e[8]*t[0]+e[9]*t[1]+e[10]*t[2],1/(e[12]*t[0]+e[13]*t[1]+e[14]*t[2])])}function b(e,t){var a=(o=_(e,t))[0]*o[3],i=o[1]*o[3],o=o[2]*o[3],n=[0,0,0];return-1>a&&(n[0]=-1),1<a&&(n[0]=1),-1>i&&(n[1]=-1),1<i&&(n[1]=1),(-1>o||1<o)&&(n[2]=1),n}function x(){console.log("Reducing canvas size due to error 1286!"),I.width=Math.round(I.width/2),I.height=Math.round(I.height/2)}function E(e,t){return Math.pow((Math.abs(e)-t)/t,2)*(0<e-t?1:-1)}function M(e,t){for(var a=Math.floor(e.length/t),i=[],o=0;o<a;o++){for(var n=0,r=0;r<t;r++)n=83*n+K.indexOf(e[o*t+r]);i.push(n)}return i}function P(e,t,a){var i=Math.floor(Math.sqrt(e.length))-1,o=Array(i+1),n=Array(i+1);n[0]=0,o[0]=1,n[1]=Math.sin(a),o[1]=Math.cos(a);for(var r=2;r<=i;r++)n[r]=2*n[r-1]*o[1]-n[r-2],o[r]=2*o[r-1]*o[1]-o[r-2];var s=a=0;for(r=1;r<=i+1;r++)s+=r;for(;0<=i;i--){var h=Math.floor((i+1)*i/2);for(a+=0!=h?e[h]*t[h-1]:e[h],r=1;r<=i;r++)a+=(e[++h]*o[r]+e[h+s-i-1]*n[r])*t[h-1]}return Math.round(a)}function T(e){if(1>ee.length)for(var t=J.length/32,a=0;32>a;a++){ee.push([]);for(var i=0;i<t;i++)ee[a].push(E(M(J[a*t+i],1),41)*Q)}M(e[0],1);i=255*(E(M(e[1],1),41)+1)/2;var o=M(e.slice(2),2);e=[];t=[];var n=[];for(a=0;a<o.length;a++){var r,s=o[a];r=i;var h=Math.floor(s/19)%19,l=s%19;r=[s=E(Math.floor(s/361),9)*r,h=E(h,9)*r,r*=E(l,9)],e.push(r[0]),t.push(r[1]),n.push(r[2])}for(o=.03125*Math.PI,r=[],a=31;0<=a;a--)for(i=0;64>i;i++)r.push(P(e,ee[a],(i+.5)*o)),r.push(P(t,ee[a],(i+.5)*o)),r.push(P(n,ee[a],(i+.5)*o)),r.push(255);return new ImageData(new Uint8ClampedArray(r),64,32)}var I;i&&((I=t.createElement("canvas")).style.width=I.style.height="100%",i.appendChild(I));var R,L,C,A,S,N,D,F,k,O,B,U,H,z,G,Y,q,V,X="fbudlr".split(""),W="frblud".split("");c&&(L=c),this.init=function(e,c,d,u,f,m,g){function v(e){if(_){var t=e*e*4,a=new Uint8ClampedArray(t),i=g.backgroundColor?g.backgroundColor:[0,0,0];i[0]*=255,i[1]*=255,i[2]*=255;for(var o=0;o<t;o++)a[o++]=i[0],a[o++]=i[1],a[o++]=i[2];for(e=new ImageData(a,e,e),w=0;6>w;w++)0==U[w].width&&(U[w]=e)}}if(c===a&&(c="equirectangular"),"equirectangular"!=c&&"cubemap"!=c&&"multires"!=c)throw console.log("Error: invalid image type specified!"),{type:"config error"};if(H=c,U=e,V=g||{},R){if(C&&(L.detachShader(R,C),L.deleteShader(C)),A&&(L.detachShader(R,A),L.deleteShader(A)),L.bindBuffer(L.ARRAY_BUFFER,null),L.bindBuffer(L.ELEMENT_ARRAY_BUFFER,null),R.texture&&L.deleteTexture(R.texture),R.nodeCache)for(e=0;e<R.nodeCache.length;e++)L.deleteTexture(R.nodeCache[e].texture);if(R.textureLoads)for(Z=[];0<R.textureLoads.length;)R.textureLoads.shift()(!1);L.deleteProgram(R),R=a}S&&(N&&(L.detachShader(S,N),L.deleteShader(N)),D&&(L.detachShader(S,D),L.deleteShader(D)),L.deleteProgram(S),S=a),B=a;var w,y,_=!1;if("cubemap"==H)for(w=0;6>w;w++)0<U[w].width?(y===a&&(y=U[w].width),y!=U[w].width&&console.log("Cube faces have inconsistent widths: "+y+" vs. "+U[w].width)):_=!0;if("cubemap"==H&&0!=(y&y-1)&&(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 9_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 10_/)||navigator.userAgent.match(/Trident.*rv[ :]*11\./))||(L||(L=I.getContext("experimental-webgl",{alpha:!1,depth:!1})),L&&1286==L.getError()&&x()),!L&&("multires"==H&&U.hasOwnProperty("fallbackPath")||"cubemap"==H)&&("WebkitAppearance"in t.documentElement.style||navigator.userAgent.match(/Trident.*rv[ :]*11\./)||-1!==navigator.appVersion.indexOf("MSIE 10"))){k&&i.removeChild(k),(k=t.createElement("div")).className="pnlm-world",d=U.basePath?U.basePath+U.fallbackPath:U.fallbackPath;var b=0;u=function(){var e=t.createElement("canvas");e.className="pnlm-face pnlm-"+W[this.side]+"face",k.appendChild(e);var a=e.getContext("2d");e.style.width=this.width+4+"px",e.style.height=this.height+4+"px",e.width=this.width+4,e.height=this.height+4,a.drawImage(this,2,2);var i,o,n=a.getImageData(0,0,e.width,e.height),r=n.data;for(i=2;i<e.width-2;i++)for(o=0;4>o;o++)r[4*(i+e.width)+o]=r[4*(i+2*e.width)+o],r[4*(i+e.width*(e.height-2))+o]=r[4*(i+e.width*(e.height-3))+o];for(i=2;i<e.height-2;i++)for(o=0;4>o;o++)r[4*(i*e.width+1)+o]=r[4*(i*e.width+2)+o],r[4*((i+1)*e.width-2)+o]=r[4*((i+1)*e.width-3)+o];for(o=0;4>o;o++)r[4*(e.width+1)+o]=r[4*(2*e.width+2)+o],r[4*(2*e.width-2)+o]=r[4*(3*e.width-3)+o],r[4*(e.width*(e.height-2)+1)+o]=r[4*(e.width*(e.height-3)+2)+o],r[4*(e.width*(e.height-1)-2)+o]=r[4*(e.width*(e.height-2)-3)+o];for(i=1;i<e.width-1;i++)for(o=0;4>o;o++)r[4*i+o]=r[4*(i+e.width)+o],r[4*(i+e.width*(e.height-1))+o]=r[4*(i+e.width*(e.height-2))+o];for(i=1;i<e.height-1;i++)for(o=0;4>o;o++)r[i*e.width*4+o]=r[4*(i*e.width+1)+o],r[4*((i+1)*e.width-1)+o]=r[4*((i+1)*e.width-2)+o];for(o=0;4>o;o++)r[o]=r[4*(e.width+1)+o],r[4*(e.width-1)+o]=r[4*(2*e.width-2)+o],r[e.width*(e.height-1)*4+o]=r[4*(e.width*(e.height-2)+1)+o],r[4*(e.width*e.height-1)+o]=r[4*(e.width*(e.height-1)-2)+o];a.putImageData(n,0,0),E.call(this)};var E=function(){0<this.width?(F===a&&(F=this.width),F!=this.width&&console.log("Fallback faces have inconsistent widths: "+F+" vs. "+this.width)):_=!0,6==++b&&(F=this.width,i.appendChild(k),m())};_=!1;for(w=0;6>w;w++)(f=new Image).crossOrigin=V.crossOrigin?V.crossOrigin:"anonymous",f.side=w,f.onload=u,f.onerror=E,f.src="multires"==H?d.replace("%s",W[w])+(U.extension?"."+U.extension:""):U[w].src;v(F)}else{if(!L)throw console.log("Error: no WebGL support detected!"),{type:"no webgl"};for("cubemap"==H&&v(y),U.fullpath=U.basePath?U.basePath+U.path:U.path,U.invTileResolution=1/U.tileResolution,e=p(),O=[],w=0;6>w;w++)O[w]=e.slice(12*w,12*w+12),e=p();if(e=0,"equirectangular"==H){if(e=L.getParameter(L.MAX_TEXTURE_SIZE),Math.max(U.width/2,U.height)>e)throw console.log("Error: The image is too big; it's "+U.width+"px wide, but this device's maximum supported size is "+2*e+"px."),{type:"webgl size error",width:U.width,maxWidth:2*e}}else if("cubemap"==H&&y>L.getParameter(L.MAX_CUBE_MAP_TEXTURE_SIZE))throw console.log("Error: The image is too big; it's "+y+"px wide, but this device's maximum supported size is "+e+"px."),{type:"webgl size error",width:y,maxWidth:e};g!==a&&(y=isNaN(g.horizonPitch)?0:Number(g.horizonPitch),c=isNaN(g.horizonRoll)?0:Number(g.horizonRoll),0!=y||0!=c)&&(B=[y,c]);var M=L.TEXTURE_2D;if(L.viewport(0,0,L.drawingBufferWidth,L.drawingBufferHeight),L.getShaderPrecisionFormat&&(y=L.getShaderPrecisionFormat(L.FRAGMENT_SHADER,L.HIGH_FLOAT))&&1>y.precision&&(r=r.replace("highp","mediump")),C=L.createShader(L.VERTEX_SHADER),y=o,"multires"==H&&(y=n),L.shaderSource(C,y),L.compileShader(C),A=L.createShader(L.FRAGMENT_SHADER),y=h,"cubemap"==H?(M=L.TEXTURE_CUBE_MAP,y=s):"multires"==H&&(y=l),L.shaderSource(A,y),L.compileShader(A),R=L.createProgram(),L.attachShader(R,C),L.attachShader(R,A),L.linkProgram(R),L.getShaderParameter(C,L.COMPILE_STATUS)||console.log(L.getShaderInfoLog(C)),L.getShaderParameter(A,L.COMPILE_STATUS)||console.log(L.getShaderInfoLog(A)),L.getProgramParameter(R,L.LINK_STATUS)||console.log(L.getProgramInfoLog(R)),L.useProgram(R),R.drawInProgress=!1,null!==g.backgroundColor){var P=g.backgroundColor?g.backgroundColor:[0,0,0];L.clearColor(P[0],P[1],P[2],1),L.clear(L.COLOR_BUFFER_BIT)}if(R.texCoordLocation=L.getAttribLocation(R,"a_texCoord"),L.enableVertexAttribArray(R.texCoordLocation),"multires"!=H)z||(z=L.createBuffer()),L.bindBuffer(L.ARRAY_BUFFER,z),L.bufferData(L.ARRAY_BUFFER,new Float32Array([-1,1,1,1,1,-1,-1,1,1,-1,-1,-1]),L.STATIC_DRAW),L.vertexAttribPointer(R.texCoordLocation,2,L.FLOAT,!1,0,0),R.aspectRatio=L.getUniformLocation(R,"u_aspectRatio"),L.uniform1f(R.aspectRatio,L.drawingBufferWidth/L.drawingBufferHeight),R.psi=L.getUniformLocation(R,"u_psi"),R.theta=L.getUniformLocation(R,"u_theta"),R.f=L.getUniformLocation(R,"u_f"),R.h=L.getUniformLocation(R,"u_h"),R.v=L.getUniformLocation(R,"u_v"),R.vo=L.getUniformLocation(R,"u_vo"),R.rot=L.getUniformLocation(R,"u_rot"),L.uniform1f(R.h,d/(2*Math.PI)),L.uniform1f(R.v,u/Math.PI),L.uniform1f(R.vo,f/Math.PI*2),"equirectangular"==H&&(R.backgroundColor=L.getUniformLocation(R,"u_backgroundColor"),L.uniform4fv(R.backgroundColor,P.concat([1]))),R.texture=L.createTexture(),L.bindTexture(M,R.texture),"cubemap"==H?(L.texImage2D(L.TEXTURE_CUBE_MAP_POSITIVE_X,0,L.RGB,L.RGB,L.UNSIGNED_BYTE,U[1]),L.texImage2D(L.TEXTURE_CUBE_MAP_NEGATIVE_X,0,L.RGB,L.RGB,L.UNSIGNED_BYTE,U[3]),L.texImage2D(L.TEXTURE_CUBE_MAP_POSITIVE_Y,0,L.RGB,L.RGB,L.UNSIGNED_BYTE,U[4]),L.texImage2D(L.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,L.RGB,L.RGB,L.UNSIGNED_BYTE,U[5]),L.texImage2D(L.TEXTURE_CUBE_MAP_POSITIVE_Z,0,L.RGB,L.RGB,L.UNSIGNED_BYTE,U[0]),L.texImage2D(L.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,L.RGB,L.RGB,L.UNSIGNED_BYTE,U[2])):U.width<=e?(L.uniform1i(L.getUniformLocation(R,"u_splitImage"),0),L.texImage2D(M,0,L.RGB,L.RGB,L.UNSIGNED_BYTE,U)):(L.uniform1i(L.getUniformLocation(R,"u_splitImage"),1),(u=t.createElement("canvas")).width=U.width/2,u.height=U.height,(u=u.getContext("2d")).drawImage(U,0,0),f=u.getImageData(0,0,U.width/2,U.height),L.texImage2D(M,0,L.RGB,L.RGB,L.UNSIGNED_BYTE,f),R.texture2=L.createTexture(),L.activeTexture(L.TEXTURE1),L.bindTexture(M,R.texture2),L.uniform1i(L.getUniformLocation(R,"u_image1"),1),u.drawImage(U,-U.width/2,0),f=u.getImageData(0,0,U.width/2,U.height),L.texImage2D(M,0,L.RGB,L.RGB,L.UNSIGNED_BYTE,f),L.texParameteri(M,L.TEXTURE_WRAP_S,L.CLAMP_TO_EDGE),L.texParameteri(M,L.TEXTURE_WRAP_T,L.CLAMP_TO_EDGE),L.texParameteri(M,L.TEXTURE_MIN_FILTER,L.LINEAR),L.texParameteri(M,L.TEXTURE_MAG_FILTER,L.LINEAR),L.activeTexture(L.TEXTURE0)),"cubemap"!=H&&U.width&&U.width<=e&&d==2*Math.PI&&0==(U.width&U.width-1)?L.texParameteri(M,L.TEXTURE_WRAP_S,L.REPEAT):L.texParameteri(M,L.TEXTURE_WRAP_S,L.CLAMP_TO_EDGE),L.texParameteri(M,L.TEXTURE_WRAP_T,L.CLAMP_TO_EDGE),L.texParameteri(M,L.TEXTURE_MIN_FILTER,L.LINEAR),L.texParameteri(M,L.TEXTURE_MAG_FILTER,L.LINEAR);else if(R.vertPosLocation=L.getAttribLocation(R,"a_vertCoord"),L.enableVertexAttribArray(R.vertPosLocation),G||(G=L.createBuffer()),Y||(Y=L.createBuffer()),q||(q=L.createBuffer()),L.bindBuffer(L.ARRAY_BUFFER,Y),L.bufferData(L.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),L.STATIC_DRAW),L.vertexAttribPointer(R.texCoordLocation,2,L.FLOAT,!1,0,0),L.bindBuffer(L.ELEMENT_ARRAY_BUFFER,q),L.bufferData(L.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),L.STATIC_DRAW),L.bindBuffer(L.ARRAY_BUFFER,G),L.vertexAttribPointer(R.vertPosLocation,3,L.FLOAT,!1,0,0),R.perspUniform=L.getUniformLocation(R,"u_perspMatrix"),R.cubeUniform=L.getUniformLocation(R,"u_cubeMatrix"),R.currentNodes=[],R.nodeCache=[],R.nodeCacheTimestamp=0,R.textureLoads=[],U.shtHash||U.equirectangularThumbnail){N=L.createShader(L.VERTEX_SHADER),L.shaderSource(N,o),L.compileShader(N),D=L.createShader(L.FRAGMENT_SHADER),L.shaderSource(D,h),L.compileShader(D),S=L.createProgram(),L.attachShader(S,N),L.attachShader(S,D),L.linkProgram(S),L.getShaderParameter(N,L.COMPILE_STATUS)||console.log(L.getShaderInfoLog(N)),L.getShaderParameter(D,L.COMPILE_STATUS)||console.log(L.getShaderInfoLog(D)),L.getProgramParameter(S,L.LINK_STATUS)||console.log(L.getProgramInfoLog(S)),L.useProgram(S),S.texCoordLocation=L.getAttribLocation(S,"a_texCoord"),L.enableVertexAttribArray(S.texCoordLocation),z||(z=L.createBuffer()),L.bindBuffer(L.ARRAY_BUFFER,z),L.bufferData(L.ARRAY_BUFFER,new Float32Array([-1,1,1,1,1,-1,-1,1,1,-1,-1,-1]),L.STATIC_DRAW),L.vertexAttribPointer(S.texCoordLocation,2,L.FLOAT,!1,0,0),S.aspectRatio=L.getUniformLocation(S,"u_aspectRatio"),L.uniform1f(S.aspectRatio,L.drawingBufferWidth/L.drawingBufferHeight),S.psi=L.getUniformLocation(S,"u_psi"),S.theta=L.getUniformLocation(S,"u_theta"),S.f=L.getUniformLocation(S,"u_f"),S.h=L.getUniformLocation(S,"u_h"),S.v=L.getUniformLocation(S,"u_v"),S.vo=L.getUniformLocation(S,"u_vo"),S.rot=L.getUniformLocation(S,"u_rot"),L.uniform1f(S.h,1),S.texture=L.createTexture(),L.bindTexture(M,S.texture);var X,j,$,K=function(){L.useProgram(S),L.uniform1i(L.getUniformLocation(S,"u_splitImage"),0),L.texImage2D(M,0,L.RGBA,L.RGBA,L.UNSIGNED_BYTE,X),L.texParameteri(M,L.TEXTURE_WRAP_S,L.REPEAT),L.texParameteri(M,L.TEXTURE_WRAP_T,L.CLAMP_TO_EDGE),L.texParameteri(M,L.TEXTURE_MIN_FILTER,L.LINEAR),L.texParameteri(M,L.TEXTURE_MAG_FILTER,L.LINEAR),L.uniform1f(S.v,j),L.uniform1f(S.vo,$),L.useProgram(R)};if(U.shtHash&&(X=T(U.shtHash),j=(2+1/31)/2,$=1-(2+1/31)/2,K()),U.equirectangularThumbnail)if("string"==typeof U.equirectangularThumbnail){if("data:"!=U.equirectangularThumbnail.slice(0,5))throw console.log("Error: thumbnail string is not a data URI!"),{type:"config error"};(X=new Image).onload=function(){j=1,$=0,K()},X.src=U.equirectangularThumbnail}else X=U.equirectangularThumbnail,j=1,$=0,K();L.bindBuffer(L.ARRAY_BUFFER,G),L.vertexAttribPointer(R.vertPosLocation,3,L.FLOAT,!1,0,0),L.useProgram(R)}if(0!==(d=L.getError()))throw console.log("Error: Something went wrong with WebGL!",d),{type:"webgl error"};m()}},this.destroy=function(){if(i!==a&&(I!==a&&i.contains(I)&&i.removeChild(I),k!==a&&i.contains(k)&&i.removeChild(k)),L){var e=L.getExtension("WEBGL_lose_context");e&&e.loseContext()}},this.resize=function(){var t=e.devicePixelRatio||1;I.width=I.clientWidth*t,I.height=I.clientHeight*t,L&&(1286==L.getError()&&x(),L.viewport(0,0,L.drawingBufferWidth,L.drawingBufferHeight),"multires"!=H?L.uniform1f(R.aspectRatio,I.clientWidth/I.clientHeight):U.shtHash&&(L.useProgram(S),L.uniform1f(S.aspectRatio,I.clientWidth/I.clientHeight),L.useProgram(R)))},I&&this.resize(),this.setPose=function(e,t){e=isNaN(e)?0:Number(e),t=isNaN(t)?0:Number(t),B=0==e&&0==t?a:[e,t]},this.render=function(t,i,o,n){var r,s,h=0;if(n===a&&(n={}),n.roll&&(h=n.roll),n.dynamic)var l=n.dynamic;if(B!==a){r=B[0],s=B[1];var c=t,p=i,_=Math.cos(s)*Math.sin(t)*Math.sin(r)+Math.cos(t)*(Math.cos(r)*Math.cos(i)+Math.sin(s)*Math.sin(r)*Math.sin(i)),b=-Math.sin(t)*Math.sin(s)+Math.cos(t)*Math.cos(s)*Math.sin(i);t=Math.cos(s)*Math.cos(r)*Math.sin(t)+Math.cos(t)*(-Math.cos(i)*Math.sin(r)+Math.cos(r)*Math.sin(s)*Math.sin(i)),t=Math.asin(Math.max(Math.min(t,1),-1)),i=Math.atan2(b,_),r=[Math.cos(c)*(Math.sin(s)*Math.sin(r)*Math.cos(p)-Math.cos(r)*Math.sin(p)),Math.cos(c)*Math.cos(s)*Math.cos(p),Math.cos(c)*(Math.cos(r)*Math.sin(s)*Math.cos(p)+Math.sin(p)*Math.sin(r))],s=[-Math.cos(t)*Math.sin(i),Math.cos(t)*Math.cos(i)],s=Math.acos(Math.max(Math.min((r[0]*s[0]+r[1]*s[1])/(Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2])*Math.sqrt(s[0]*s[0]+s[1]*s[1])),1),-1)),0>r[2]&&(s=2*Math.PI-s),h+=s}if(n.hook&&n.hook({gl:L,program:R,previewProgram:S,imageType:H,texCoordBuffer:z,cubeVertBuf:G,cubeVertTexCoordBuf:Y,cubeVertIndBuf:q}),L||"multires"!=H&&"cubemap"!=H){if("multires"!=H)r=2*Math.atan(Math.tan(.5*o)/(L.drawingBufferWidth/L.drawingBufferHeight)),r=1/Math.tan(.5*r),L.uniform1f(R.psi,i),L.uniform1f(R.theta,t),L.uniform1f(R.rot,h),L.uniform1f(R.f,r),!0===l&&"equirectangular"==H&&(L.bindTexture(L.TEXTURE_2D,R.texture),L.texImage2D(L.TEXTURE_2D,0,L.RGB,L.RGB,L.UNSIGNED_BYTE,U)),L.drawArrays(L.TRIANGLES,0,6);else{if((l=void 0!==U.shtHash||void 0!==U.equirectangularThumbnail)&&(L.useProgram(S),L.bindBuffer(L.ARRAY_BUFFER,z),L.vertexAttribPointer(S.texCoordLocation,2,L.FLOAT,!1,0,0),L.bindTexture(L.TEXTURE_2D,S.texture),r=2*Math.atan(Math.tan(.5*o)/(L.drawingBufferWidth/L.drawingBufferHeight)),r=1/Math.tan(.5*r),L.uniform1f(S.psi,i),L.uniform1f(S.theta,t),L.uniform1f(S.rot,h),L.uniform1f(S.f,r),L.drawArrays(L.TRIANGLES,0,6),L.bindBuffer(L.ARRAY_BUFFER,G),L.vertexAttribPointer(R.vertPosLocation,3,L.FLOAT,!1,0,0),L.useProgram(R)),c=w(o,L.drawingBufferWidth/L.drawingBufferHeight,.1,100),r=w(o,L.drawingBufferWidth/L.drawingBufferHeight,-100,100),s=g(s=new Float32Array([1,0,0,0,1,0,0,0,1]),-h,"z"),s=g(s,-t,"x"),s=g(s,i,"y"),s=new Float32Array([s[0],s[1],s[2],0,s[3],s[4],s[5],0,s[6],s[7],s[8],0,0,0,0,1]),L.uniformMatrix4fv(R.perspUniform,!1,v(c)),L.uniformMatrix4fv(R.cubeUniform,!1,v(s)),h=y(c,s),r=y(r,s),R.nodeCache.sort(d),200<R.nodeCache.length&&R.nodeCache.length>R.currentNodes.length+50)for(s=R.nodeCache.splice(200,R.nodeCache.length-200),c=0;c<s.length;c++)L.deleteTexture(s[c].texture);for(R.currentNodes=[],s=0;6>s;s++)m(h,r,c=new f(O[s],X[s],1,0,0,U.fullpath,null),t,i);for(R.currentNodes.sort(u),t=Z.length-1;0<=t;t--)-1===R.currentNodes.indexOf(Z[t].node)&&(Z[t].node.textureLoad=!1,Z.splice(t,1));if(0===Z.length)for(t=0;t<R.currentNodes.length;t++)if(!(i=R.currentNodes[t]).texture&&!i.textureLoad){i.textureLoad=!0,setTimeout(j,0,i);break}if(0<R.textureLoads.length&&R.textureLoads.shift()(!0),t=!l,!R.drawInProgress){for(R.drawInProgress=!0,t&&L.clear(L.COLOR_BUFFER_BIT),t={},i=0;i<R.currentNodes.length;i++)t[R.currentNodes[i].parentPath]===a&&(t[R.currentNodes[i].parentPath]=0),t[R.currentNodes[i].parentPath]+=!(1<R.currentNodes[i].textureLoaded);for(i=0;i<R.currentNodes.length;i++)1<R.currentNodes[i].textureLoaded&&(L.bufferData(L.ARRAY_BUFFER,R.currentNodes[i].vertices,L.STATIC_DRAW),L.bindTexture(L.TEXTURE_2D,R.currentNodes[i].texture),L.drawElements(L.TRIANGLES,6,L.UNSIGNED_SHORT,0));R.drawInProgress=!1}}if(n.returnImage!==a)return e.createImageBitmap&&"ImageBitmap"==n.returnImage?createImageBitmap(I):0==n.returnImage.toString().indexOf("image/")?I.toDataURL(n.returnImage):I.toDataURL("image/jpg",.5)}else for(n={f:"translate3d(-"+((s=F/2)+2)+"px, -"+(s+2)+"px, -"+s+"px)",b:"translate3d("+(s+2)+"px, -"+(s+2)+"px, "+s+"px) rotateX(180deg) rotateZ(180deg)",u:"translate3d(-"+(s+2)+"px, -"+s+"px, "+(s+2)+"px) rotateX(270deg)",d:"translate3d(-"+(s+2)+"px, "+s+"px, -"+(s+2)+"px) rotateX(90deg)",l:"translate3d(-"+s+"px, -"+(s+2)+"px, "+(s+2)+"px) rotateX(180deg) rotateY(90deg) rotateZ(180deg)",r:"translate3d("+s+"px, -"+(s+2)+"px, -"+(s+2)+"px) rotateY(270deg)"},i="perspective("+(o=(r=1/Math.tan(o/2))*I.clientWidth/2+"px")+") translateZ("+o+") rotateX("+t+"rad) rotateY("+i+"rad) ",o=Object.keys(n),t=0;6>t;t++)(h=k.querySelector(".pnlm-"+o[t]+"face"))&&(h.style.webkitTransform=i+n[o[t]],h.style.transform=i+n[o[t]])},this.isLoading=function(){if(L&&"multires"==H)for(var e=0;e<R.currentNodes.length;e++)if(!R.currentNodes[e].textureLoaded)return!0;return!1},this.isBaseLoaded=function(){if(6<=R.currentNodes.length){for(var e=0;6>e;e++)if(!R.currentNodes[e].textureLoaded)return!1;return!0}return!1},this.getCanvas=function(){return I};var j,Z=[],$=function(){function e(){var e=this;this.texture=this.callback=null,this.image=new Image,this.image.crossOrigin=a||"anonymous";var t=function(){R.textureLoads.push((function(t){t&&(0<e.image.width&&0<e.image.height?(t=e.image,L.bindTexture(L.TEXTURE_2D,e.texture),L.texImage2D(L.TEXTURE_2D,0,L.RGB,L.RGB,L.UNSIGNED_BYTE,t),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MAG_FILTER,L.LINEAR),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MIN_FILTER,L.LINEAR),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_S,L.CLAMP_TO_EDGE),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_T,L.CLAMP_TO_EDGE),L.bindTexture(L.TEXTURE_2D,null),e.callback(e.texture,!0)):e.callback(e.texture,!1)),Z.length?(t=Z.shift(),e.loadTexture(t.src,t.texture,t.callback)):o[i++]=e}))};this.image.addEventListener("load",t),this.image.addEventListener("error",t)}function t(e,t,a,i){this.node=e,this.src=t,this.texture=a,this.callback=i}var a,i=4,o={};e.prototype.loadTexture=function(e,t,a){this.texture=t,this.callback=a,this.image.src=e};for(var n=0;n<i;n++)o[n]=new e;return function(e,n,r,s){return a=s,s=L.createTexture(),i?o[--i].loadTexture(n,s,r):Z.push(new t(e,n,s,r)),s}}();j=function(e){$(e,e.path+(U.extension?"."+U.extension:""),(function(t,a){e.texture=t,e.textureLoaded=a?2:1}),V.crossOrigin)};var K="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz#$%*+,-.:;=?@[]^_{|}~",J="Bf[ff4fff|ffff0fffffBo@Ri5xag{Jmdf2+WiefCs@Ll7+Vi]Btag6[NmdgCv=Ho9;Qk;7zWiF_GsahDy:ErE?Mn$5+SkS_AyWiD#-CuJ[Iqp6;Nnx?7*SlE$*BxR@FtPA?Jq+%7:NnF*zAzn?CwIG@Ft-Y9?IrG+vA%w:AzGR?Cx*IF@EuI,nA+$*9%Gu:A#xCR?ByJ-VB-*wA+J**9*ZBv:9%L.QD.*aB.O.v9-MF+$8,O:MG:*OD;a:UB:IO:n9:Q:KJ;#IG=u-KE=Hs:MC?T:IO=wEL?#%FJ@K**FI@Y;HV=pDU?*sCS@S.uCR[m;Hp=VDq?*SCs@s.QCt[r:Iw=OEz?#IF$@#*HF%@u:K$;KI+=uEK-=*sCM:?w:M+:HO.;aCU;:%OCn?:z.Q..Ha;.ODv?-yFG$@,$-V;-Hw=+JH*?*lBP:?%%,n=+J*?%GQ:=#NCt?;y++v=%O:=zGt?:xHI,@-u,*z=zX?:wI+@,tEY??%r-$*;xt@,tP=?$qG%[:xn.#-:u$[%qp];xnN?[*sl.y:-r-?yn$^+sks_=yoi:v=*o?;uk;[zoi,_+skh:s@zl[+pi];tkg][xmhg;o@ti^xkg{$mhf|+oigf;f[ff_fff|ffff~fffff",Q=3.317,ee=[]}var o="attribute vec2 a_texCoord;varying vec2 v_texCoord;void main() {gl_Position = vec4(a_texCoord, 0.0, 1.0);v_texCoord = a_texCoord;}",n="attribute vec3 a_vertCoord;attribute vec2 a_texCoord;uniform mat4 u_cubeMatrix;uniform mat4 u_perspMatrix;varying mediump vec2 v_texCoord;void main(void) {gl_Position = u_perspMatrix * u_cubeMatrix * vec4(a_vertCoord, 1.0);v_texCoord = a_texCoord;}",r="precision highp float;\nuniform float u_aspectRatio;\nuniform float u_psi;\nuniform float u_theta;\nuniform float u_f;\nuniform float u_h;\nuniform float u_v;\nuniform float u_vo;\nuniform float u_rot;\nconst float PI = 3.14159265358979323846264;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nuniform bool u_splitImage;\nuniform samplerCube u_imageCube;\nvarying vec2 v_texCoord;\nuniform vec4 u_backgroundColor;\nvoid main() {\nfloat x = v_texCoord.x * u_aspectRatio;\nfloat y = v_texCoord.y;\nfloat sinrot = sin(u_rot);\nfloat cosrot = cos(u_rot);\nfloat rot_x = x * cosrot - y * sinrot;\nfloat rot_y = x * sinrot + y * cosrot;\nfloat sintheta = sin(u_theta);\nfloat costheta = cos(u_theta);\nfloat a = u_f * costheta - rot_y * sintheta;\nfloat root = sqrt(rot_x * rot_x + a * a);\nfloat lambda = atan(rot_x / root, a / root) + u_psi;\nfloat phi = atan((rot_y * costheta + u_f * sintheta) / root);",s=r+"float cosphi = cos(phi);\ngl_FragColor = textureCube(u_imageCube, vec3(cosphi*sin(lambda), sin(phi), cosphi*cos(lambda)));\n}",h=r+"lambda = mod(lambda + PI, PI * 2.0) - PI;\nvec2 coord = vec2(lambda / PI, phi / (PI / 2.0));\nif(coord.x < -u_h || coord.x > u_h || coord.y < -u_v + u_vo || coord.y > u_v + u_vo)\ngl_FragColor = u_backgroundColor;\nelse {\nif(u_splitImage) {\nif(coord.x < 0.0)\ngl_FragColor = texture2D(u_image0, vec2((coord.x + u_h) / u_h, (-coord.y + u_v + u_vo) / (u_v * 2.0)));\nelse\ngl_FragColor = texture2D(u_image1, vec2((coord.x + u_h) / u_h - 1.0, (-coord.y + u_v + u_vo) / (u_v * 2.0)));\n} else {\ngl_FragColor = texture2D(u_image0, vec2((coord.x + u_h) / (u_h * 2.0), (-coord.y + u_v + u_vo) / (u_v * 2.0)));\n}\n}\n}",l="varying mediump vec2 v_texCoord;uniform sampler2D u_sampler;void main(void) {gl_FragColor = texture2D(u_sampler, v_texCoord);}";return{renderer:function(e,t,a){return new i(e,t)}}}(window,document),window.pannellum=function(e,t,a){function i(i,o){function n(){if((c=t.createElement("div")).innerHTML="\x3c!--[if lte IE 9]><i></i><![endif]--\x3e",1==c.getElementsByTagName("i").length)h();else{var i;if(re=J.hfov,se=J.pitch,"cubemap"==J.type){for(ie=[],c=0;6>c;c++)ie.push(new Image),ie[c].crossOrigin=J.crossOrigin;ze.load.lbox.style.display="block",ze.load.lbar.style.display="none"}else if("multires"==J.type)c=JSON.parse(JSON.stringify(J.multiRes)),J.basePath&&J.multiRes.basePath&&!/^(?:[a-z]+:)?\/\//i.test(J.multiRes.basePath)?c.basePath=J.basePath+J.multiRes.basePath:J.multiRes.basePath?c.basePath=J.multiRes.basePath:J.basePath&&(c.basePath=J.basePath),ie=c;else if(!0===J.dynamic)ie=J.panorama;else{if(J.panorama===a)return void h(J.strings.noPanoramaError);ie=new Image}if("cubemap"==J.type)for(var o=6,n=function(){0===--o&&s()},l=function(e){var a=t.createElement("a");a.href=e.target.src,a.textContent=a.href,h(J.strings.fileAccessError.replace("%s",a.outerHTML))},c=0;c<ie.length;c++)"null"==(i=J.cubeMap[c])?(console.log("Will use background instead of missing cubemap face "+c),n()):(J.basePath&&!r(i)&&(i=J.basePath+i),ie[c].onload=n,ie[c].onerror=l,ie[c].src=$(i));else if("multires"==J.type)s();else if(i="",J.basePath&&(i=J.basePath),!0!==J.dynamic){if(J.panorama instanceof Image||J.panorama instanceof ImageData||e.ImageBitmap&&J.panorama instanceof ImageBitmap)return ie=J.panorama,void s();i=r(J.panorama)?J.panorama:i+J.panorama,ie.onload=function(){e.URL.revokeObjectURL(this.src),s()},(le=new XMLHttpRequest).onloadend=function(){if(200!=le.status){var o=t.createElement("a");o.href=i,o.textContent=o.href,h(J.strings.fileAccessError.replace("%s",o.outerHTML))}else(function(i,o){var n=new FileReader;n.addEventListener("loadend",(function(){var r=n.result;navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)&&((0>(c=r.indexOf("ÿÂ"))||65536<c)&&h(J.strings.iOS8WebGLError));if(-1<(c=r.indexOf("<x:xmpmeta"))&&!0!==J.ignoreGPanoXMP){var s=r.substring(c,r.indexOf("</x:xmpmeta>")+12),l=function(e){var t;return 0<=s.indexOf(e+'="')?t=(t=s.substring(s.indexOf(e+'="')+e.length+2)).substring(0,t.indexOf('"')):0<=s.indexOf(e+">")&&(t=(t=s.substring(s.indexOf(e+">")+e.length+1)).substring(0,t.indexOf("<"))),t!==a?Number(t):null},c=(r=l("GPano:FullPanoWidthPixels"),l("GPano:CroppedAreaImageWidthPixels")),d=l("GPano:FullPanoHeightPixels"),u=l("GPano:CroppedAreaImageHeightPixels"),f=l("GPano:CroppedAreaTopPixels"),m=l("GPano:PoseHeadingDegrees"),p=l("GPano:PosePitchDegrees"),g=l("GPano:PoseRollDegrees"),v=l("GPano:InitialViewPitchDegrees"),w=l("GPano:InitialViewHeadingDegrees");l=l("GPano:InitialHorizontalFOVDegrees");null!==r&&null!==c&&null!==d&&null!==u&&null!==f&&(0>Le.indexOf("haov")&&(J.haov=c/r*360),0>Le.indexOf("vaov")&&(J.vaov=u/d*180),0>Le.indexOf("vOffset")&&(J.vOffset=-180*((f+u/2)/d-.5)),null!==m&&0>Le.indexOf("northOffset")&&(J.northOffset=m,!1!==J.compass&&(J.compass=!0)),null!==p&&null!==g&&(0>Le.indexOf("horizonPitch")&&(J.horizonPitch=p),0>Le.indexOf("horizonRoll")&&(J.horizonRoll=g)),null!=v&&0>Le.indexOf("pitch")&&(J.pitch=v),null!=w&&0>Le.indexOf("yaw")&&(J.yaw=w),null!=l&&0>Le.indexOf("hfov")&&(J.hfov=l))}ie.src=e.URL.createObjectURL(i),ie.onerror=function(){(e.fetch?e.fetch(t.location.href).then((function(e){return e.headers.get("Content-Security-Policy")})):null).then((function(e){e&&e.split(";").find((function(e){if(e=e.match(/img-src(.*)/))return!e[1].includes("blob")}))&&(console.log("CSP blocks blobs; reverting to URL."),ie.crossOrigin=J.crossOrigin,ie.src=o)}))}})),n.readAsBinaryString!==a?n.readAsBinaryString(i):n.readAsText(i)})(this.response,i),ze.load.msg.innerHTML=""},le.onprogress=function(e){var t,a;e.lengthComputable?(ze.load.lbarFill.style.width=e.loaded/e.total*100+"%",1e6<e.total?(t="MB",a=(e.loaded/1e6).toFixed(2),e=(e.total/1e6).toFixed(2)):1e3<e.total?(t="kB",a=(e.loaded/1e3).toFixed(1),e=(e.total/1e3).toFixed(1)):(t="B",a=e.loaded,e=e.total),ze.load.msg.innerHTML=a+" / "+e+" "+t):(ze.load.lbox.style.display="block",ze.load.lbar.style.display="none")};try{le.open("GET",i,!0)}catch(e){h(J.strings.malformedURLError)}le.responseType="blob",le.setRequestHeader("Accept","image/*,*/*;q=0.9"),le.withCredentials="use-credentials"===J.crossOrigin,le.send()}J.draggable&&Fe.classList.add("pnlm-grab"),Fe.classList.remove("pnlm-grabbing"),Ce=!0===J.dynamicUpdate,J.dynamic&&Ce&&(ie=J.panorama,s())}}function r(e){return/^(?:[a-z]+:)?\/\//i.test(e)||"/"==e[0]||"blob:"==e.slice(0,5)}function s(){Q||(Q=new libpannellum.renderer(ke)),be||(be=!0,Oe.addEventListener("mousedown",u,!1),t.addEventListener("mousemove",p,!1),t.addEventListener("mouseup",g,!1),J.mouseZoom&&(Fe.addEventListener("mousewheel",E,!1),Fe.addEventListener("DOMMouseScroll",E,!1)),J.doubleClickZoom&&Oe.addEventListener("dblclick",f,!1),i.addEventListener("mozfullscreenchange",z,!1),i.addEventListener("webkitfullscreenchange",z,!1),i.addEventListener("msfullscreenchange",z,!1),i.addEventListener("fullscreenchange",z,!1),"function"==typeof ResizeObserver?(he=new ResizeObserver(L)).observe(i):(e.addEventListener("resize",L,!1),e.addEventListener("orientationchange",L,!1)),J.disableKeyboardCtrl||(i.addEventListener("keydown",M,!1),i.addEventListener("keyup",T,!1),i.addEventListener("blur",P,!1)),t.addEventListener("mouseleave",g,!1),""===t.documentElement.style.pointerAction&&""===t.documentElement.style.touchAction?(Oe.addEventListener("pointerdown",_,!1),Oe.addEventListener("pointermove",b,!1),Oe.addEventListener("pointerup",x,!1),Oe.addEventListener("pointerleave",x,!1)):(Oe.addEventListener("touchstart",v,!1),Oe.addEventListener("touchmove",w,!1),Oe.addEventListener("touchend",y,!1)),e.navigator.pointerEnabled&&(i.style.touchAction="none")),function(){try{var e={};J.horizonPitch!==a&&(e.horizonPitch=J.horizonPitch*Math.PI/180),J.horizonRoll!==a&&(e.horizonRoll=J.horizonRoll*Math.PI/180),J.backgroundColor!==a&&(e.backgroundColor=J.backgroundColor),Q.init(ie,J.type,J.haov*Math.PI/180,J.vaov*Math.PI/180,J.vOffset*Math.PI/180,D,e)}catch(e){if(!0!==J.dynamic&&(ie=a),"webgl error"==e.type||"no webgl"==e.type)h();else{if("webgl size error"!=e.type)throw h(J.strings.unknownError),e;h(J.strings.textureSizeError.replace("%s",e.width).replace("%s",e.maxWidth))}}}(),Y(J.hfov),setTimeout((function(){}),500)}function h(e){e===a&&(e=J.strings.genericWebGLError),ze.errorMsg.innerHTML="<p>"+e+"</p>",Ye.load.style.display="none",ze.load.box.style.display="none",ze.errorMsg.style.display="table",_e=!0,ae=a,ke.style.display="none",K("error",e)}function l(e){ze.interactionMsg.style.opacity=1,ze.interactionMsg.innerHTML="<p>"+e+"</p>",ze.interactionMsg.style.display="table",K("messageshown"),clearTimeout(ze.interactionMsg.timeout),ze.interactionMsg.removeEventListener("transitionend",c),ze.interactionMsg.timeout=setTimeout((function(){ze.interactionMsg.style.opacity=0,ze.interactionMsg.addEventListener("transitionend",c)}),2e3)}function c(){ze.interactionMsg.style.opacity=0,ze.interactionMsg.style.display="none",K("messagecleared")}function d(e){var t=i.getBoundingClientRect(),a={};return a.x=(e.clientX||e.pageX)-t.left,a.y=(e.clientY||e.pageY)-t.top,a}function u(e){if(e.preventDefault(),i.focus(),ae&&J.draggable&&!J.draggingHotSpot){var t=d(e);if(J.hotSpotDebug){var a=m(e);console.log("Pitch: "+a[0]+", Yaw: "+a[1]+", Center Pitch: "+J.pitch+", Center Yaw: "+J.yaw+", HFOV: "+J.hfov)}q(),W(),J.roll=0,xe.hfov=0,de=!0,ue=Date.now(),fe=t.x,me=t.y,ge=J.yaw,ve=J.pitch,Fe.classList.add("pnlm-grabbing"),Fe.classList.remove("pnlm-grab"),K("mousedown",e),C()}}function f(e){J.minHfov===J.hfov?ce.setHfov(re,1e3):(e=m(e),ce.lookAt(e[0],e[1],J.minHfov,1e3))}function m(e){var t=d(e),a=(e=Q.getCanvas()).clientWidth,i=e.clientHeight;e=t.x/a*2-1;i=(1-t.y/i*2)*i/a;var o=1/Math.tan(J.hfov*Math.PI/360),n=Math.sin(J.pitch*Math.PI/180),r=Math.cos(J.pitch*Math.PI/180);t=o*r-i*n,a=Math.sqrt(e*e+t*t),i=180*Math.atan((i*r+o*n)/a)/Math.PI;return-180>(e=180*Math.atan2(e/a,t/a)/Math.PI+J.yaw)&&(e+=360),180<e&&(e-=360),[i,e]}function p(e){if(te)k(te,e);else if(de&&ae){ue=Date.now();var t=(a=Q.getCanvas()).clientWidth,a=a.clientHeight;e=d(e);var i=180*(Math.atan(fe/t*2-1)-Math.atan(e.x/t*2-1))/Math.PI*J.hfov/90+ge;xe.yaw=(i-J.yaw)%360*.2,J.yaw=i,t=360*Math.atan(Math.tan(J.hfov/360*Math.PI)*a/t)/Math.PI,t=180*(Math.atan(e.y/a*2-1)-Math.atan(me/a*2-1))/Math.PI*t/90+ve,xe.pitch=.2*(t-J.pitch),J.pitch=t}}function g(e){te&&te.dragHandlerFunc&&te.dragHandlerFunc(e,te.dragHandlerArgs),te=null,de&&(de=!1,15<Date.now()-ue&&(xe.pitch=xe.yaw=0),Fe.classList.add("pnlm-grab"),Fe.classList.remove("pnlm-grabbing"),ue=Date.now(),K("mouseup",e))}function v(e){if(ae&&J.draggable&&!te){q(),W(),J.roll=0,xe.hfov=0;var t=d(e.targetTouches[0]);if(fe=t.x,me=t.y,2==e.targetTouches.length){var a=d(e.targetTouches[1]);fe+=.5*(a.x-t.x),me+=.5*(a.y-t.y),pe=Math.sqrt((t.x-a.x)*(t.x-a.x)+(t.y-a.y)*(t.y-a.y))}de=!0,ue=Date.now(),ge=J.yaw,ve=J.pitch,K("touchstart",e),C()}}function w(e){if(J.draggable&&(J.dragConfirm||e.preventDefault(),ae&&(ue=Date.now()),de&&ae)){var t=(o=d(e.targetTouches[0])).x,a=o.y;if(2==e.targetTouches.length&&-1!=pe){var i=d(e.targetTouches[1]),o=(t=t+.5*(i.x-o.x),a=a+.5*(i.y-o.y),Math.sqrt((o.x-i.x)*(o.x-i.x)+(o.y-i.y)*(o.y-i.y)));Y(J.hfov+.1*(pe-o)),pe=o}o=J.hfov/360*J.touchPanSpeedCoeffFactor,ye||"both"!=J.dragConfirm&&"yaw"!=J.dragConfirm||2==e.targetTouches.length?(t=(fe-t)*o+ge,xe.yaw=(t-J.yaw)%360*.2,J.yaw=t):fe!=t&&("yaw"==J.dragConfirm?l(J.strings.twoTouchXActivate):l(J.strings.twoTouchActivate)),ye||"both"!=J.dragConfirm&&"pitch"!=J.dragConfirm||2==e.targetTouches.length?(a=(a-me)*o+ve,xe.pitch=.2*(a-J.pitch),J.pitch=a):me!=a&&("pitch"==J.dragConfirm?l(J.strings.twoTouchYActivate):l(J.strings.twoTouchActivate)),"yaw"!=J.dragConfirm&&"pitch"!=J.dragConfirm&&"both"!=J.dragConfirm||2!=e.targetTouches.length||(c(),e.preventDefault())}}function y(){te=null,de=!1,150<Date.now()-ue&&(xe.pitch=xe.yaw=0),pe=-1,ue=Date.now(),K("touchend",event)}function _(e){"touch"==e.pointerType&&ae&&J.draggable&&(Xe.push(e.pointerId),We.push({clientX:e.clientX,clientY:e.clientY}),e.targetTouches=We,v(e),e.preventDefault())}function b(e){if("touch"==e.pointerType)if(te)k(te,e);else if(J.draggable)for(var t=0;t<Xe.length;t++)if(e.pointerId==Xe[t]){We[t].clientX=e.clientX,We[t].clientY=e.clientY,e.targetTouches=We,w(e),e.preventDefault();break}}function x(e){if(te&&te.dragHandlerFunc&&te.dragHandlerFunc(e,te.dragHandlerArgs),te=null,"touch"==e.pointerType){for(var t=!1,i=0;i<Xe.length;i++)e.pointerId==Xe[i]&&(Xe[i]=a),Xe[i]&&(t=!0);t||(Xe=[],We=[],y()),e.preventDefault()}}function E(e){ae&&("fullscreenonly"!=J.mouseZoom||ye)&&(ye||"ctrl"!=J.mouseZoom||e.ctrlKey?(c(),e.preventDefault(),q(),ue=Date.now(),e.wheelDeltaY?(Y(J.hfov-.05*e.wheelDeltaY),xe.hfov=0>e.wheelDelta?1:-1):e.wheelDelta?(Y(J.hfov-.05*e.wheelDelta),xe.hfov=0>e.wheelDelta?1:-1):e.detail&&(Y(J.hfov+1.5*e.detail),xe.hfov=0<e.detail?1:-1),C()):(e=-1!=navigator.platform.indexOf("Mac")?"control":"ctrl",l(J.strings.ctrlZoomActivate.replace("%s",'<kbd class="pnlm-outline">'+e+"</kbd>"))))}function M(e){q(),ue=Date.now(),W(),J.roll=0;var t=e.which||e.keycode;0>J.capturedKeyNumbers.indexOf(t)||!(ye||16!=t&&17!=t||"ctrl"!=J.mouseZoom)||(e.preventDefault(),27==t?ye&&H():I(t,!0))}function P(){for(var e=0;10>e;e++)we[e]=!1}function T(e){var t=e.which||e.keycode;0>J.capturedKeyNumbers.indexOf(t)||(e.preventDefault(),I(t,!1))}function I(e,t){var a=!1;switch(e){case 109:case 189:case 17:case 173:we[0]!=t&&(a=!0),we[0]=t;break;case 107:case 187:case 16:case 61:we[1]!=t&&(a=!0),we[1]=t;break;case 38:we[2]!=t&&(a=!0),we[2]=t;break;case 87:we[6]!=t&&(a=!0),we[6]=t;break;case 40:we[3]!=t&&(a=!0),we[3]=t;break;case 83:we[7]!=t&&(a=!0),we[7]=t;break;case 37:we[4]!=t&&(a=!0),we[4]=t;break;case 65:we[8]!=t&&(a=!0),we[8]=t;break;case 39:we[5]!=t&&(a=!0),we[5]=t;break;case 68:we[9]!=t&&(a=!0),we[9]=t}a&&t&&(oe="undefined"!=typeof performance&&performance.now()?performance.now():Date.now(),C())}function R(e){var t=Ie[e],a=Math.min(1,Math.max((Date.now()-t.startTime)/1e3/(t.duration/1e3),0));a=t.startPosition+J.animationTimingFunction(a)*(t.endPosition-t.startPosition);(t.endPosition>t.startPosition&&a>=t.endPosition||t.endPosition<t.startPosition&&a<=t.endPosition||t.endPosition===t.startPosition)&&(a=t.endPosition,xe[e]=0,delete Ie[e]),J[e]=a}function L(){z("resize")}function C(){Ee||(Ee=!0,A())}function A(){if(!Ne)if(function(){var e;if(ae){var t=Q.getCanvas();!1!==J.autoRotate&&(360<J.yaw?J.yaw-=360:-360>J.yaw&&(J.yaw+=360)),e=J.yaw;var i=0;if(J.avoidShowingBackground){var o=J.hfov/2,n=180*Math.atan2(Math.tan(o/180*Math.PI),t.width/t.height)/Math.PI;J.vaov>J.haov?Math.min(Math.cos((J.pitch-o)/180*Math.PI),Math.cos((J.pitch+o)/180*Math.PI)):i=o*(1-Math.min(Math.cos((J.pitch-n)/180*Math.PI),Math.cos((J.pitch+n)/180*Math.PI)))}n=-180;var r=180;360>(o=J.maxYaw-J.minYaw)&&(n=J.minYaw+J.hfov/2+i,r=J.maxYaw-J.hfov/2-i,o<J.hfov&&(n=r=(n+r)/2),J.yaw=Math.max(n,Math.min(r,J.yaw))),!1===J.autoRotate&&(360<J.yaw?J.yaw-=360:-360>J.yaw&&(J.yaw+=360)),!1!==J.autoRotate&&e!=J.yaw&&oe!==a&&(J.autoRotate*=-1),e=2*Math.atan(Math.tan(J.hfov/180*Math.PI*.5)/(t.width/t.height))/Math.PI*180,t=J.minPitch+e/2,i=J.maxPitch-e/2,J.maxPitch-J.minPitch<e&&(t=i=(t+i)/2),isNaN(t)&&(t=-90),isNaN(i)&&(i=90),J.pitch=Math.max(t,Math.min(i,J.pitch)),Q.render(J.pitch*Math.PI/180,J.yaw*Math.PI/180,J.hfov*Math.PI/180,{roll:J.roll*Math.PI/180,dynamic:Ce}),Ae&&(Ae=Ce=!1),J.hotSpots.forEach(O),J.compass&&(Ve.style.transform="rotate("+(-J.yaw-J.northOffset)+"deg)",Ve.style.webkitTransform="rotate("+(-J.yaw-J.northOffset)+"deg)")}}(),ne&&clearTimeout(ne),de||!0===Me)requestAnimationFrame(A);else if(we[0]||we[1]||we[2]||we[3]||we[4]||we[5]||we[6]||we[7]||we[8]||we[9]||J.autoRotate||Ie.pitch||Ie.yaw||Ie.hfov||.01<Math.abs(xe.yaw)||.01<Math.abs(xe.pitch)||.01<Math.abs(xe.hfov))(function(){if(ae){var e,t=!1,i=J.pitch,o=J.yaw,n=J.hfov;e="undefined"!=typeof performance&&performance.now()?performance.now():Date.now(),oe===a&&(oe=e);var r=(e-oe)*J.hfov/1200;if(r=Math.min(r,10),we[0]&&!0===J.keyboardZoom&&(Y(J.hfov+(.8*xe.hfov+.4)*r),t=!0),we[1]&&!0===J.keyboardZoom&&(Y(J.hfov+(.8*xe.hfov-.2)*r),t=!0),(we[2]||we[6])&&(J.pitch+=(.8*xe.pitch+.2)*r,t=!0),(we[3]||we[7])&&(J.pitch+=(.8*xe.pitch-.2)*r,t=!0),(we[4]||we[8])&&(J.yaw+=(.8*xe.yaw-.2)*r,t=!0),(we[5]||we[9])&&(J.yaw+=(.8*xe.yaw+.2)*r,t=!0),t&&(ue=Date.now()),J.autoRotate){if(.001<e-oe){t=(e-oe)/1e3;var s=(xe.yaw/t*r-.2*J.autoRotate)*t;s=(0<-J.autoRotate?1:-1)*Math.min(Math.abs(J.autoRotate*t),Math.abs(s)),J.yaw+=s}J.autoRotateStopDelay&&(J.autoRotateStopDelay-=e-oe,0>=J.autoRotateStopDelay&&(J.autoRotateStopDelay=!1,Te=J.autoRotate,J.autoRotate=0))}Ie.pitch&&(R("pitch"),i=J.pitch),Ie.yaw&&(R("yaw"),o=J.yaw),Ie.hfov&&(R("hfov"),n=J.hfov),0<r&&!J.autoRotate&&(t=1-J.friction,we[4]||we[5]||we[8]||we[9]||Ie.yaw||(J.yaw+=xe.yaw*r*t),we[2]||we[3]||we[6]||we[7]||Ie.pitch||(J.pitch+=xe.pitch*r*t),we[0]||we[1]||Ie.hfov||(90<J.hfov&&(t*=1-(J.hfov-90)/90),Y(J.hfov+xe.hfov*r*t))),oe=e,0<r&&(xe.yaw=.8*xe.yaw+(J.yaw-o)/r*.2,xe.pitch=.8*xe.pitch+(J.pitch-i)/r*.2,xe.hfov=.8*xe.hfov+(J.hfov-n)/r*.2,i=J.autoRotate?Math.abs(J.autoRotate):5,xe.yaw=Math.min(i,Math.max(xe.yaw,-i)),xe.pitch=Math.min(i,Math.max(xe.pitch,-i)),xe.hfov=Math.min(i,Math.max(xe.hfov,-i))),we[0]&&we[1]&&(xe.hfov=0),(we[2]||we[6])&&(we[3]||we[7])&&(xe.pitch=0),(we[4]||we[8])&&(we[5]||we[9])&&(xe.yaw=0)}})(),0<=J.autoRotateInactivityDelay&&Te&&Date.now()-ue>J.autoRotateInactivityDelay&&!J.autoRotate&&(J.autoRotate=Te,ce.lookAt(se,a,re,3e3)),requestAnimationFrame(A);else if(Q&&(Q.isLoading()||!0===J.dynamic&&Ce))requestAnimationFrame(A);else{ce.getPitch&&ce.getYaw&&ce.getHfov&&K("animatefinished",{pitch:ce.getPitch(),yaw:ce.getYaw(),hfov:ce.getHfov()}),Ee=!1,oe=a;var e=J.autoRotateInactivityDelay-(Date.now()-ue);0<e?ne=setTimeout((function(){J.autoRotate=Te,ce.lookAt(se,a,re,3e3),C()}),e):0<=J.autoRotateInactivityDelay&&Te&&(J.autoRotate=Te,ce.lookAt(se,a,re,3e3),C())}}function S(e,t,a,i){this.w=e,this.x=t,this.y=a,this.z=i}function N(t){var a;a=t.alpha;var i=t.beta;t=t.gamma,i=[i?i*Math.PI/180/2:0,t?t*Math.PI/180/2:0,a?a*Math.PI/180/2:0],a=[Math.cos(i[0]),Math.cos(i[1]),Math.cos(i[2])],i=[Math.sin(i[0]),Math.sin(i[1]),Math.sin(i[2])],a=(a=new S(a[0]*a[1]*a[2]-i[0]*i[1]*i[2],i[0]*a[1]*a[2]-a[0]*i[1]*i[2],a[0]*i[1]*a[2]+i[0]*a[1]*i[2],a[0]*a[1]*i[2]+i[0]*i[1]*a[2])).multiply(new S(Math.sqrt(.5),-Math.sqrt(.5),0,0)),i=e.orientation?-e.orientation*Math.PI/180/2:0,a=a.multiply(new S(Math.cos(i),0,-Math.sin(i),0)).toEulerAngles(),"number"==typeof Me&&10>Me?Me+=1:10===Me?(Pe=a[2]/Math.PI*180+J.yaw,Me=!0,requestAnimationFrame(A)):(J.pitch=a[0]/Math.PI*180,J.roll=-a[1]/Math.PI*180,J.yaw=-a[2]/Math.PI*180+Pe)}function D(){if(J.sceneFadeDuration&&Q.fadeImg!==a){Q.fadeImg.style.opacity=0;var e=Q.fadeImg;delete Q.fadeImg,setTimeout((function(){ke.removeChild(e),K("scenechangefadedone")}),J.sceneFadeDuration)}Ve.style.display=J.compass?"inline":"none",Se||(J.hotSpots?(J.hotSpots=J.hotSpots.sort((function(e,t){return e.pitch<t.pitch})),J.hotSpots.forEach(F)):J.hotSpots=[],Se=!0,J.hotSpots.forEach(O)),ze.load.box.style.display="none",ee!==a&&(ke.removeChild(ee),ee=a),ae=!0,!0!==J.dynamic&&(ie=a),C(),K("load")}function F(e){e.pitch=Number(e.pitch)||0,e.yaw=Number(e.yaw)||0;var a=t.createElement("div");a.tabIndex=-1,a.className="pnlm-hotspot-base",a.className=e.cssClass?a.className+" "+e.cssClass:a.className+" pnlm-hotspot pnlm-sprite pnlm-"+Z(e.type);var i,o=t.createElement("span");if(e.text&&(o.innerHTML=Z(e.text)),e.video){i=t.createElement("video");var n=e.video;J.basePath&&!r(n)&&(n=J.basePath+n),i.src=$(n),i.controls=!0,i.style.width=e.width+"px",Fe.appendChild(a),o.appendChild(i)}else if(e.image){n=e.image,J.basePath&&!r(n)&&(n=J.basePath+n),(i=t.createElement("a")).href=$(e.URL?e.URL:n,!0),J.targetBlank&&(i.target="_blank",i.rel="noopener"),o.appendChild(i);var s=t.createElement("img");s.src=$(n),s.style.width=e.width+"px",s.style.paddingTop="5px",Fe.appendChild(a),i.appendChild(s),o.style.maxWidth="initial"}else if(e.URL){if((i=t.createElement("a")).href=$(e.URL,!0),e.attributes)for(n in e.attributes)i.setAttribute(n,e.attributes[n]);else J.targetBlank&&(i.target="_blank",i.rel="noopener");Fe.appendChild(i),a.className+=" pnlm-pointer",o.className+=" pnlm-pointer",i.appendChild(a)}else e.sceneId&&(a.onclick=function(){return a.clicked||(a.clicked=!0,X(e.sceneId,e.targetPitch,e.targetYaw,e.targetHfov)),!1},a.className+=" pnlm-pointer",o.className+=" pnlm-pointer"),Fe.appendChild(a);e.createTooltipFunc?e.createTooltipFunc(a,e.createTooltipArgs):(e.text||e.video||e.image)&&(a.classList.add("pnlm-tooltip"),a.appendChild(o),o.style.width=o.scrollWidth-20+"px",o.style.marginLeft=-(o.scrollWidth-a.offsetWidth)/2+"px",o.style.marginTop=-o.scrollHeight-12+"px"),e.clickHandlerFunc&&(a.addEventListener("click",(function(t){e.clickHandlerFunc(t,e.clickHandlerArgs)}),"false"),""===t.documentElement.style.pointerAction&&""===t.documentElement.style.touchAction?a.addEventListener("pointerup",(function(t){e.clickHandlerFunc(t,e.clickHandlerArgs)}),!1):a.addEventListener("touchend",(function(t){e.clickHandlerFunc(t,e.clickHandlerArgs)}),!1),a.className+=" pnlm-pointer",o.className+=" pnlm-pointer"),e.draggable&&(a.addEventListener("mousedown",(function(t){e.dragHandlerFunc&&e.dragHandlerFunc(t,e.dragHandlerArgs),te=e})),""===t.documentElement.style.pointerAction&&""===t.documentElement.style.touchAction&&a.addEventListener("pointerdown",(function(t){e.dragHandlerFunc&&e.dragHandlerFunc(t,e.dragHandlerArgs),te=e})),a.addEventListener("touchmove",(function(t){k(e,t.targetTouches[0])})),a.addEventListener("touchend",(function(t){e.dragHandlerFunc&&e.dragHandlerFunc(t,e.dragHandlerArgs),te=null}))),e.div=a}function k(e,t){var a=m(t);e.pitch=a[0],e.yaw=a[1],O(e)}function O(e){var t=Math.sin(e.pitch*Math.PI/180),a=Math.cos(e.pitch*Math.PI/180),i=Math.sin(J.pitch*Math.PI/180),o=Math.cos(J.pitch*Math.PI/180),n=Math.cos((-e.yaw+J.yaw)*Math.PI/180),r=t*i+a*n*o;if(90>=e.yaw&&-90<e.yaw&&0>=r||(90<e.yaw||-90>=e.yaw)&&0>=r)e.div.style.visibility="hidden";else{var s=Math.sin((-e.yaw+J.yaw)*Math.PI/180),h=Math.tan(J.hfov*Math.PI/360);e.div.style.visibility="visible";var l=(c=Q.getCanvas()).clientWidth,c=c.clientHeight;t=[-l/h*s*a/r/2,-l/h*(t*o-a*n*i)/r/2],a=Math.sin(J.roll*Math.PI/180),i=Math.cos(J.roll*Math.PI/180);(t=[t[0]*i-t[1]*a,t[0]*a+t[1]*i])[0]+=(l-e.div.offsetWidth)/2,t[1]+=(c-e.div.offsetHeight)/2,l="translate("+t[0]+"px, "+t[1]+"px) translateZ(9999px) rotate("+J.roll+"deg)",e.scale&&(l="number"==typeof e.scale?l+" scale("+e.scale+")":l+" scale("+re/J.hfov/r+")"),e.div.style.webkitTransform=l,e.div.style.MozTransform=l,e.div.style.transform=l}}function B(e){J={};var t,a,i="haov vaov vOffset northOffset horizonPitch horizonRoll".split(" ");for(t in Le=[],De)De.hasOwnProperty(t)&&(J[t]=De[t]);for(t in o.default)if(o.default.hasOwnProperty(t))if("strings"==t)for(a in o.default.strings)o.default.strings.hasOwnProperty(a)&&(J.strings[a]=Z(o.default.strings[a]));else J[t]=o.default[t],0<=i.indexOf(t)&&Le.push(t);if(null!==e&&""!==e&&o.scenes&&o.scenes[e]){var n=o.scenes[e];for(t in n)if(n.hasOwnProperty(t))if("strings"==t)for(a in n.strings)n.strings.hasOwnProperty(a)&&(J.strings[a]=Z(n.strings[a]));else J[t]=n[t],0<=i.indexOf(t)&&Le.push(t);J.scene=e}for(t in o)if(o.hasOwnProperty(t))if("strings"==t)for(a in o.strings)o.strings.hasOwnProperty(a)&&(J.strings[a]=Z(o.strings[a]));else J[t]=o[t],0<=i.indexOf(t)&&Le.push(t)}function U(e){if((e=e||!1)&&"preview"in J){var i=J.preview;J.basePath&&!r(i)&&(i=J.basePath+i),(ee=t.createElement("div")).className="pnlm-preview-img",ee.style.backgroundImage="url('"+$(i).replace(/"/g,"%22").replace(/'/g,"%27")+"')",ke.appendChild(ee)}i=J.title;var o=J.author;for(var s in e&&("previewTitle"in J&&(J.title=J.previewTitle),"previewAuthor"in J&&(J.author=J.previewAuthor)),J.hasOwnProperty("title")||(ze.title.innerHTML=""),J.hasOwnProperty("author")||(ze.author.innerHTML=""),J.hasOwnProperty("title")||J.hasOwnProperty("author")||(ze.container.style.display="none"),J.targetBlank&&(Ue.rel="noopener",Ue.target="_blank"),Ye.load.innerHTML="<div><p>"+J.strings.loadButtonLabel+"</p></div>",ze.load.boxp.innerHTML=J.strings.loadingLabel,J)if(J.hasOwnProperty(s))switch(s){case"title":ze.title.innerHTML=Z(J[s]),ze.container.style.display="inline";break;case"author":var h=Z(J[s]);J.authorURL&&((h=t.createElement("a")).href=$(J.authorURL,!0),J.targetBlank&&(h.target="_blank",h.rel="noopener"),h.innerHTML=Z(J[s]),h=h.outerHTML),ze.author.innerHTML=J.strings.bylineLabel.replace("%s",h),ze.container.style.display="inline";break;case"hfov":Y(Number(J[s]));break;case"autoLoad":!0===J[s]&&Q===a&&(ze.load.box.style.display="inline",Ye.load.style.display="none",n());break;case"showZoomCtrl":Ye.zoom.style.display=J[s]&&0!=J.showControls?"block":"none";break;case"showFullscreenCtrl":Ye.fullscreen.style.display=J[s]&&0!=J.showControls&&("fullscreen"in t||"mozFullScreen"in t||"webkitIsFullScreen"in t||"msFullscreenElement"in t)?"block":"none";break;case"hotSpotDebug":Ge.style.display=J[s]?"block":"none";break;case"showControls":J[s]||(Ye.orientation.style.display="none",Ye.zoom.style.display="none",Ye.fullscreen.style.display="none");break;case"orientationOnByDefault":J[s]&&j()}e&&(i?J.title=i:delete J.title,o?J.author=o:delete J.author)}function H(){if(ae&&!_e)if(ye)t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitCancelFullScreen?t.webkitCancelFullScreen():t.msExitFullscreen&&t.msExitFullscreen();else try{i.requestFullscreen?i.requestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.msRequestFullscreen?i.msRequestFullscreen():i.webkitRequestFullScreen()}catch(e){}}function z(e){t.fullscreenElement||t.fullscreen||t.mozFullScreen||t.webkitIsFullScreen||t.msFullscreenElement?(Ye.fullscreen.classList.add("pnlm-fullscreen-toggle-button-active"),ye=!0):(Ye.fullscreen.classList.remove("pnlm-fullscreen-toggle-button-active"),ye=!1),"resize"!==e&&K("fullscreenchange",ye),Q.resize(),Y(J.hfov),C()}function G(e){var t=J.minHfov;if("multires"==J.type&&Q&&!J.multiResMinHfov&&(t=Math.min(t,Q.getCanvas().width/(J.multiRes.cubeResolution/90*.9))),t>J.maxHfov)return console.log("HFOV bounds do not make sense (minHfov > maxHfov)."),J.hfov;var a=J.hfov;a=e<t?t:e>J.maxHfov?J.maxHfov:e;return J.avoidShowingBackground&&Q&&!isNaN(J.maxPitch-J.minPitch)&&(e=Q.getCanvas(),a=Math.min(a,360*Math.atan(Math.tan((J.maxPitch-J.minPitch)/360*Math.PI)/e.height*e.width)/Math.PI)),a}function Y(e){J.hfov=G(e),K("zoomchange",J.hfov)}function q(){Ie={},Te=J.autoRotate?J.autoRotate:Te,J.autoRotate=!1}function V(){_e&&(ze.load.box.style.display="none",ze.errorMsg.style.display="none",_e=!1,ke.style.display="block",K("errorcleared")),ae=!1,c(),Ye.load.style.display="none",ze.load.box.style.display="inline",n()}function X(e,i,n,r,s){var h,l,c;if(ae||(s=!0),ae=!1,Ie={},J.sceneFadeDuration&&!s&&(s=Q.render(J.pitch*Math.PI/180,J.yaw*Math.PI/180,J.hfov*Math.PI/180,{returnImage:"ImageBitmap"}))!==a)return(h=s.then?t.createElement("canvas"):new Image).className="pnlm-fade-img",h.style.transition="opacity "+J.sceneFadeDuration/1e3+"s",h.style.width="100%",h.style.height="100%",s.then?s.then((function(t){h.width=t.width,h.height=t.height,h.getContext("2d").drawImage(t,0,0),X(e,i,n,r,!0)})):(h.onload=function(){X(e,i,n,r,!0)},h.src=s),ke.appendChild(h),void(Q.fadeImg=h);s="same"===i?J.pitch:i,l="same"===n?J.yaw:"sameAzimuth"===n?J.yaw+(J.northOffset||0)-(o.scenes[e].northOffset||0):n,c="same"===r?J.hfov:r,function(){var e=J.hotSpots;if(Se=!1,delete J.hotSpots,e)for(var t=0;t<e.length;t++){var a=e[t].div;if(a){for(;a.parentNode&&a.parentNode!=Fe;)a=a.parentNode;Fe.removeChild(a)}delete e[t].div}}(),B(e),xe.yaw=xe.pitch=xe.hfov=0,U(),s!==a&&(J.pitch=s),l!==a&&(J.yaw=l),c!==a&&(J.hfov=c),K("scenechange",e),V()}function W(){e.removeEventListener("deviceorientation",N),Ye.orientation.classList.remove("pnlm-orientation-button-active"),Me=!1}function j(){qe&&("undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((function(t){"granted"==t&&(Me=1,e.addEventListener("deviceorientation",N),Ye.orientation.classList.add("pnlm-orientation-button-active"))})):(Me=1,e.addEventListener("deviceorientation",N),Ye.orientation.classList.add("pnlm-orientation-button-active")))}function Z(e){return o.escapeHTML?String(e).split(/&/g).join("&amp;").split('"').join("&quot;").split("'").join("&#39;").split("<").join("&lt;").split(">").join("&gt;").split("/").join("&#x2f;").split("\n").join("<br>"):String(e).split("\n").join("<br>")}function $(e,t){try{var a=decodeURIComponent(function(e){return e.replace(/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,(function(e,t){return"colon"===(t=t.toLowerCase())?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""}))}(e)).replace(/[^\w:]/g,"").toLowerCase()}catch(e){return"about:blank"}return 0===a.indexOf("javascript:")||0===a.indexOf("vbscript:")?(console.log("Script URL removed."),"about:blank"):t&&0===a.indexOf("data:")?(console.log("Data URI removed from link."),"about:blank"):e}function K(e){if(e in Re)for(var t=Re[e].length;0<t;t--)Re[e][Re[e].length-t].apply(null,[].slice.call(arguments,1))}var J,Q,ee,te,ae,ie,oe,ne,re,se,he,le,ce=this,de=!1,ue=Date.now(),fe=0,me=0,pe=-1,ge=0,ve=0,we=Array(10),ye=!1,_e=!1,be=!1,xe={yaw:0,pitch:0,hfov:0},Ee=!1,Me=!1,Pe=0,Te=0,Ie={},Re={},Le=[],Ce=!1,Ae=!1,Se=!1,Ne=!1,De={hfov:100,minHfov:50,multiResMinHfov:!1,maxHfov:120,pitch:0,minPitch:a,maxPitch:a,yaw:0,minYaw:-180,maxYaw:180,roll:0,haov:360,vaov:180,vOffset:0,autoRotate:!1,autoRotateInactivityDelay:-1,autoRotateStopDelay:a,type:"equirectangular",northOffset:0,showFullscreenCtrl:!0,dynamic:!1,dynamicUpdate:!1,doubleClickZoom:!0,keyboardZoom:!0,mouseZoom:!0,showZoomCtrl:!0,autoLoad:!1,showControls:!0,orientationOnByDefault:!1,hotSpotDebug:!1,backgroundColor:[0,0,0],avoidShowingBackground:!1,animationTimingFunction:function(e){return.5>e?2*e*e:(4-2*e)*e-1},draggable:!0,dragConfirm:!1,disableKeyboardCtrl:!1,crossOrigin:"anonymous",targetBlank:!1,touchPanSpeedCoeffFactor:1,capturedKeyNumbers:[16,17,27,37,38,39,40,61,65,68,83,87,107,109,173,187,189],friction:.15,strings:{loadButtonLabel:"Click to<br>Load<br>Panorama",loadingLabel:"Loading...",bylineLabel:"by %s",noPanoramaError:"No panorama image was specified.",fileAccessError:"The file %s could not be accessed.",malformedURLError:"There is something wrong with the panorama URL.",iOS8WebGLError:"Due to iOS 8's broken WebGL implementation, only progressive encoded JPEGs work for your device (this panorama uses standard encoding).",genericWebGLError:"Your browser does not have the necessary WebGL support to display this panorama.",textureSizeError:"This panorama is too big for your device! It's %spx wide, but your device only supports images up to %spx wide. Try another device. (If you're the author, try scaling down the image.)",unknownError:"Unknown error. Check developer console.",twoTouchActivate:"Use two fingers together to pan the panorama.",twoTouchXActivate:"Use two fingers together to pan the panorama horizontally.",twoTouchYActivate:"Use two fingers together to pan the panorama vertically.",ctrlZoomActivate:"Use %s + scroll to zoom the panorama."}};(i="string"==typeof i?t.getElementById(i):i).classList.add("pnlm-container"),i.tabIndex=0;var Fe=t.createElement("div");Fe.className="pnlm-ui",i.appendChild(Fe);var ke=t.createElement("div");ke.className="pnlm-render-container",i.appendChild(ke);var Oe=t.createElement("div");Oe.className="pnlm-dragfix",Fe.appendChild(Oe);var Be=t.createElement("span");Be.className="pnlm-about-msg";var Ue=t.createElement("a");Ue.href="https://pannellum.org/",Ue.textContent="Pannellum",Be.appendChild(Ue);var He=t.createElement("span");He.textContent=" 6175668",Be.appendChild(He),Fe.appendChild(Be),Oe.addEventListener("contextmenu",(function e(t){var a=d(t);Be.style.left=a.x+"px",Be.style.top=a.y+"px",clearTimeout(e.t1),clearTimeout(e.t2),Be.style.display="block",Be.style.opacity=1,e.t1=setTimeout((function(){Be.style.opacity=0}),2e3),e.t2=setTimeout((function(){Be.style.display="none"}),2500),t.preventDefault()}));var ze={},Ge=t.createElement("div");Ge.className="pnlm-sprite pnlm-hot-spot-debug-indicator",Fe.appendChild(Ge),ze.container=t.createElement("div"),ze.container.className="pnlm-panorama-info",ze.title=t.createElement("div"),ze.title.className="pnlm-title-box",ze.container.appendChild(ze.title),ze.author=t.createElement("div"),ze.author.className="pnlm-author-box",ze.container.appendChild(ze.author),Fe.appendChild(ze.container),ze.load={},ze.load.box=t.createElement("div"),ze.load.box.className="pnlm-load-box",ze.load.boxp=t.createElement("p"),ze.load.box.appendChild(ze.load.boxp),ze.load.lbox=t.createElement("div"),ze.load.lbox.className="pnlm-lbox",ze.load.lbox.innerHTML='<div class="pnlm-loading"></div>',ze.load.box.appendChild(ze.load.lbox),ze.load.lbar=t.createElement("div"),ze.load.lbar.className="pnlm-lbar",ze.load.lbarFill=t.createElement("div"),ze.load.lbarFill.className="pnlm-lbar-fill",ze.load.lbar.appendChild(ze.load.lbarFill),ze.load.box.appendChild(ze.load.lbar),ze.load.msg=t.createElement("p"),ze.load.msg.className="pnlm-lmsg",ze.load.box.appendChild(ze.load.msg),Fe.appendChild(ze.load.box),ze.errorMsg=t.createElement("div"),ze.errorMsg.className="pnlm-error-msg pnlm-info-box",Fe.appendChild(ze.errorMsg),ze.interactionMsg=t.createElement("div"),ze.interactionMsg.className="pnlm-interaction-msg pnlm-info-box",Fe.appendChild(ze.interactionMsg);var Ye={};Ye.container=t.createElement("div"),Ye.container.className="pnlm-controls-container",Fe.appendChild(Ye.container),Ye.load=t.createElement("button"),Ye.load.className="pnlm-load-button",Ye.load.addEventListener("click",(function(){U(),V()})),Fe.appendChild(Ye.load),Ye.zoom=t.createElement("div"),Ye.zoom.className="pnlm-zoom-controls pnlm-controls",Ye.zoomIn=t.createElement("div"),Ye.zoomIn.className="pnlm-zoom-in pnlm-sprite pnlm-control",Ye.zoomIn.addEventListener("click",(function(){ae&&(Y(J.hfov-5),C())})),Ye.zoom.appendChild(Ye.zoomIn),Ye.zoomOut=t.createElement("div"),Ye.zoomOut.className="pnlm-zoom-out pnlm-sprite pnlm-control",Ye.zoomOut.addEventListener("click",(function(){ae&&(Y(J.hfov+5),C())})),Ye.zoom.appendChild(Ye.zoomOut),Ye.container.appendChild(Ye.zoom),Ye.fullscreen=t.createElement("div"),Ye.fullscreen.addEventListener("click",H),Ye.fullscreen.className="pnlm-fullscreen-toggle-button pnlm-sprite pnlm-fullscreen-toggle-button-inactive pnlm-controls pnlm-control",(t.fullscreenEnabled||t.mozFullScreenEnabled||t.webkitFullscreenEnabled||t.msFullscreenEnabled)&&Ye.container.appendChild(Ye.fullscreen),Ye.orientation=t.createElement("div"),Ye.orientation.addEventListener("click",(function(e){Me?W():j()})),Ye.orientation.addEventListener("mousedown",(function(e){e.stopPropagation()})),Ye.orientation.addEventListener("touchstart",(function(e){e.stopPropagation()})),Ye.orientation.addEventListener("pointerdown",(function(e){e.stopPropagation()})),Ye.orientation.className="pnlm-orientation-button pnlm-orientation-button-inactive pnlm-sprite pnlm-controls pnlm-control";var qe=!1;e.DeviceOrientationEvent&&"https:"==location.protocol&&(0<=navigator.userAgent.toLowerCase().indexOf("mobi")||0<=navigator.userAgent.indexOf("Mac")&&navigator.maxTouchPoints&&0<navigator.maxTouchPoints)&&(Ye.container.appendChild(Ye.orientation),qe=!0);var Ve=t.createElement("div");Ve.className="pnlm-compass pnlm-controls pnlm-control",Fe.appendChild(Ve),o.firstScene?B(o.firstScene):o.default&&o.default.firstScene?B(o.default.firstScene):B(null),U(!0);var Xe=[],We=[];S.prototype.multiply=function(e){return new S(this.w*e.w-this.x*e.x-this.y*e.y-this.z*e.z,this.x*e.w+this.w*e.x+this.y*e.z-this.z*e.y,this.y*e.w+this.w*e.y+this.z*e.x-this.x*e.z,this.z*e.w+this.w*e.z+this.x*e.y-this.y*e.x)},S.prototype.toEulerAngles=function(){return[Math.atan2(2*(this.w*this.x+this.y*this.z),1-2*(this.x*this.x+this.y*this.y)),Math.asin(2*(this.w*this.y-this.z*this.x)),Math.atan2(2*(this.w*this.z+this.x*this.y),1-2*(this.y*this.y+this.z*this.z))]},this.isLoaded=function(){return Boolean(ae)},this.getPitch=function(){return J.pitch},this.setPitch=function(e,t,i,o){return ue=Date.now(),1e-6>=Math.abs(e-J.pitch)?("function"==typeof i&&i(o),this):((t=t==a?1e3:Number(t))?(Ie.pitch={startTime:Date.now(),startPosition:J.pitch,endPosition:e,duration:t},"function"==typeof i&&setTimeout((function(){i(o)}),t)):J.pitch=e,C(),this)},this.getPitchBounds=function(){return[J.minPitch,J.maxPitch]},this.setPitchBounds=function(e){return J.minPitch=Math.max(-90,Math.min(e[0],90)),J.maxPitch=Math.max(-90,Math.min(e[1],90)),this},this.getYaw=function(){return(J.yaw+540)%360-180},this.setYaw=function(e,t,i,o){return ue=Date.now(),1e-6>=Math.abs(e-J.yaw)?("function"==typeof i&&i(o),this):(e=(e+180)%360-180,(t=t==a?1e3:Number(t))?(180<J.yaw-e?e+=360:180<e-J.yaw&&(e-=360),Ie.yaw={startTime:Date.now(),startPosition:J.yaw,endPosition:e,duration:t},"function"==typeof i&&setTimeout((function(){i(o)}),t)):J.yaw=e,C(),this)},this.getYawBounds=function(){return[J.minYaw,J.maxYaw]},this.setYawBounds=function(e){return J.minYaw=Math.max(-360,Math.min(e[0],360)),J.maxYaw=Math.max(-360,Math.min(e[1],360)),this},this.getHfov=function(){return J.hfov},this.setHfov=function(e,t,i,o){return ue=Date.now(),1e-6>=Math.abs(e-J.hfov)?("function"==typeof i&&i(o),this):((t=t==a?1e3:Number(t))?(Ie.hfov={startTime:Date.now(),startPosition:J.hfov,endPosition:G(e),duration:t},"function"==typeof i&&setTimeout((function(){i(o)}),t)):Y(e),C(),this)},this.getHfovBounds=function(){return[J.minHfov,J.maxHfov]},this.setHfovBounds=function(e){return J.minHfov=Math.max(0,e[0]),J.maxHfov=Math.max(0,e[1]),this},this.lookAt=function(e,t,i,o,n,r){return o=o==a?1e3:Number(o),e!==a&&1e-6<Math.abs(e-J.pitch)&&(this.setPitch(e,o,n,r),n=a),t!==a&&1e-6<Math.abs(t-J.yaw)&&(this.setYaw(t,o,n,r),n=a),i!==a&&1e-6<Math.abs(i-J.hfov)&&(this.setHfov(i,o,n,r),n=a),"function"==typeof n&&n(r),this},this.getNorthOffset=function(){return J.northOffset},this.setNorthOffset=function(e){return J.northOffset=Math.min(360,Math.max(0,e)),C(),this},this.getHorizonRoll=function(){return J.horizonRoll},this.setHorizonRoll=function(e){return J.horizonRoll=Math.min(90,Math.max(-90,e)),Q.setPose(J.horizonPitch*Math.PI/180,J.horizonRoll*Math.PI/180),C(),this},this.getHorizonPitch=function(){return J.horizonPitch},this.setHorizonPitch=function(e){return J.horizonPitch=Math.min(90,Math.max(-90,e)),Q.setPose(J.horizonPitch*Math.PI/180,J.horizonRoll*Math.PI/180),C(),this},this.startAutoRotate=function(e,t,i,o){return e=e||Te||1,t=t===a?se:t,i=i===a?re:i,J.autoRotate=e,o!==a&&(J.autoRotateInactivityDelay=o),ce.lookAt(t,a,i,3e3),C(),this},this.stopAutoRotate=function(){return Te=J.autoRotate?J.autoRotate:Te,J.autoRotate=!1,J.autoRotateInactivityDelay=-1,this},this.stopMovement=function(){q(),xe={yaw:0,pitch:0,hfov:0}},this.getRenderer=function(){return Q},this.setUpdate=function(e){return(Ce=!0===e)&&(Ae=!1,Q===a?s():C()),this},this.updateOnce=function(){return Ce=Ae=!0,Q===a?s():C(),this},this.mouseEventToCoords=function(e){return m(e)},this.loadScene=function(e,t,a,i){return!1!==ae&&X(e,t,a,i),this},this.getScene=function(){return J.scene},this.addScene=function(e,t){return o.scenes[e]=t,this},this.removeScene=function(e){return!(J.scene==e||!o.scenes.hasOwnProperty(e))&&(delete o.scenes[e],!0)},this.toggleFullscreen=function(){return H(),this},this.getConfig=function(){return J},this.getContainer=function(){return i},this.addHotSpot=function(e,t){if(t===a&&J.scene===a)J.hotSpots.push(e);else{var i=t!==a?t:J.scene;if(!o.scenes.hasOwnProperty(i))throw"Invalid scene ID!";o.scenes[i].hasOwnProperty("hotSpots")||(o.scenes[i].hotSpots=[],i==J.scene&&(J.hotSpots=o.scenes[i].hotSpots)),o.scenes[i].hotSpots.push(e)}return t!==a&&J.scene!=t||(F(e),ae&&O(e)),this},this.removeHotSpot=function(e,t){if(t===a||J.scene==t){if(!J.hotSpots)return!1;for(var i=0;i<J.hotSpots.length;i++)if(J.hotSpots[i].hasOwnProperty("id")&&J.hotSpots[i].id==e){for(var n=J.hotSpots[i].div;n.parentNode!=Fe;)n=n.parentNode;return Fe.removeChild(n),delete J.hotSpots[i].div,J.hotSpots.splice(i,1),!0}}else{if(!o.scenes.hasOwnProperty(t))return!1;if(!o.scenes[t].hasOwnProperty("hotSpots"))return!1;for(i=0;i<o.scenes[t].hotSpots.length;i++)if(o.scenes[t].hotSpots[i].hasOwnProperty("id")&&o.scenes[t].hotSpots[i].id==e)return o.scenes[t].hotSpots.splice(i,1),!0}},this.resize=function(){Q&&L()},this.isOrientationSupported=function(){return qe||!1},this.stopOrientation=function(){W()},this.startOrientation=function(){j()},this.isOrientationActive=function(){return Boolean(Me)},this.on=function(e,t){return Re[e]=Re[e]||[],Re[e].push(t),this},this.off=function(e,t){if(!e)return Re={},this;if(t){var a=Re[e].indexOf(t);0<=a&&Re[e].splice(a,1),0==Re[e].length&&delete Re[e]}else delete Re[e];return this},this.destroy=function(){if(Ne=!0,clearTimeout(ne),le&&le.abort(),Array.isArray(ie))for(var a=0;6>a;a++)ie[a].src="";Q&&Q.destroy(),be&&(t.removeEventListener("mousemove",p,!1),t.removeEventListener("mouseup",g,!1),i.removeEventListener("mozfullscreenchange",z,!1),i.removeEventListener("webkitfullscreenchange",z,!1),i.removeEventListener("msfullscreenchange",z,!1),i.removeEventListener("fullscreenchange",z,!1),he?he.disconnect():(e.removeEventListener("resize",L,!1),e.removeEventListener("orientationchange",L,!1)),i.removeEventListener("keydown",M,!1),i.removeEventListener("keyup",T,!1),i.removeEventListener("blur",P,!1),t.removeEventListener("mouseleave",g,!1)),i.innerHTML="",i.classList.remove("pnlm-container")}}return{viewer:function(e,t){return new i(e,t)}}}(window,document);const i={panoramaTarget:"trailview_panorama",mapTarget:"trailview_map",initialImageId:"c96ba6029cad464e9a4b7f9a6b8ac0d5",baseUrl:"https://trailview.cmparks.net",mapboxKey:void 0,navArrowMinAngle:-25,navArrowMaxAngle:-20,imageFetchType:"standard"};function o(e,t){return e-Math.floor(e/t)*t}class n{_options=i;_panViewer;_geo={latitude:0,longitude:0};_prevNorthOffset=0;_prevYaw=0;_currImg;_sceneList=[];_hotSpotList=[];_prevImg;_map;_mapMarker;_emitter;_sequencesData;_navArrowInfos=[];_mouseOnDot=!1;_destroyed=!1;_neighbors=[];_pitchCorrectionOverride;constructor(e=i){return this._emitter=new t,this._options=e,fetch(a(this._options.baseUrl,"/api/sequences"),{method:"GET"}).then((async e=>{const t=await e.json();if(!t.success)throw new Error("Failed to fetch sequence data");this._sequencesData=t.data,await this._initViewer(this._options.initialImageId),this._currImg&&this.goToImageID(this._currImg.id,!0)})),this}on(e,t){this._emitter.on(e,t)}overridePitchCorrection(e){this._pitchCorrectionOverride=e,void 0!==this._currImg&&this.goToImageID(this._currImg.id,!0)}_createMapLayer(){if(void 0===this._map)throw new Error("Cannot create map layer as map is undefined");this._map.getSource("dots")&&(this._map.removeLayer("dots"),this._map.removeSource("dots"));const e={type:"vector",format:"pbf",tiles:[a(this._options.baseUrl,"/api/tiles/{z}/{x}/{y}")]};this._map.addSource("dots",e),this._map.addLayer({id:"dots","source-layer":"geojsonLayer",source:"dots",type:"circle",paint:{"circle-radius":10,"circle-color":["case",["==",["get","visible"],!0],"#00a108","#db8904"]}}),this._map.setPaintProperty("dots","circle-radius",["interpolate",["exponential",.5],["zoom"],13,3,16,5,17,7,20,8]),this._map.setPaintProperty("dots","circle-opacity",["interpolate",["exponential",.5],["zoom"],13,.05,15,.1,17,.25,20,1])}_startMap(){this._options.mapboxKey&&this._options.mapTarget&&(e.accessToken=this._options.mapboxKey,this._map=new e.Map({container:this._options.mapTarget,style:"mapbox://styles/cleveland-metroparks/cisvvmgwe00112xlk4jnmrehn?optimize=true",center:[-81.682665,41.4097766],zoom:9.5,pitchWithRotate:!1,dragRotate:!1,touchPitch:!1,boxZoom:!1}),this._map.on("load",(()=>{this._createMapLayer()})),this._map.on("mouseenter","dots",(()=>{this._mouseOnDot=!0,this._map&&(this._map.getCanvas().style.cursor="pointer")})),this._map.on("mouseleave","dots",(()=>{this._mouseOnDot=!1,this._map&&(this._map.getCanvas().style.cursor="grab")})),this._map.on("mousedown",(()=>{this._map&&!this._mouseOnDot&&(this._map.getCanvas().style.cursor="grabbing")})),this._map.on("mouseup",(()=>{this._map&&this._mouseOnDot?this._map.getCanvas().style.cursor="pointer":this._map&&(this._map.getCanvas().style.cursor="grab")})),this._createMapMarker(),this._map.on("click","dots",(e=>{void 0!==e.features&&null!==e.features[0].properties?this.goToImageID(e.features[0].properties.imageID):console.warn("Features is undefiend or properties are null")})))}_createMapMarker(){if(void 0===this._map)throw new Error("Cannot create map marker as map is undefined");const t=document.createElement("div");t.classList.add("trailview-current-marker-wrapper");const a=document.createElement("div");a.classList.add("trailview-current-marker");const i=document.createElement("div");i.classList.add("trailview-marker-viewer"),t.appendChild(a),t.appendChild(i),this._mapMarker=new e.Marker(t).setLngLat([-81.682665,41.4097766]).addTo(this._map).setRotationAlignment("map"),this._updateMapMarkerRotation(),this._map.jumpTo({center:this._mapMarker.getLngLat(),zoom:16,bearing:0})}_updateMapMarkerRotation(){if(void 0!==this._panViewer&&void 0!==this._mapMarker){const e=this.getBearing();void 0!==e&&this._mapMarker.setRotation((e+225)%360)}!1===this._destroyed&&requestAnimationFrame(this._updateMapMarkerRotation.bind(this))}_updateNavArrows(e=!1){const t=document.getElementsByClassName("trailview-nav-arrow");if(void 0!==this._panViewer){for(const e of t){const t=o(360-((a=this._panViewer.getYaw())<0&&(a=360+a),a)+e.yaw,360);e.style.transform=`scale(80%) translate(-50%, -50%) rotateZ(${t}deg) translateY(-100px)`}let e=(this._panViewer.getPitch()+90)/2.5;e>80?e=80:e<0&&(e=0),document.getElementById("trailview-nav-container").style.transform=`translate(-50%, 0) perspective(300px) rotateX(${e}deg)`}var a;e||!1!==this._destroyed||requestAnimationFrame(this._updateNavArrows.bind(this,!1))}getCurrentImageID(){if(this._currImg)return this._currImg.id}getFlipped(){return this._currImg?this._currImg.flipped:void 0}getCurrentSequenceId(){return this._currImg?this._currImg.sequenceId:void 0}getPanViewer(){return this._panViewer}_createViewerConfig(e){return{default:{firstScene:e,sceneFadeDuration:1500,compass:!1,autoLoad:!0,showControls:!1,crossOrigin:"use-credentials"},scenes:{}}}_addSceneToConfig(e,t){if(!this._sequencesData)throw new Error("Cannot add scene to config as sequence data is undefined");if(!this._sequencesData.find((e=>e.id===t.sequenceId)))throw new Error(`Cannot add scene to config as sequence not found with id: ${t.sequenceId}`);return e.scenes[String(t.id)]={horizonPitch:t.pitchCorrection,hfov:120,yaw:0,northOffset:t.bearing,type:"multires",multiRes:{basePath:a(this._options.baseUrl,"/api/panImage",`/${t.id}`),path:"/%l/%s%y_%x",extension:"jpg",tileResolution:512,maxLevel:3,cubeResolution:1832}},e}_addImageToViewer(e,t){this._sceneList.push(e.id);let i=e.pitchCorrection,n=180;e.flipped||(i*=-1,n=0);let r=e.bearing;if(e.flipped||(r=o(r+180,360)),!this._sequencesData)return void console.warn("Cannot add scene to viewer as sequence data is undefined");if(!this._sequencesData.find((t=>t.id===e.sequenceId)))return void console.warn(`Cannot find sequence with id: ${e.sequenceId}`);const s={horizonPitch:i,hfov:120,yaw:n,northOffset:r,type:"multires",multiRes:{basePath:a(this._options.baseUrl,"/api/panImage",`/${e.id}`),path:"/%l/%s%y_%x",fallbackPath:"/fallback/%s",extension:"jpg",tileResolution:512,maxLevel:3,cubeResolution:1832,shtHash:t}};null!=t&&(s.multiRes.shtHash=t),void 0!==this._panViewer&&this._panViewer.addScene(e.id,s)}_createNavArrows(){const e=document.getElementById("trailview-nav-container");if(null===e)return;const t=document.getElementsByClassName("trailview-nav-arrow");for(let a=t.length-1;a>=0;--a)e.removeChild(t[a]);this._navArrowInfos.forEach((t=>{const i=document.createElement("img");i.classList.add("trailview-nav-arrow"),i.src=a(this._options.baseUrl,"/assets/img/arrow.png"),i.yaw=t.yaw,i.imageId=t.id,i.draggable=!1,i.alt="Navigation arrow",i.addEventListener("click",(e=>{this.goToImageID(e.target.imageId)})),e.appendChild(i)}))}async _addNeighborsToViewer(e,t=!1){this._navArrowInfos=[];for(let a=0;a<e.length;a++){void 0!==this._pitchCorrectionOverride&&(e[a].pitchCorrection=this._pitchCorrectionOverride),this._addImageToViewer(e[a],e[a].shtHash);const i=this._options.navArrowMinAngle,n=this._options.navArrowMaxAngle,r=-(n-i-e[a].distance*(n-i)/9)+n;let s=e[a].neighborBearing;t||(s=o(e[a].neighborBearing+180,360)),this._navArrowInfos.push({id:e[a].id,pitch:r,yaw:s})}this._createNavArrows()}_customMod(e,t){return e-Math.floor(e/t)*t}async _getNeighbors(e){const t=await fetch(a(this._options.baseUrl,"/api/neighbors",this._options.imageFetchType,e.id)),i=await t.json();if(!0!==i.success)throw new Error("Failed to retrieve neighbors");return i.data}async _initViewer(e){let t=this._createViewerConfig(e);const i=await fetch(a(this._options.baseUrl,"/api/images",this._options.imageFetchType,e)),o=await i.json();if(!0!==o.success)throw new Error("Unable to fetch initial image");this._currImg=o.data,this._currImg&&(t=this._addSceneToConfig(t,this._currImg),t=this._addSceneToConfig(t,this._currImg),this._sceneList.push(this._currImg.id)),this._panViewer=pannellum.viewer(this._options.panoramaTarget,t),this._panViewer.on("scenechange",(e=>{this._onImageChange(e)})),this._onImageChange(this._panViewer.getScene()),void 0!==this._currImg&&(this._currImg.flipped?this._panViewer.setYaw(180,!1):this._panViewer.setYaw(0,!1)),this._neighbors=await this._getNeighbors(this._currImg);for(let e=0;e<this._hotSpotList.length;e++)this._panViewer.removeHotSpot(this._hotSpotList[e]);void 0!==this._currImg&&this._addNeighborsToViewer(this._neighbors,this._currImg.flipped),this._startMap(),this._createNavContainer(),this._emitter.emit("init-done")}_createNavContainer(){const e=document.createElement("div");e.id="trailview-nav-container",document.getElementById(this._options.panoramaTarget)?.appendChild(e),this._updateNavArrows()}async _fetchData(){if("standard"==this._options.imageFetchType){const e=await fetch(a(this._options.baseUrl,"/api/images/standard"),{method:"GET"}),t=await e.json();if(!0===t.success)return t.data;throw new Error("Fetching image data unsuccessful")}{const e=await fetch(a(this._options.baseUrl,"/api/images/all"),{method:"GET"}),t=await e.json();if(!0===t.success)return t.data;throw new Error("Fetching image data unsuccessful")}}async _onImageChange(e){if(void 0===e)return;if(void 0===this._panViewer)return;this._prevYaw=this._panViewer.getYaw();const t=((this._prevNorthOffset-this._panViewer.getNorthOffset())%360+this._prevYaw)%360;if(this._panViewer.setYaw(t,!1),this._prevNorthOffset=this._panViewer.getNorthOffset(),void 0===this._currImg)throw new Error("Current image is undefined");if(this._geo.latitude=this._currImg.latitude,this._geo.longitude=this._currImg.longitude,void 0!==this._map&&void 0!==this._mapMarker&&(this._mapMarker.setLngLat([this._geo.longitude,this._geo.latitude]),this._map.easeTo({center:this._mapMarker.getLngLat(),duration:500})),void 0!==this._prevImg)for(let e=0;e<this._hotSpotList.length;e++)this._panViewer.removeHotSpot(this._hotSpotList[e],this._prevImg.id);this._hotSpotList=[];const a=document.getElementsByClassName("pnlm-hotspot-base");for(let e=0;e<a.length;e++)a[e].remove();this._neighbors=await this._getNeighbors(this._currImg);const i=[e];for(let e=0;e<this._neighbors.length;e++)i.push(this._neighbors[e].id);for(let e=0;e<this._sceneList.length;e++)i.includes(this._sceneList[e])||this._panViewer.removeScene(this._sceneList[e]);this._sceneList=i,this._prevImg=this._currImg,this._addNeighborsToViewer(this._neighbors,this._currImg.flipped),this._emitter.emit("image-change",this._currImg)}getImageGeo(){return this._geo}destroy(){this._destroyed=!0,void 0!==this._panViewer&&this._panViewer.destroy()}getBearing(){return void 0!==this._panViewer?(this._panViewer.getNorthOffset()+this._panViewer.getYaw()+180)%360:void 0}async goToImageID(e,t=!1){if(void 0===this._panViewer)return;let i=this._neighbors.find((t=>t.id===e));if(t){for(let e=0;e<this._sceneList.length;e++)this._panViewer.removeScene(this._sceneList[e]);this._sceneList=[],this._neighbors=[]}if(void 0===i){const t=await fetch(a(this._options.baseUrl,"/api/images",this._options.imageFetchType,e)),o=await t.json();if(!0!==o.success)throw new Error("Unable to fetch image data");i=o.data,void 0!==this._pitchCorrectionOverride&&(i.pitchCorrection=this._pitchCorrectionOverride),this._addImageToViewer(i,o.preview)}return this._currImg=i,this._panViewer.loadScene(i.id,"same","same","same"),this}}export{n as TrailViewer,i as defaultOptions};
